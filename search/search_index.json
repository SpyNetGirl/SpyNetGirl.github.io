{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome to SpyNetGirl Blog","text":"<p>The pages on this website include my GitHub Wiki posts. Please select a category from the menu to view included content and pages.</p> <p>Harden Windows  Security PowerShell script</p> <p>Website based on GitHub Readme </p> <p></p>"},{"location":"GitHub/Git%20GitHub%20Desktop%20and%20Mandatory%20ASLR/","title":"Git GitHub Desktop and Mandatory ASLR","text":"<p>Git executables are among few poorly written programs that have problem with Mandatory ASLR (Address Space Layout Randomization) Exploit protection feature. When you turn on Mandatory ASLR in Microsoft Defender (which is off by default), those executables fail to run.</p> <p>The same Git executables are bundled with GitHub desktop app. In order to use Git in Visual Studio Code or use GitHub desktop app, we need to exclude Git executables from Mandatory ASLR and let them bypass it. Executables can be excluded from Mandatory ASLR rebootlessly.</p> <p>You can use the following PowerShell commands to automatically add all Git executables bundled with GitHub desktop or Git itself, to the exclusion for Mandatory ASLR</p> <p></p>"},{"location":"GitHub/Git%20GitHub%20Desktop%20and%20Mandatory%20ASLR/#for-github-desktop-git-binaries","title":"For GitHub desktop Git binaries","text":"<pre><code>Get-ChildItem -Recurse -Path \"C:\\Users\\$env:username\\AppData\\Local\\GitHubDesktop\\*\\resources\\app\\git\\*.exe\" | %{ Set-ProcessMitigation -Name $_.Name -Disable ForceRelocateImages }\n</code></pre>"},{"location":"GitHub/Git%20GitHub%20Desktop%20and%20Mandatory%20ASLR/#for-git-binaries-installed-using-standalone-installer","title":"For Git binaries installed using standalone installer","text":"<pre><code>Get-ChildItem -Recurse -Path \"C:\\Program Files\\Git\\*.exe\" | %{ Set-ProcessMitigation -Name $_.Name -Disable ForceRelocateImages }\n</code></pre>"},{"location":"GitHub/Signed%20and%20Verified%20commits%20with%20GitHub%20desktop/","title":"Signed and Verified commits with GitHub desktop","text":"<p>Web commits, the commits you perform using GitHub website, are automatically verified, but the ones you do from GitHub desktop need to be manually signed.</p>"},{"location":"GitHub/Signed%20and%20Verified%20commits%20with%20GitHub%20desktop/#signing-using-gpg-key","title":"Signing using GPG key","text":""},{"location":"GitHub/Signed%20and%20Verified%20commits%20with%20GitHub%20desktop/#setting-up-gpg","title":"Setting up GPG","text":"<p>Download gpg4win from their official website</p> <p>(suggested by GitHub too)</p> <p>Begin the installation, choose to only install GnuPG and Kleopatra, don't need any other component.</p> <p></p> <p>After installation, open Kleopatra and create a new GPG key pair by selecting \"New Key Pair\"</p> <p></p> <p>Enter your real name and the email address that is added as one your verified email addresses in your GitHub account settings.</p> <p>Select advanced settings and here you can optionally check the box next to \"Authentication\" and also increase the validity period of your GPG key.</p> <p></p> <p>Choosing a passphrase is not mandatory.</p> <p>Export the public key by right-clicking on the GPG key and selecting Export. Open the exported file in Notepad or VS code, copy its content and paste it in your GitHub profile's GPG key section so it can be added as a new GPG key to your GitHub account.</p>"},{"location":"GitHub/Signed%20and%20Verified%20commits%20with%20GitHub%20desktop/#configuring-gitconfig-file","title":"Configuring .gitconfig file","text":"<p>Assuming GitHub desktop is installed and logged in on your system, open the <code>.gitconfig</code> file, usually located in User's folder, and add the following items to it.</p> <p>Add this section to the end of the file</p> <pre><code>[commit]\n  gpgsign = true\n</code></pre> <p>And then add this to the <code>[user]</code> section</p> <pre><code>signingkey = YourGPGSigningkeyID\n</code></pre> <p>Replace <code>YourGPGSigningkeyID</code> with your actual GPG key ID. You can get it from Kleopatra GUI in Key-ID column (enter them without spaces in the <code>.gitconfig</code> file) or you can get it from your GPG keys section in GitHub account settings, Key ID will be visible for you after adding your GPG public key.</p> <p>You can set the validity period of your GPG certificate to unlimited, set/change/remove its passphrase and other modifications. You can publish it on the GPG server too so others can look it up and verify it.</p> <p>Make sure you backup your secret key using Kleopatra and store it in a safe place, you can import it again on another machine to continue signing your GitHub commits. Public key doesn't need to be backed up as you can regenerate it again by importing the secret GPG key on a different machine.</p> <p>Now every time you commit using GitHub desktop, your commits will be signed. If your GPG key has a passphrase, you will be asked to enter it before committing and pushing in GitHub desktop, otherwise signing will happen automatically. Your repository commit history on GitHub website will show verified badge next to them.</p> <p></p>"},{"location":"GitHub/Signed%20and%20Verified%20commits%20with%20GitHub%20desktop/#how-to-restore-gpg-for-commit-signing-using-your-current-key-on-a-new-environment","title":"How to restore GPG for commit signing using your current key on a new environment","text":"<ol> <li>Install GitHub desktop and log in with your GitHub account</li> <li>Configure the .gitconfig file as explained above</li> <li>install gpg4win as explained above</li> <li>Open Kleopatra GUI and use the Import button to import your GPG secret key backup to the program. You can also double-click on your GPG secret key backup file and add it to the program that way.</li> <li>Start committing and pushing changes to your repository using GitHub desktop app, your commits will have a verified badge on GitHub website commit history.</li> </ol>"},{"location":"GitHub/Signed%20and%20Verified%20commits%20with%20GitHub%20desktop/#official-resources","title":"Official resources","text":"<p>Telling Git about your signing key</p> <p></p> <p></p>"},{"location":"GitHub/Signed%20and%20Verified%20commits%20with%20GitHub%20desktop/#signing-using-ssh-key","title":"Signing using SSH key","text":""},{"location":"GitHub/Signed%20and%20Verified%20commits%20with%20GitHub%20desktop/#generating-the-key-pair","title":"Generating the key pair","text":"<p>Run this command to create a new SSH key pair, using the provided email as a label. It should be one of the emails added to your account as a verified emails.</p> <pre><code>ssh-keygen -t ed25519 -C \"spynetgirl@outlook.com\"\n</code></pre> <p>Replace spynetgirl@outlook.com with your own email address</p> <p>When asked, enter a file name, don't need to specify a file extension (such as .txt). 2 files will be created in User folder. The one with <code>.pub</code> extension contains your public key, the other one contains your private keys. Both of them must be backed up and stored in a safe place.</p> <p>Set a passphrase when asked, not mandatory so you can just press enter when asked for a passphrase.</p> <p></p>"},{"location":"GitHub/Signed%20and%20Verified%20commits%20with%20GitHub%20desktop/#configuring-ssh-windows-service","title":"Configuring SSH Windows service","text":"<pre><code>Set-Service -Name ssh-agent -StartupType Automatic\nSet-Service -Name ssh-agent -Status Running\n</code></pre> <p>First make sure you've moved the generated SSH key pair from the default User folder location and stored them somewhere else, can be OneDrive's personal vault, and then run the following command to add the private key of your SSH key pair to the SSH agent.</p> <pre><code>ssh-add \"Path/To/SSH/Privatekey\"\n</code></pre> <p>If you set a passphrase for your private key from previous steps then you'll be asked to enter it, otherwise you will see the successful message saying \"Identity added\".</p> <p></p>"},{"location":"GitHub/Signed%20and%20Verified%20commits%20with%20GitHub%20desktop/#add-your-ssh-public-key-to-github-account","title":"Add your SSH public key to GitHub account","text":"<p>Open the file containing your SSH public key, which has a <code>.pub</code> extension, using a text editor such as Notepad or VS code, copy its content and paste it in your GitHub account settings and save.</p> <p></p>"},{"location":"GitHub/Signed%20and%20Verified%20commits%20with%20GitHub%20desktop/#configuring-gitconfig-file_1","title":"Configuring .gitconfig file","text":"<p>Add these new sections to the end of your <code>.gitconfig</code> file. It's usually located in User folder <code>C:\\Users\\YourUserName</code></p> <pre><code>[gpg]\n    format = ssh\n[commit]\n    gpgsign = true\n</code></pre> <p>and add this to the <code>[user]</code> section to define your SSH public key, it's a direct path to that file.</p> <pre><code>signingkey = \"Path/To/SSH/SSHKey.pub\n</code></pre> <p>You must replace all of the normal backward slashes <code>\\</code> to forward slash <code>/</code> in your path, otherwise GitHub desktop throws an error.</p> <p>Now every time you commit using GitHub desktop, your commits will be signed. If your SSH key has a passphrase, you will be asked to enter it before committing and pushing in GitHub desktop, otherwise signing will happen automatically. Your repository commit history on GitHub website will show verified badge next to them.</p> <p></p>"},{"location":"GitHub/Signed%20and%20Verified%20commits%20with%20GitHub%20desktop/#how-to-restore-ssh-for-commit-signing-using-your-current-key-on-a-new-environment","title":"How to restore SSH for commit signing using your current key on a new environment","text":"<ol> <li>Install GitHub desktop and log in with your GitHub account</li> <li>Configure the .gitconfig file as explained above</li> <li>Turn on the <code>ssh-agent</code> Windows service</li> <li>Add your SSH private key to <code>ssh-agent</code> using <code>ssh-add \"Path/To/SSH/Privatekey\"</code> command</li> <li>Start committing and pushing changes to your repository, your commits will have a verified badge on GitHub website commit history.</li> </ol>"},{"location":"GitHub/Signed%20and%20Verified%20commits%20with%20GitHub%20desktop/#official-resources_1","title":"Official resources","text":"<p>Telling Git about your SSH key</p> <p>Key-based authentication in OpenSSH for Windows</p> <p>About commit signature verification</p> <p>Adding a new SSH key to your GitHub account</p> <p>Generating a new SSH key and adding it to the ssh-agent</p> <p></p>"},{"location":"Harden-Windows-Security-Module/Harden-Windows-Security-Module/","title":"Harden-Windows-Security-Module","text":"<p>This module offers rigorous compliance verification and security assessment. It enables you to evaluate the conformity of your system based on the security standards and recommendations of this repository. The module employs various techniques such as Group Policy, Security Policy, PowerShell cmdlet and Registry keys to conduct the checks.</p> <p>Compliance checking strictly follows the guidelines and security measures of this GitHub repository. Any minor deviation from them will result in a <code>$false</code> value for the corresponding check.</p> <p></p> <p></p> <p></p>"},{"location":"Harden-Windows-Security-Module/Harden-Windows-Security-Module/#how-it-works","title":"How it works","text":"<p>This module verifies and validates the security measures applied by the Harden Windows Security script using the same method as the script. For example, it checks Group Policy settings if the script uses Group Policy, registry keys if the script modifies the registry, and PowerShell cmdlets if the script invokes them.</p> <p></p> <p></p> <p></p>"},{"location":"Harden-Windows-Security-Module/Harden-Windows-Security-Module/#quick-demo","title":"Quick demo","text":""},{"location":"Harden-Windows-Security-Module/Harden-Windows-Security-Module/#requirements","title":"Requirements","text":"<ul> <li>Administrator privileges for compliance checking</li> <li>Administrator OR Standard user privileges for the hardening mode, just like the Harden Windows Security script</li> <li>PowerShell core version 7.3 and above</li> </ul>"},{"location":"Harden-Windows-Security-Module/Harden-Windows-Security-Module/#how-to-install-and-use","title":"How to install and use","text":""},{"location":"Harden-Windows-Security-Module/Harden-Windows-Security-Module/#you-can-install-this-module-from-powershell-gallery","title":"You can install this module from PowerShell gallery","text":"<pre><code>Install-Module -Name Harden-Windows-Security-Module -Force\n</code></pre>"},{"location":"Harden-Windows-Security-Module/Harden-Windows-Security-Module/#perform-compliance-test","title":"Perform Compliance test","text":"<pre><code>Confirm-SystemCompliance\n</code></pre>"},{"location":"Harden-Windows-Security-Module/Harden-Windows-Security-Module/#apply-the-hardening-measures-described-in-the-readme","title":"Apply the Hardening measures described in the Readme","text":"<pre><code>Protect-WindowsSecurity\n</code></pre>"},{"location":"Harden-Windows-Security-Module/Harden-Windows-Security-Module/#available-parameters","title":"Available parameters","text":"<pre><code>Confirm-SystemCompliance [-ExportToCSV] [-ShowAsObjectsOnly]\n</code></pre>"},{"location":"Harden-Windows-Security-Module/Harden-Windows-Security-Module/#the-module-has-2-optional-parameters-they-can-be-used-together-or-individually","title":"The module has 2 optional parameters, they can be used together or individually.","text":"<ul> <li> <p><code>[-ExportToCSV]</code>: In addition to displaying the results on the screen, also exports them in a nicely formatted CSV for easier viewing. The CSV is fully compatible with GitHub too so you can upload it to GitHub and view it.</p> </li> <li> <p><code>[-ShowAsObjectsOnly]</code>: Instead of displaying strings on the console, outputs actionable objects and properties. You can use this parameter for when you need to store the output of the function in a variable and use it that way. This provides a very detailed nested object and suppresses the normal string output on the console.</p> </li> </ul> <p></p> <p></p> <p></p>"},{"location":"Harden-Windows-Security-Module/Harden-Windows-Security-Module/#security-scoring-system","title":"Security Scoring System","text":"<p>The current max score is 89, meaning there are 89 options that produce <code>$true</code> value if they are compliant. Based on the score that you get you will see a different ASCII art!</p> <p></p> <p></p> <p></p> <p></p> <p>Any feedback or suggestions? Please use GitHub issues or discussions</p> <p></p>"},{"location":"Miscellaneous/About%20TLS%2C%20DNS%2C%20Encryption%20and%20OPSEC%20concepts/","title":"About TLS, DNS, Encryption and OPSEC concepts","text":"<p>The contents here are for beginners, to learn the basics of TLS, encrypted connections and some preliminary OPSEC (Operational security) concepts.</p> <p></p>"},{"location":"Miscellaneous/About%20TLS%2C%20DNS%2C%20Encryption%20and%20OPSEC%20concepts/#dns","title":"DNS","text":"<p>Let's talk about DNS first. Whether you are using Secure DNS such as DNS over HTTPS or using plain text DNS (Default port: 53), the domain name is the only piece of information that the DNS server provider will see. DNS does not deal with URLs, only domain names.</p> <p>E.g., in this URL, anything after the first <code>/</code> is inaccessible to the DNS server.</p> <pre><code>Github.com/HotCakeX/Harden-Windows-Security\n</code></pre> <p>The DNS provider will know that you are accessing GitHub.com but won't know which repository on GitHub.com you are visiting.</p> <ul> <li> <p>DNS doesn't resolve URLs, only enables the DNS client to find the IP Address of the server part of the URL, the rest is handled by HTTP protocol/request. The part before the slash is the DNS-provided hostname or an ordinary IP address. The part after the slash indicates the application on that host. DNS does not deal with anything after the slash at all.</p> </li> <li> <p>Anything in the URL that is not domain name is encrypted as part of the HTTP request, which uses TLS for encryption and that's why it's HTTPS. They are invisible to the DNS server and anyone else other than the webserver hosting the website you are visiting.</p> </li> <li> <p>Extra info</p> </li> <li> <p>Extra info</p> </li> </ul> <p></p>"},{"location":"Miscellaneous/About%20TLS%2C%20DNS%2C%20Encryption%20and%20OPSEC%20concepts/#about-dns-leak-in-plain-text-dns","title":"About DNS Leak in plain text DNS","text":"<p>When you are using VPN or proxies, it's important to make sure there is no DNS leakage. Properly implemented and configured VPNs/Proxies don't have this problem.</p> <p>The most practical way to see if you have DNS leak while using a VPN/Proxy is to use Wireshark to monitor your outbound connections on the edge of your network. Simply type <code>dns</code> in the Wireshark's display filter bar and observe the results. If you are using a proper VPN/Proxy or if you are using Secure DNS such as DoH or DoT, then you shouldn't see any results because that keyword only displays plain text DNS over the default port 53.</p> <p></p>"},{"location":"Miscellaneous/About%20TLS%2C%20DNS%2C%20Encryption%20and%20OPSEC%20concepts/#dns-security","title":"DNS Security","text":"<p>DNSSEC by itself without using DoH/DoT can be downgraded. If you're using DoH or DoT you must be safe as long as you are using a trusted DNS provider and your certificate authority storage is not poisoned/compromised.</p> <p></p>"},{"location":"Miscellaneous/About%20TLS%2C%20DNS%2C%20Encryption%20and%20OPSEC%20concepts/#certificates-and-tls","title":"Certificates and TLS","text":"<p>Certain countries with dictatorship or theocracy governments make people install their own root certificate to perform TLS-termination and view their data in plain-text even when HTTPS is being used. One example is what happened in Kazakhstan.</p> <p>Certain applications install root certificates, such as 3rd party antiviruses. They are all equally dangerous and must be avoided.</p> <p></p>"},{"location":"Miscellaneous/About%20TLS%2C%20DNS%2C%20Encryption%20and%20OPSEC%20concepts/#dns-privacy","title":"DNS Privacy","text":"<p>Using DNS-over-TLS or DNS-over-HTTPS mitigates some privacy leaks, because now the ISP won't have the domain you are visiting, but only the IP address. It's possible that more than one site uses the same IP address, so in some cases, it's not possible to say for sure that you are visiting SiteA.com when SiteB.com shares the same IP (Unless you are using TLS v1.2 which leaks Certificate's common name, more on that later), and high-traffic sites usually employ a CDN (content delivery network) to distribute traffic, and the IP they use are not the site's IP, but an IP belonging to the CDN (like CloudFlare or Akamai).</p> <p>Website owners use CDNs like Cloudflare for two purposes:</p> <ol> <li> <p>Best user response time by using the nearest server.</p> </li> <li> <p>Load-balancing in case of the nearest server being overloaded (DDoS and more) and then pointing to the next-nearest server.</p> </li> </ol> <p>Browsers such as Microsoft Edge only support DNS over HTTPS. Windows supports DNS over HTTPS and DNS over TLS.</p> <p>DNS over HTTPS is preferred because by default it uses the same port 443 as the rest of the HTTPS traffic on the Internet, that makes it harder to be detected and blocked. DNS over TLS on the other hand uses TCP port 853 by default and a filter on that port would block DNS over TLS entirely, whereas blocking port 443 is impractical as it essentially cripples the entire Internet.</p> <p></p>"},{"location":"Miscellaneous/About%20TLS%2C%20DNS%2C%20Encryption%20and%20OPSEC%20concepts/#dns-caching","title":"DNS Caching","text":"<p>DNS caches, just like DNS itself, only map domain names to values ('A' records), never the other way around.</p> <p>Both the DNS cache, and the DNS system as a whole, only care that bing.com points to 1.2.3.4, not that the address \"points\" back.</p> <p>Entries in the DNS cache look exactly like entries in authoritative DNS servers, with domain name as the lookup key.</p> <p></p>"},{"location":"Miscellaneous/About%20TLS%2C%20DNS%2C%20Encryption%20and%20OPSEC%20concepts/#tls-security-in-windows","title":"TLS Security in Windows","text":"<p>Windows components (Tested on Windows 11 22H2) rely on TLS 1.2, and that makes them dependent on ECC Curves. So, when enforcing TLS 1.3 only for Schannel, Windows components stop working.</p> <p>TLS 1.3 cipher suites don't require ECC curves.</p> <p>NistP256 ECC curve is a must have, otherwise Windows update won't work.</p> <p>nistP521 is the best ECC curve in terms of security, but curve25519 is also the best non-Nist one, which is also secure and popular.</p> <p></p>"},{"location":"Miscellaneous/About%20TLS%2C%20DNS%2C%20Encryption%20and%20OPSEC%20concepts/#certificates","title":"Certificates","text":"<p>Handshake messages contain the certificates (both from server and client), and they are encrypted in TLS 1.3, which means that you cannot see these without breaking the encryption.</p> <p></p>"},{"location":"Miscellaneous/About%20TLS%2C%20DNS%2C%20Encryption%20and%20OPSEC%20concepts/#sni","title":"SNI","text":"<p>SNI, which is part of the handshake, is still unencrypted even in TLS v1.3. The only way to encrypt SNI is to use ECH (Encrypted Client Hello).</p> <p></p>"},{"location":"Miscellaneous/About%20TLS%2C%20DNS%2C%20Encryption%20and%20OPSEC%20concepts/#opsec","title":"OPSEC","text":"<p>Assuming you are operating in a hostile country (E.g, China, Russia, Iran), you must be aware of the following information to keep your digital footprint minimal.</p> <p>There are 4 pieces of information that can reveal which websites/apps/services you use, to the ISP/government.</p>"},{"location":"Miscellaneous/About%20TLS%2C%20DNS%2C%20Encryption%20and%20OPSEC%20concepts/#dns_1","title":"DNS","text":"<p>Avoid using plain text DNS as much as you can. Use DNS over HTTPS for security and anonymity. Governments can block well-known servers quickly, you can however self-host on a private cloud or use a serverless DNS to have access to a new endpoint for DoH over a newly setup domain.</p> <p>If plain text DNS over port 53 is used, and you are not using a proper VPN like OpenVPN or WireGuard, or you are using proxy, then eavesdropper can see the website domain/sub-domain you are visiting. If you use secure DNS like DNS over HTTPS, then DNS becomes fully encrypted and all they can see is the domain name of the Secure DNS server as well as the IP addresses of the websites you connect to.</p>"},{"location":"Miscellaneous/About%20TLS%2C%20DNS%2C%20Encryption%20and%20OPSEC%20concepts/#certificate-common-name-etc","title":"Certificate (common name etc.)","text":"<p>Use TLS v1.3. When using TLS v1.3, the certificate part of the HTTPS connection is encrypted and none of its details are visible to the eavesdropper. TLS v1.2 handshakes do not encrypt the certificates, resulting in the common name and the website you are visiting to be revealed to the eavesdropper.</p> <p>Read more</p>"},{"location":"Miscellaneous/About%20TLS%2C%20DNS%2C%20Encryption%20and%20OPSEC%20concepts/#url","title":"URL","text":"<p>The full path to a web page or web resource is sent over HTTP protocol, so if website uses HTTPS, it's all encrypted.  </p> <p>When using\u202fHTTPS, the path and query string (everything after TLD and slash /) is encrypted and not available to anybody but the client and server, the answer is encrypted as well.</p>"},{"location":"Miscellaneous/About%20TLS%2C%20DNS%2C%20Encryption%20and%20OPSEC%20concepts/#sni-server-name-indication-or-client-hello","title":"SNI (Server Name Indication or Client Hello)","text":"<p>This is the most important part. Even after using:</p> <ol> <li> <p>HTTPS to encrypt the full URL path</p> </li> <li> <p>DoH to encrypt the DNS</p> </li> <li> <p>TLS v1.3 to encrypt the certificate</p> </li> </ol> <p>If you don't use a proper VPN, SNI can still reveal the domain and sub-domain of the website you are visiting to the eavesdropper. To secure that, the browser and the website must support ECH (Encrypted Client Hello) or use proper VPN like OpenVPN or WireGuard.</p> <p></p> <p></p> <p></p> <p></p>"},{"location":"Miscellaneous/About%20TLS%2C%20DNS%2C%20Encryption%20and%20OPSEC%20concepts/#wireshark","title":"Wireshark","text":"<p>Interesting and useful columns to add to the Wireshark GUI for better visibility into your network connections:</p> <ul> <li> <p>Use <code>tls.handshake.type == 11</code> to filter certificates, only works for TLS v1.2 and below since they don't encrypt that part of the handshake.</p> </li> <li> <p>Use <code>ssl.handshake.extension.type == \"server_name\"</code> to filter SNI or Server Name Indication. More info (When using VPN, you either shouldn't be seeing any SNI at all or only see the SNI that belongs to the VPN server's domain.)</p> </li> <li> <p>Cipher Suites is also an interesting column to add to your Wireshark profile.</p> </li> </ul>"},{"location":"Miscellaneous/Create%20Bootable%20USB%20flash%20drive%20with%20no%203rd%20party%20tools/","title":"Create Bootable flash drive no 3rd party tools","text":""},{"location":"Miscellaneous/Create%20Bootable%20USB%20flash%20drive%20with%20no%203rd%20party%20tools/#create-bootable-usb-flash-drive-with-no-3rd-party-tools","title":"Create Bootable USB flash drive with no 3rd party tools","text":""},{"location":"Miscellaneous/Create%20Bootable%20USB%20flash%20drive%20with%20no%203rd%20party%20tools/#steps-to-create-bootable-usb-flash-drive-with-no-3rd-party-tools","title":"Steps to create Bootable USB flash drive with no 3rd party tools","text":"<ol> <li> <p>Plug in a USB flash drive that has at least 8GB capacity.</p> </li> <li> <p>Delete all partitions on the USB flash drive either using Disk Management \u00b9 \u00b2 or using Windows Settings =&gt; System =&gt; Storage =&gt; Advanced Storage Settings =&gt; Disks &amp; Volumes</p> </li> <li> <p>Using either of the methods above, create a 1GB <code>FAT32</code> partition, let's name it <code>BOOT</code>\ud83d\udfe8</p> </li> <li> <p>Create a 2nd partition on the USB flash drive with the rest of the remaining unused space, formatted as <code>NTFS</code>, let's name this one <code>DATA</code>\ud83d\udfe9</p> </li> <li> <p>Mount your Windows ISO file by double clicking on it.</p> </li> <li> <p>Select all and Copy everything from Windows ISO file to the <code>NTFS</code> partition (DATA partition\ud83d\udfe9)</p> </li> <li> <p>Copy everything from Windows ISO file, except for the \"sources\" folder, to the <code>FAT32</code> partition (BOOT partition\ud83d\udfe8)</p> </li> <li> <p>Create a new folder in the <code>FAT32</code> partition (BOOT partition\ud83d\udfe8), and name it <code>sources</code></p> </li> <li> <p>copy the <code>boot.wim</code> from the \"sources\" folder inside the Windows ISO file to the newly created \"sources\" folder in the FAT32 partition (BOOT partition\ud83d\udfe8).</p> </li> <li> <p>That's it, your USB flash drive is ready and bootable.</p> </li> </ol>"},{"location":"Miscellaneous/Event%20Viewer/","title":"Event Viewer","text":""},{"location":"Miscellaneous/Event%20Viewer/#event-viewer","title":"Event Viewer","text":""},{"location":"Miscellaneous/Event%20Viewer/#how-to-identify-which-windows-firewall-rule-is-responsible-for-a-blocked-packets","title":"How to identify which Windows Firewall rule is responsible for a blocked packets","text":"<p>I've mostly considered this for the Country IP Blocking category of the hardening script, but you can use it for any purpose.</p> <p>Before doing this, you need to activate one of the system Audits.</p> <p>I suggest doing it using GUI because it will have a permanent effect:</p> <p></p> <p></p> <p>Or you can activate that Audit using this command, but it will only temporarily activate it and it'll be disabled again after you restart Windows.</p> <p></p> <pre><code>Auditpol /set /category:\"System\" /SubCategory:\"Filtering Platform Packet Drop\" /success:enable /failure:enable\n</code></pre> <p></p> <p>After the Audit is activated, running this PowerShell code will generate an output showing you blocked packets (if any).</p> <p>For example, if you visit a website or access a server that is hosted in one of the countries you blocked, or a connection was made from one of those countries to your device, it will generate an event log that will be visible to you once you run this code. Requires at least <code>PowerShell 7.3</code>.</p> <p></p> <pre><code>foreach ($event in Get-WinEvent -FilterHashtable @{LogName = 'Security'; ID = 5152 }) {\n$xml = [xml]$event.toxml();\n$xml.event.eventdata.data | \nForEach-Object { $hash = @{ TimeCreated = [datetime] $xml.Event.System.TimeCreated.SystemTime } } { $hash[$_.name] = $_.'#text' } { [pscustomobject]$hash } |\nWhere-Object FilterOrigin -notmatch 'Stealth|Unknown|Query User Default|WSH Default' | ForEach-Object {      \nif ($_.filterorigin -match ($pattern = '{.+?}')) {        \n$_.FilterOrigin = $_.FilterOrigin -replace $pattern, (Get-NetFirewallRule -Name $Matches[0]).DisplayName\n}\n$protocolName = @{ 6 = 'TCP'; 17 = 'UDP' }[[int] $_.Protocol]\n$_.Protocol = if (-not $protocolName) { $_.Protocol } else { $protocolName }\n$_.Direction = $_.Direction -eq '%%14592' ? 'Outbound' : 'Inbound'\n$_\n}\n}\n</code></pre> <p></p>"},{"location":"Miscellaneous/Event%20Viewer/#sources","title":"Sources","text":"<ul> <li>Audit Filtering Platform Packet Drop</li> <li>Filter origin audit log improvements</li> <li>Audit object access</li> </ul>"},{"location":"Miscellaneous/Group%20Policy/","title":"Group Policy usage in this GitHub repository","text":""},{"location":"Miscellaneous/Group%20Policy/#microsoft-security-compliance-toolkit","title":"Microsoft Security Compliance Toolkit","text":"<p>Official link to download Microsoft Security Compliance Toolkit</p> <p>Microsoft Security Compliance Toolkit 1.0 - How to use</p> <p>This set of tools allows enterprise security administrators to download, analyze, test, edit and store Microsoft-recommended security configuration baselines for Windows and other Microsoft products, while comparing them against other security configurations.</p> <p>Microsoft Security Compliance Toolkit includes multiple files and useful programs, here are the 3 main components that are important to us and are used in this script.</p> <ol> <li>Microsoft Security Baseline</li> <li>LGPO</li> <li>Policy Analyzer</li> </ol> <p></p>"},{"location":"Miscellaneous/Group%20Policy/#microsoft-security-baseline","title":"Microsoft Security Baseline","text":"<p>Microsoft is dedicated to providing its customers with secure operating systems, such as Windows and Windows Server, and secure apps, such as Microsoft 365 apps for enterprise and Microsoft Edge. In addition to the security assurance of its products, Microsoft also enables you to have fine control over your environments by providing various configuration capabilities.</p> <p>Even though Windows and Windows Server are designed to be secure out-of-the-box, many organizations still want more granular control over their security configurations. Continue reading more in the Microsoft website</p> <p>When you unzip the Microsoft Security Baseline file, you will find this folder structure:</p> <ol> <li>Documentation  - contains PDF and Excel files describing the differences between the previous baseline release and the new settings that were added. contains the default <code>policyrules</code> file, which is used with the Security Compliance Toolkit, you can view it using Policy Analyzer program.</li> <li>GP Reports - contains reports in HTML format, describes the GPO settings that can be applied for each category.</li> <li>GPOs \u2013 contains GPO objects for different scenarios, these are the actual policies that will be applied.</li> <li>Scripts - contains multiple PowerShell scripts for different scenarios and helps us easily import GPO settings to our system. The most important PowerShell script here is <code>Baseline-LocalInstall.ps1</code>.</li> <li>Templates \u2013 contains additional Group Policy Object templates that are not available by default on Windows, such as <code>MSS-legacy.admx</code>, these are in <code>ADMX</code> and <code>ADML</code> formats. They will be copied to <code>C:\\Windows\\PolicyDefinitions</code>, where they belong, so that the new Security Baselines GPOs can be interpreted.</li> </ol> <p></p>"},{"location":"Miscellaneous/Group%20Policy/#lgpo","title":"LGPO","text":"<p>Quoting from the PDF file supplied by LGPO:</p> <p>LGPO.exe is a command-line utility that is designed to help automate management of Local Group Policy. It can import and apply settings from Registry Policy (Registry.pol) files, security templates, Advanced Auditing backup files, as well as from formatted \"LGPO text\" files and Policy Analyzer '.PolicyRules' XML files.</p> <p>It can export local policy to a GPO backup. It can export the contents of a Registry Policy file to the 'LGPO textformat' that can then be edited, and can build a Registry Policy file from an LGPO text file. (The syntax for LGPO text files is described later in this document.)</p> <p>LGPO.exe has four command-line forms: for importing and applying settings to local policy \u2013 including to Multiple Local Group Policy Objects (MLGPO)1 ; for creating a GPO backup; for parsing a Registry Policy file and outputting \"LGPO\" text; for producing a Registry Policy file from an LGPO text file.</p> <p>All output is written to LGPO.exe's standard output, and all diagnostic and error information is written to its standard error. Both can be redirected to files using standard command shell operations. To support batch file use, LGPO.exe's exit code is 0 on success and non-zero on any error.</p> <p></p> <p><code>LGPO</code> is the most crucial program for our workflow, it is part of the Security Compliance Toolkit (SCT)</p> <p>What is the Local Group Policy Object (LGPO) tool?</p> <p>LGPO.exe - Local Group Policy Object Utility</p> <p></p>"},{"location":"Miscellaneous/Group%20Policy/#how-to-manually-back-up-group-policy-objects-from-a-system-using-lgpoexe","title":"How to manually back up Group Policy Objects from a system using LGPO.exe","text":"<p>Use this command to back up the currently set local group policies to drive <code>C</code></p> <pre><code>.\\LGPO.exe /b C:\n</code></pre>"},{"location":"Miscellaneous/Group%20Policy/#how-to-import-group-policy-objects-from-a-backup-created-using-lgpoexe-to-the-local-system","title":"How to Import Group Policy Objects from a backup, created using LGPO.exe, to the local system","text":"<pre><code>.\\LGPO.exe /g 'Path to the backup'\n</code></pre> <p>Example:</p> <pre><code>.\\LGPO.exe /g 'C:\\{841474E6-33EC-418C-B884-EA0F7C8195DB}'\n</code></pre>"},{"location":"Miscellaneous/Group%20Policy/#how-to-import-only-the-settings-from-a-registry-policy-file-into-computer-machine-configuration","title":"How to Import only the settings from a Registry Policy file into Computer (Machine) Configuration","text":"<p>(This only contains everything in <code>Computer (Machine) Configuration -&gt; Administrative Templates</code> and some policies in <code>Computer Configuration -&gt; Windows Settings</code>)</p> <p>Registry Policy File Format</p> <pre><code>.\\LGPO.exe /m &lt;Path to registry.pol file&gt;\n</code></pre>"},{"location":"Miscellaneous/Group%20Policy/#how-to-import-only-the-security-policies-file-into-computer-machine-configuration","title":"How to Import only the Security policies file into Computer (Machine) Configuration","text":"<p>(This only contains everything in Computer (Machine) Configuration -&gt; Windows Settings =&gt; Security Settings =&gt; everything in the subfolders except for the Advanced Audit Policy Configuration)</p> <p>Security policy settings</p> <pre><code>.\\LGPO.exe /s \".\\GPOX\\DomainSysvol\\GPO\\Machine\\microsoft\\windows nt\\SecEdit\\GptTmpl.inf\"\n</code></pre> <p></p>"},{"location":"Miscellaneous/Group%20Policy/#policy-analyzer","title":"Policy Analyzer","text":"<p>Quoting from the PDF file supplied by Policy Analyzer:</p> <p>Policy Analyzer is a lightweight utility for analyzing and comparing sets of Group Policy Objects (GPOs). It can highlight when a set of Group Policies has redundant settings or internal inconsistencies and can highlight the differences between versions or sets of Group Policies.</p> <p>It can also compare one or more GPOs against local effective state. You can export all its findings to a Microsoft Excel spreadsheet.</p> <p>Policy Analyzer lets you treat a set of GPOs as a single unit, and represents all settings in one or more GPOs in a single \".PolicyRules\" XML file. You can also use .PolicyRules files with LGPO.exe v3.0 to apply those GPOs to a computer's local policy, instead of having to copy GPO backups around.</p> <p>What is the Policy Analyzer tool?</p> <p>Policy Analyzer Tool</p> <p></p>"},{"location":"Miscellaneous/Group%20Policy/#about-compare-to-effective-state","title":"About Compare to Effective State","text":"<p>In Policy Analyzer, there is an option called <code>Compare to Effective State</code>. Quoting from the PDF file that ships with Policy Analyzer program regarding that option:</p> <p>Enable one or more of the Policy Rule sets' checkboxes and click \"Compare to Effective State\" to compare the selected baselines against the local computer's current configured state. The operation will require UAC elevation if any of the selected baselines include security template or advanced auditing settings that require elevation to retrieve.</p> <p>The Policy Viewer will show the combined settings from all the selected Policy Rule sets in one column under the heading \"Baseline(s),\" and the corresponding current settings on the local computer and the logged-on user in a separate column under the heading \"Effective state.\"</p> <p>The effective state settings are also saved to a new .PolicyRules file with a name combining \"EffectiveState_,\" the current computer name, and the current date and time in the format \"yyyyMMdd- HHmmss.\" For example, \"EffectiveState_WKS51279_20200210-183947.PolicyRules.\"</p> <p></p>"},{"location":"Miscellaneous/Group%20Policy/#how-is-group-policy-used-in-this-powershell-script","title":"How is Group Policy used in this PowerShell script?","text":"<ol> <li>The PowerShell script downloads the official Microsoft Security Baselines from Microsoft servers and applies them to the system.</li> <li>It then downloads Group Policies from this GitHub repository, which represent the configurations explained in the main Readme page, and applies them to the system, on top of Microsoft Security Baselines, so where there is a conflict of policy, Hardening script will replace the configurations set by Microsoft Security Baselines.</li> <li>When running the script, near the end you have an option to apply overrides for Microsoft Security Baseline policies and ease some of the applied retrictions, you can find the details of those overrides in here.</li> </ol>"},{"location":"Miscellaneous/Group%20Policy/#how-are-group-policies-for-this-script-created-and-maintained","title":"How are Group Policies for this script created and maintained?","text":""},{"location":"Miscellaneous/Group%20Policy/#how-i-created-them-for-the-first-time","title":"How I created them for the first time","text":"<ol> <li>Installed the newest available Windows build on a fresh Hyper-V VM, fully updated it, created a standard checkpoint.</li> <li>Opened Group Policy editor and started applying security measures described in the Readme page.</li> <li>After completing each category, used <code>LGPO.exe /b C:</code> to backup Group Policies of the system by creating a full GPO.</li> <li>Then I took only files needed from the backup, <code>registry.pol</code> and <code>GptTmpl.inf</code> and put them in a zip file, renamed it to <code>Security-Baselines-X.zip</code></li> </ol>"},{"location":"Miscellaneous/Group%20Policy/#how-i-maintain-them","title":"How I maintain them","text":"<ol> <li>As long as the VM is still using the latest available build of Windows, I use the standard checkpoint I had created to revert the VM back to that new state. If there is a newer build of Windows available, I delete that old VM, download the new Windows ISO file from Microsoft servers, then I create a fresh Hyper-V VM using it.</li> <li>I copy the Group Policy files, <code>registry.pol</code> or <code>GptTmpl.inf</code> to the VM, import them by using <code>.\\LGPO.exe /m \"path\"</code> for <code>registry.pol</code> files or <code>.\\LGPO.exe /s \"path\"</code> for <code>GptTmpl.inf</code> files.</li> <li>Open Group Policy editor and change anything that is needed, once I'm done, I create a full backup of Group Policies of the system using <code>LGPO.exe /b C:</code> command, again take out the modified file, either <code>registry.pol</code> or <code>GptTmpl.inf</code>.</li> <li>Use <code>PolicyAnalyzer</code> to double check everything by comparing the old file with the new one and making sure the correct change is applied.</li> <li>Replace the old Group Policy file with the new file and create a new <code>Security-Baselines-X</code> to upload to the GitHub repository.</li> </ol>"},{"location":"Miscellaneous/Group%20Policy/#we-can-use-policy-analyzer-for-verification-and-comparison","title":"We can use Policy Analyzer for verification and comparison","text":""},{"location":"Miscellaneous/Group%20Policy/#to-verify-the-settings-are-applied-correctly-by-this-script","title":"To verify the settings are applied correctly by this script","text":"<ol> <li> <p>Use folder options in Control Panel or File Explorer to show hidden files and folder.</p> </li> <li> <p>Open Policy Analyzer program, Navigate to Add -&gt; File -&gt; Add files from GPO(s)... -&gt; Browser for this folder \"C:\\Windows\\System32\\GroupPolicy\", Select the folder -&gt; Import -&gt; save the Policy Rules file in <code>\\Documents\\PolicyAnalyzer\\</code></p> </li> <li> <p>Back at the main window, use View/Compare button to view applied Group Policies. The result that you will see is all of the Group Policies that are applied to your system.</p> </li> </ol> <p>Another way to verify the applied Group Policies is to perform the 3 tasks above, what it will give you is the Policy Rules file which is generated from Group Policy state after using the script. If we take this policy rules file to a different machine where we just clean installed Windows and use Policy Analyzer to compare it to the Effective State of the system, we will see what Group Policy settings have changed as a result of using the script.</p> <p></p> <p>Note: At first, when we clean install Windows, the Group Policy folder <code>C:\\Windows\\System32\\GroupPolicy</code> is empty, it will get populated with empty folders and a 1kb file that contains only 1 word, when we first open the local Group Policy editor. It will get more populated with actual policies once we start modifying any group policies.</p> <p></p>"},{"location":"Miscellaneous/Group%20Policy/#how-to-verify-security-baselines-xzip-file-and-100-trust-it","title":"How to verify <code>security-baselines-x.zip</code> file and 100% trust it?","text":"<ol> <li>Download the <code>security-baselines-x.zip</code> file, extract it.</li> <li>Open Policy Analyzer, Navigate to Add -&gt; File -&gt; Select either <code>Add User Configuration (registry.pol)</code> or <code>Add Security Template (*.inf)</code> -&gt; Browser for the folder that was extracted from the <code>security-baselines-x.zip</code>, navigate to the category you want.</li> <li> <p>Select either <code>.pol</code> or <code>.inf</code> file, Import it, give it a name, save it in <code>\\Documents\\PolicyAnalyzer\\</code></p> </li> <li> <p>Back at the main window, use \"Compare to Effective State\" button to view what policies are included in the file.</p> </li> <li> <p>As you will see, everything is according to what has been explicitly stated in the GitHub's Readme page.</p> </li> </ol> <p>You can also use Virus Total website to scan <code>security-baselines-x.zip</code> without downloading it first</p> <p></p>"},{"location":"Miscellaneous/Group%20Policy/#using-csps-configuration-service-providers-and-provisioning-packages-work-in-progress","title":"Using CSPs, Configuration service providers and provisioning packages (work in progress)","text":"<p>This command gets the information about all installed provisioning packages on your system.</p> <pre><code>Get-ProvisioningPackage -AllInstalledPackages\n</code></pre> <p>Configuration service providers for IT pros</p> <p>Settings changed when you uninstall a provisioning package</p> <p>Why Intune and CSPs are the future of Windows management instead of Group Policy</p> <p>Link to Microsoft Employee's comment</p> <p>Download Windows Configuration Designer from Microsoft Store or from Windows ADK or from Windows insiders ADK, to easily create provisioning packages for your device(s)</p> <p>You can use gpresult to see more info about Group Policies on your computer</p> <pre><code># What policies are applied to your computer:\ngpresult /z\n# or\ngpresult /v\n# What policies are applied to the current user:\ngpresult /scope user /v\n</code></pre> <p>We can manually backup and restore Group Policy settings by copying this folder and all of its content:</p> <p><code>C:\\Windows\\System32\\GroupPolicy</code></p>"},{"location":"Miscellaneous/How%20to%20compact%20your%20OS%20and%20free%20up%20extra%20space/","title":"How to compact your OS and free up extra space","text":""},{"location":"Miscellaneous/How%20to%20compact%20your%20OS%20and%20free%20up%20extra%20space/#how-to-compact-your-os-and-free-up-extra-space","title":"How to compact your OS and free up extra space","text":""},{"location":"Miscellaneous/How%20to%20compact%20your%20OS%20and%20free%20up%20extra%20space/#run-the-following-commands-in-an-elevated-powershell","title":"Run the following commands in an elevated PowerShell","text":"<p>To turn on CompactOS:</p> <pre><code>Compact.exe /CompactOS:always\n</code></pre> <p>To turn off CompactOS:</p> <pre><code>Compact.exe /CompactOS:never\n</code></pre> <p>To Query whether CompactOS is on or off:</p> <pre><code>Compact.exe /CompactOS:Query\n</code></pre> <p></p> <p>Source</p>"},{"location":"Miscellaneous/Hyper%20V/","title":"Hyper-V Tips and Tricks","text":""},{"location":"Miscellaneous/Hyper%20V/#how-to-import-and-export-tpm-enabled-hyper-v-vm-certificates-with-powershell","title":"How to Import and Export TPM-enabled Hyper-V VM certificates with PowerShell","text":"<p>TPM requirement, which is a great security feature, was added to Windows 11. On the host, it is managed by the OS and UEFI, but when you create a Virtual Machine (VM) that runs an OS like Windows 11, you have to know how to manage it properly so that your VM will stay secure everywhere and you will maintain your access to your VM even if you import/export it to a different Hyper-V host or reinstall your host OS.</p> <p>Here is a screenshot of my Hyper-V VM on Windows 11 with the following security features enabled:</p> <ol> <li>Secure Boot</li> <li>Trusted Platform Module (TPM)</li> </ol> <p></p> <p>When a VM uses TPM, Windows creates 2 certificates in the <code>Local Machine Certificate Store =&gt; Shielded VM Local Certificates =&gt; Certificates</code></p> <p>One of them is for encryption and the other one is for signing. They both contain private keys. If these 2 certificates don't exist in that folder in the Local Machine Certificate store of a Hyper-V host, your VM won't be able to start</p> <p>What you need to do is to export those 2 certificates (with private keys) and store them in a safe place (such as OneDrive's personal Vault) as a backup.</p> <p>If you completely reinstall Windows or move the VMs to a different Hyper-V host and Import the certificates, you will be able to continue using your VMs, but when you create new TPM enabled VMs on the new host, 2 more certificates will be added  to the <code>Local Machine Certificate Store =&gt; Shielded VM Local Certificates =&gt; Certificates</code>, so you will have 4 certificates in total, 2 of which are tied to your old VMs and the other 2 are tied to the new VMs. Each generated certificate has 10 years expiry date from the time it was created.</p> <p></p> <p>You can Import/Export the certificates using GUI, but here I'm going to show how to automate it using PowerShell:</p>"},{"location":"Miscellaneous/Hyper%20V/#export-all-the-available-host-guardian-service-certificates-with-private-keys-and-extended-properties","title":"Export all the available Host Guardian service certificates with private keys and extended properties","text":"<pre><code>$CertificatePassword = ConvertTo-SecureString -String \"hotcakex\" -Force -AsPlainText\nGet-Item \"Cert:\\LocalMachine\\Shielded VM Local Certificates\\*\" | ForEach-Object {\nExport-PfxCertificate -Cert $_ -FilePath \".\\$($_.Issuer)-$($_.Thumbprint).pfx\" -Password $CertificatePassword -CryptoAlgorithmOption AES256_SHA256}\n</code></pre>"},{"location":"Miscellaneous/Hyper%20V/#import-the-certificates-with-private-keys","title":"Import the certificates with private keys","text":"<pre><code>$ShieldedCertsPath = 'Cert:\\LocalMachine\\Shielded VM Local Certificates'\nif (-NOT (Test-Path $ShieldedCertsPath)) { New-Item -Path 'Cert:\\LocalMachine' -Name 'Shielded VM Local Certificates' -Force }\n$CertificatePassword = ConvertTo-SecureString -String \"hotcakex\" -Force -AsPlainText\n$CertificateLocation = \"C:\\Users\\HotCakeX\\OneDrive\\Desktop\\Hyper-V Guardian certificates\\*.pfx\"\nget-item $CertificateLocation | ForEach-Object {\nImport-PfxCertificate -FilePath $_ -CertStoreLocation $ShieldedCertsPath -Password $CertificatePassword -Exportable\n}\n</code></pre> <p>You should change the values for <code>$CertificateLocation</code> and <code>$CertificatePassword</code> varaibles according to your own needs and environment.</p> <ul> <li> <p>You can find more info about those commands here:</p> </li> <li> <p>Import-PfxCertificate</p> </li> <li>Export-PfxCertificate</li> </ul> <p></p> <p></p> <p></p>"},{"location":"Miscellaneous/Hyper%20V/#how-to-enable-nested-virtualization-for-all-the-vms-on-the-hyper-v-host","title":"How to enable Nested Virtualization for all the VMs on the Hyper-V host","text":"<p>Source:</p> <p>https://learn.microsoft.com/en-us/virtualization/hyper-v-on-windows/user-guide/nested-virtualization</p> <p>The command is this</p> <pre><code>Set-VMProcessor -VMName &lt;VMName&gt; -ExposeVirtualizationExtensions $true\n</code></pre> <p>but in order to automatically enable nested virtualization for all VMs, this is how I do it</p> <p>Note</p> <p>All of the VMs must be in Off state when enabling nested virtualization</p> <pre><code>(Get-VM).name | ForEach-Object {Set-VMProcessor -VMName $_ -ExposeVirtualizationExtensions $true}\n</code></pre> <p>This is how to verify nested virtualization is enabled for all of your VMs</p> <pre><code>(Get-VM).name | ForEach-Object {get-VMProcessor -VMName $_} | Select-Object -Property VMName,ExposeVirtualizationExtensions\n</code></pre> <p></p> <p></p> <p></p>"},{"location":"Miscellaneous/Hyper%20V/#confidential-computing-on-azure","title":"Confidential Computing on Azure","text":"<p>Azure confidential computing makes it easier to trust the cloud provider, by reducing the need for trust across various aspects of the compute cloud infrastructure. Azure confidential computing minimizes trust for the host OS kernel, the hypervisor, the VM admin, and the host admin.</p>"},{"location":"Miscellaneous/Hyper%20V/#continue-reading","title":"Continue reading","text":"<ul> <li> <p>https://learn.microsoft.com/en-us/azure/confidential-computing/overview-azure-products</p> </li> <li> <p>https://azure.microsoft.com/en-us/solutions/confidential-compute/</p> </li> </ul> <p></p>"},{"location":"Miscellaneous/Hyper%20V/#shielded-vms-are-deprecated-concepts","title":"Shielded VMs are deprecated concepts","text":"<p>They are deprecated starting with Windows Server 2022.. They were prone to modern attacks such as side-channel.</p> The following details about Shielded VMs are old and no longer valid <p></p> <ul> <li>Shielded VMs can't be simply moved to another Hyper-V host and used there, nor can they be de-shielded in another       host, if the certificate is not in place on the new host. This results in the error \"the key protector could not be       unwrapped\", which is desired.</li> <li>Shielding a VM is for keeping bad actors or malware out of the VM, not for keeping malware inside VM. i.e., Shielding       a VM is for keeping the VM secure, not for keeping the host secure.</li> <li>You can use the command below to get details about your Hyper-V host, including checks whether your host runs in      local/standalone mode or is part of a Guarded Fabric</li> </ul> <pre><code>HgsClientConfiguration\n</code></pre> <p></p> <p>Note that this configuration is for standalone systems. an actual shielded virtual machine is a lot more secure because       the host's security and health is properly attested in a Guarded Fabric, using Host Guardian Service (HGS)      on a Windows Server.</p> <ul> <li> <p>Here is an official video about the feature and how it protects your VMs:</p> <ul> <li> <p>Introduction to Shielded Virtual Machines in Windows Server 2016 - YouTube</p> </li> <li> <p>Microsoft Mechanics</p> </li> </ul> </li> </ul> <p></p> <p></p> <p></p>"},{"location":"Miscellaneous/Hyper%20V/#scenario-hyper-v-enhanced-session-mode-no-authentication-in-the-vms-os","title":"Scenario: Hyper-V, Enhanced session mode, no authentication in the VM's OS","text":"<p>When you create a VM in Hyper-V that doesn't have any authentication method for login such as Password or PIN, and use Enhanced session-mode to connect to it, there might be an issue where the RDP disconnects once after each restart of the VM and Hyper-V virtual machine connection asks you to connect to the VM again by clicking/tapping on the connect button. To fix this, set a local password for the user account of the OS in VM.</p> <p></p> <p></p> <p></p>"},{"location":"Miscellaneous/Hyper%20V/#native-boot-hyper-v-vms-vhdx","title":"Native boot Hyper-V VMs, VHDX","text":"<p>There are guides for native booting a VHDX and it's very easy to do. If you already have a Hyper-V VM, you can add it to the Windows boot manager so that during a reboot you will have the option to boot the VHDX.</p>"},{"location":"Miscellaneous/Hyper%20V/#you-need-to-pay-attention-to-a-few-things-though","title":"You need to pay attention to a few things though:","text":"<ol> <li> <p>The VHDX should be on a drive that is NTFS formatted, for now booting from ReFS is not supported.</p> </li> <li> <p>The drive that hosts the VHDX file must have more free space than the assigned size of the VHDX. The size you see in the file explorer is not the same as the size of the disk you assigned to the VHDX when creating it. It's easier if you have a fixed size VHDX instead of a dynamically expanding one. To find the real size of the VHDX, you can boot it in Hyper-V and check the drives inside it.</p> </li> <li> <p>Merge all checkpoints and delete them before attempting to native boot VHDX.</p> </li> </ol> <p></p>"},{"location":"Miscellaneous/Hyper%20V/#vhdx-native-booting-is-very-easy-and-flexible-you-can-do-it-even-if","title":"VHDX native booting is very easy and flexible, you can do it even if:","text":"<ol> <li> <p>Your host has Secure boot enabled</p> </li> <li> <p>You use Signed WDAC policies</p> </li> <li> <p>Your VM wasn't SysPrepped before natively booting it on physical machine</p> </li> <li> <p>VM has secure boot and TPM</p> </li> </ol> <p></p>"},{"location":"Miscellaneous/Hyper%20V/#how-to-make-the-vhdx-bootable","title":"How to make the VHDX bootable:","text":"<ol> <li>Double-click/tap on the VHDX file to mount it</li> <li>Run this in CMD or PowerShell</li> </ol> <pre><code>bcdboot D:\\Windows /d\n</code></pre> <p>Tip</p> <p>Bcdboot</p> <p>Use the /d option to preserve the existing boot order.</p> <p></p>"},{"location":"Miscellaneous/Hyper%20V/#verify-the-change-by-running-this-command","title":"Verify the change by running this command","text":"<pre><code>bcdedit /enum\n</code></pre> <p>Tip</p> <p>Bcdedit</p> <p></p> <p>The description of the boot entry is the same one you see during OS selection menu. You can change it with this command in PowerShell:</p> <pre><code>bcdedit /set '{default}' description 'VHDX Boot'\n</code></pre> <p>or in CMD:</p> <pre><code>bcdedit /set {default} description 'VHDX Boot'\n</code></pre> <p>If <code>{default}</code> is not the correct identifier, then change it according to the result of the <code>bcdedit /enum</code></p> <p>There are three different identifiers: The chosen default OS has identifier {default}, the current OS you are signed in at the moment is {current}. All other entries have a long hexadecimal identifier.</p> <p></p> <p></p> <p></p>"},{"location":"Miscellaneous/Hyper%20V/#some-hyper-v-nested-virtualization-screenshots","title":"Some Hyper-V nested virtualization screenshots","text":"<p>To display how optimized and powerful Hyper-V hypervisor is (including any feature that runs on it such as Windows Sandbox, WSL, WSA, MDAG and more), here are some screenshots taken on a very old hardware, hardware that is not even officially supported by Windows 11, yet you can virtualize 5 operation systems nested in each other, and the last nested virtualized OS still has full functionality including direct file copy from host to guest, full Internet connectivity, ability to listen to music, do tasks and so on.</p>"},{"location":"Miscellaneous/Hyper%20V/#hardware-specs-all-from-2016-2017-couldnt-find-any-older-to-test","title":"Hardware specs - All from 2016-2017, couldn't find any older to test","text":"<ol> <li>CPU: Intel Core I7 7700k</li> <li>RAM: 16GB</li> <li>GPU: N/A (Intel IGPU)</li> <li>SSD: 256 GB M.2</li> </ol>  Click/Tap here to see the screenshots"},{"location":"Miscellaneous/Overrides%20for%20Microsoft%20Security%20Baseline/","title":"Optional overrides for Microsoft Security Baseline","text":"<p>Here are the overrides that can be optionally applied by the script to bring back the functionalities that are disabled as the result of applying Microsoft Security Baseline for Windows 11 22H2</p> <p></p>"},{"location":"Miscellaneous/Overrides%20for%20Microsoft%20Security%20Baseline/#1-windows-game-recording-and-broadcasting","title":"1. Windows Game Recording and Broadcasting","text":"<p>This setting enables or disables the Windows Game Recording and Broadcasting features. If you disable this setting, Windows Game Recording will not be allowed. If the setting is enabled or not configured, then Recording and Broadcasting (streaming) will be allowed.</p> <p>Policy path:</p> <pre><code>Computer Configuration\\Administrative Templates\\Windows Components\\Windows Game Recording and Broadcasting\n</code></pre> <p></p>"},{"location":"Miscellaneous/Overrides%20for%20Microsoft%20Security%20Baseline/#2-prohibit-use-of-internet-connection-sharing-on-your-dns-domain-network","title":"2. Prohibit use of Internet Connection Sharing on your DNS domain network","text":"<p>Determines whether administrators can enable and configure the Internet Connection Sharing (ICS) feature of an Internet connection and if the ICS service can run on the computer.</p> <p>ICS lets administrators configure their system as an Internet gateway for a small network and provides network services, such as name resolution and addressing through DHCP, to the local private network.</p> <p>If you enable this setting, ICS cannot be enabled or configured by administrators, and the ICS service cannot run on the computer. The Advanced tab in the Properties dialog box for a LAN or remote access connection is removed. The Internet Connection Sharing page is removed from the New Connection Wizard. The Network Setup Wizard is disabled.</p> <p>If you disable this setting or do not configure it and have two or more connections, administrators can enable ICS. The Advanced tab in the properties dialog box for a LAN or remote access connection is available. In addition, the user is presented with the option to enable Internet Connection Sharing in the Network Setup Wizard and Make New Connection Wizard. (The Network Setup Wizard is available only in Windows XP Professional.)</p> <p>By default, ICS is disabled when you create a remote access connection, but administrators can use the Advanced tab to enable it. When running the New Connection Wizard or Network Setup Wizard, administrators can choose to enable ICS.</p> <p>Note: Internet Connection Sharing is only available when two or more network connections are present.</p> <p>Note: When the \"Prohibit access to properties of a LAN connection,\" \"Ability to change properties of an all user remote access connection,\" or \"Prohibit changing properties of a private remote access connection\" settings are set to deny access to the Connection Properties dialog box, the Advanced tab for the connection is blocked.</p> <p>Note: Nonadministrators are already prohibited from configuring Internet Connection Sharing, regardless of this setting.</p> <p>Note: Disabling this setting does not prevent Wireless Hosted Networking from using the ICS service for DHCP services. To prevent the ICS service from running, on the Network Permissions tab in the network's policy properties, select the \"Don't use hosted networks\" check box.</p> <p>Policy path:</p> <pre><code>Computer Configuration\\Administrative Templates\\Network\\Network Connections\\Prohibit use of Internet Connection Sharing on your DNS domain network\n</code></pre> <p></p>"},{"location":"Miscellaneous/Overrides%20for%20Microsoft%20Security%20Baseline/#3-firewall-local-rule-merging","title":"3. Firewall local rule merging","text":"<p>This can prevent Hyper-V default switch from working properly, please see this forum post on Microsoft Tech Community for more info:</p> <p>The Group policy that we change back to default values are located in: Computer Configuration -&gt; Windows Settings -&gt; Security Settings -&gt; Windows Firewall with Advanced Security -&gt; Windows Firewall with Advanced Security -&gt; Windows Firewall Properties -&gt; Public Profile Tab -&gt; Settings (select Customize) -&gt; Rule merging, \"Apply local connection security rules:\" to \"No\".</p> <p>Here is a screenshot:</p> <p></p> <p></p> <p>Policy path:</p> <pre><code>Computer Configuration\\Windows Settings\\Security Settings\\Windows Defender Firewall with Advanced Security\\\n</code></pre> <p></p>"},{"location":"Miscellaneous/Overrides%20for%20Microsoft%20Security%20Baseline/#4-deny-write-access-to-removable-drives-not-protected-by-bitlocker","title":"4. Deny write access to removable drives not protected by Bitlocker","text":"<p>Disabling this policy because it can cause inconvenience and if your flash drive is Bitlocker encrypted, It can't be used as a bootable Windows installation USB flash drive.</p> <p>Policy path:</p> <pre><code>Computer Configuration\\Administrative Templates\\Windows Components\\BitLocker Drive Encryption\\Removable Data Drives\\Deny write access to removable drives not protected by BitLocker\n</code></pre> <p></p>"},{"location":"Miscellaneous/Overrides%20for%20Microsoft%20Security%20Baseline/#5-set-the-status-of-these-4-xbox-services-back-to-their-default-states","title":"5. Set the status of these 4 Xbox services back to their default states","text":"<p><code>XboxGipSvc</code>, <code>XblAuthManager</code>,<code>XblGameSave</code>,<code>XboxNetApiSvc</code></p> <p>Microsoft Security Baseline sets their status to disabled.</p> <p>Policy path:</p> <pre><code>Computer Configuration\\Windows Settings\\\n</code></pre> <p></p>"},{"location":"Miscellaneous/Overrides%20for%20Microsoft%20Security%20Baseline/#6-enable-clipboard-and-drive-redirection-when-using-remote-desktop-connection","title":"6. Enable Clipboard and Drive redirection when using Remote Desktop connection","text":"<p>It is necessary when using Hyper-V VM Enhanced session mode and you want to copy items between guest and host OS.</p> <p>Policy path:</p> <pre><code>Computer Configuration\\Administrative Templates\\Windows Components\\Remote Desktop Services\\Remote Desktop Session Host\\Device and Resource Redirection\\\n</code></pre> <p></p>"},{"location":"Miscellaneous/Overrides%20for%20Microsoft%20Security%20Baseline/#7-enable-the-xblgamesave-standby-task","title":"7. Enable the XblGameSave Standby Task","text":"<p>The scheduled task is disabled as a result of applying the Microsoft Security Baselines. The Harden Windows Security script in the Optional Overrides category enables it again and sets its status back to the default state. The task syncs Xbox game saves on PC.</p> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes%20Part%202/","title":"Basic PowerShell tricks and notes Part 2","text":"<p>This page is part 2 of the Basic PowerShell tricks and notes series. You can find the part 1 here.</p> <p>Designed for beginners and newcomers to PowerShell who want to quickly learn the essential basics, the most frequently used syntaxes, elements and tricks. It should help you jump start your journey as a PowerShell user.</p> <p>The main source for learning PowerShell is Microsoft Learn websites. There are extensive and complete guides about each command/cmdlet with examples.</p> <p>PowerShell core at Microsoft Learn</p> <p>Also Use Bing Chat for your PowerShell questions. The AI is fantastic at creating code and explaining everything.</p> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes%20Part%202/#view-all-predictive-intellisense-suggestions-based-on-past-history","title":"View all Predictive IntelliSense suggestions based on past history","text":"<p>Press F2 to see the complete list of the Predictive IntelliSense suggestions as you type on the PowerShell console.</p> <p>More info</p> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes%20Part%202/#where-is-the-powershell-command-history-stored","title":"Where is the PowerShell command history stored?","text":"<p>In this directory</p> <p><code>$env:USERPROFILE\\AppData\\Roaming\\Microsoft\\Windows\\PowerShell\\PSReadLine</code></p> <p>There is a file called <code>ConsoleHost_history.txt</code> and it contains the history of all the commands you've ever typed in PowerShell on your device. If you want to clear it, open the file, delete all of its content. If PowerShell is already open, close and reopen it to see the change.</p> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes%20Part%202/#how-to-clear-the-automatic-error-variable-in-powershell","title":"How to clear the automatic error variable in PowerShell","text":"<pre><code>$error.clear()\n</code></pre>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes%20Part%202/#how-to-get-the-last-error-type-in-powershell","title":"How to get the last error type in PowerShell","text":"<pre><code>$Error[0].Exception.GetType().FullName\n</code></pre>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes%20Part%202/#how-to-display-all-environment-variables-and-their-values-in-powershell","title":"How to display all environment variables and their values in PowerShell","text":"<pre><code>gci env:\n</code></pre> <ul> <li> <p>The <code>env:</code> drive is a PowerShell provider that exposes the environment variables as a hierarchical file system.</p> </li> <li> <p>The <code>gci</code> command is an alias for the <code>Get-ChildItem</code> cmdlet.</p> </li> </ul> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes%20Part%202/#list-all-mscs-and-cpls-for-microsoft-management-console-and-control-panels-in-powershell","title":"List all MSCs and CPLs for Microsoft Management Console and Control Panels in PowerShell","text":"<pre><code>Get-ChildItem -Path C:\\Windows\\system32\\* -Include *.msc, *.cpl | Sort-Object -Property Extension | Select-Object -Property Name | Format-Wide -Column 2\n</code></pre>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes%20Part%202/#how-to-mount-the-efi-system-partition","title":"How to mount the EFI system partition?","text":"<pre><code>mountvol u: /s\n</code></pre> <p>This isn't a native PowerShell cmdlet, it uses mountvol CLI.</p> <p>With that command you can mount the EFI partition and assign the letter <code>U</code> to it, it will appear in This PC. You can browse it in PowerShell as admin.</p> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes%20Part%202/#how-to-check-if-a-file-is-in-use-in-powershell","title":"How to check if a file is in use in PowerShell?","text":"<p>Here is an example function that tries to rename files given to it with the same names and if it was successful, it will consider that file not in use.</p> <pre><code>function IsFileAccessible {\nparam ([System.String]$FullFileName)    \n[System.Boolean]$IsAccessible = $false\ntry {\nRename-Item $FullFileName $FullFileName -ErrorVariable LockError -ErrorAction Stop\n$IsAccessible = $true\n}\ncatch {\n$IsAccessible = $false\n}\nreturn $IsAccessible, $FullFileName\n}\n</code></pre> <p>You can use it like this:</p> <pre><code>(Get-ChildItem -Path 'C:\\Program Files\\Windows Defender' -Filter '*.exe*').FullName | ForEach-Object { IsFileAccessible -FullFileName $_ }\n</code></pre> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes%20Part%202/#choosing-between-powershell-and-powershell-preview","title":"Choosing between PowerShell and PowerShell Preview","text":"<p>Use PowerShell Preview if you want to test new features and don't need to call PowerShell with its alias, pwsh, from CMD. If you do need to call it like that, use PowerShell stable.</p> <p>Use cases for it are when you need to use <code>pwsh.exe</code> in Windows Task Scheduler.</p> <p>PowerShell Preview by default doesn't set its <code>pwsh.exe</code> available system wide, the path to that file isn't added to the system environment variables, only PowerShell stable does that, but of course if you want to use PowerShell preview you can manually modify the PATH environment variable to have <code>pwsh.exe</code> of PowerShell Preview be available system wide.</p> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes%20Part%202/#variable-types-in-powershell","title":"Variable types in PowerShell","text":"<p>PowerShell variables can have types and type accelerator. The following command lists all of the types and their equivalent type accelerators. The fully qualified type names replace implicit with explicit.</p> <pre><code>[PSObject].Assembly.GetType('System.Management.Automation.TypeAccelerators')::Get\n</code></pre> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes%20Part%202/#success-codes-and-error-codes","title":"Success codes and error codes","text":"<p>In PowerShell, or for programming languages in general, 0 = success, 1 or anything else means failure/error.</p> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes%20Part%202/#how-to-get-the-names-and-appids-of-installed-apps-of-the-current-user-in-powershell","title":"How to get the names and AppIDs of installed apps of the current user in PowerShell?","text":"<pre><code>Get-StartApps\n</code></pre> <p>More info</p> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes%20Part%202/#difference-between-async-and-sync","title":"Difference between Async and Sync","text":"<p>Async is faster than Sync</p> <ul> <li> <p>Sync = waits for the previous task to finish before starting a new one</p> </li> <li> <p>Async = starts multiple tasks simultaneously</p> </li> </ul> <p>PowerShell supports sync/async commands workflows, also known as parallel.</p> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes%20Part%202/#how-to-enable-a-disabled-event-log-using-powershell","title":"How to enable a disabled event log using PowerShell","text":"<p>First we create a new\u202f<code>EventLogConfiguration</code>\u202fobject and pass it the name of the log we want to configure, then we set it to enabled and save the changes.</p> <pre><code>$logName = 'Microsoft-Windows-DNS-Client/Operational'  \n$log = New-Object System.Diagnostics.Eventing.Reader.EventLogConfiguration $logName \n$log.IsEnabled=$true \n$log.SaveChanges() \n</code></pre> <p>We can confirm the change by running this command:</p> <pre><code>Get-WinEvent -ListLog Microsoft-Windows-DNS-Client/Operational | Format-List *\n</code></pre> <p>Using the same method we can configure many other options of the log file, just take a look at the\u202f<code>EventLogConfiguration</code> Class\u202ffor a list of configurable properties.</p> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes%20Part%202/#find-the-current-users-username-in-powershell","title":"Find the current user's username in PowerShell","text":"<pre><code>[Environment]::UserName\u202f\n</code></pre> <pre><code>$env:username\u202f \n</code></pre> <pre><code>whoami\u202f\n</code></pre> <pre><code>[System.Security.Principal.WindowsIdentity]::GetCurrent().Name \n</code></pre> <p>Most secure way</p> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes%20Part%202/#how-to-access-properties-of-an-object-in-powershell","title":"How to access properties of an object in PowerShell","text":"<p>For example, you can first assign the entire object to a variable:</p> <pre><code>$Preferences = Get-MpPreference \n</code></pre> <p>Then call properties of that variable</p> <pre><code>$Preferences.PUAProtection \n</code></pre> <p>Another method is this:</p> <pre><code>$(Get-MpPreference).puaprotection\n</code></pre> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes/","title":"Basic PowerShell tricks and notes","text":"<p>This page is designed for beginners and newcomers to PowerShell who want to quickly learn the essential basics, the most frequently used syntaxes, elements and and tricks. It should help you jump start your journey as a PowerShell user.</p> <p>The main source for learning PowerShell is Microsoft Learn websites. There are extensive and complete guides about each command/cmdlet with examples.</p> <p>PowerShell core at Microsoft Learn</p> <p>Also Use Bing Chat for your PowerShell questions. The AI is fantastic at creating code and explaning everything.</p> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes/#pipeline-variable","title":"Pipeline variable","text":"<p><code>$_</code>  is the variable for the current value in the pipeline.</p> <p>Examples</p> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes/#filtering-with-where-object","title":"Filtering with Where-Object","text":"<p><code>?</code> which is an alias for <code>Where-Object</code>, is used to filter all the data given to it.</p> <p>Where-Object</p> <p>Example</p> <pre><code>Get-PSDrive | ?{$_.free -gt 1} \n</code></pre> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes/#show-the-properties-of-an-object-selectively","title":"Show the properties of an object selectively","text":"<p><code>Select</code> or <code>Select-Object</code> show the properties that we want to see from an object</p> <p>If we use <code>*</code> then all of the properties will be shown and from there we can choose which properties to add.</p> <p>Example:</p> <pre><code>Get-PSDrive | ?{$_.free -gt 1} | select * \nGet-PSDrive | ?{$_.free -gt 1} | select root, used, free\n</code></pre> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes/#looping-using-foreach-object","title":"Looping using ForEach-Object","text":"<p><code>ForEach-Object { }</code></p> <p>The <code>ForEach-Object</code> cmdlet performs an operation on each item in a collection of input objects. The input objects can be piped to the cmdlet or specified using the InputObject parameter.</p> <p>i.e. For every item in the pipe, run this line.</p> <p>Examples:</p> <pre><code>Get-PSDrive | ?{$_.free -gt 1} | select root, used, free | ForEach-Object{\"zebra\"} \n</code></pre> <pre><code>Get-PSDrive | ?{$_.free -gt 1} | select root, used, free | ForEach-Object{ Write-Host \"Free Space for \" $_.Root \"is\" ($_.free/1gb )} \n</code></pre> <p>The parenthesis, <code>($_.free/1gb )</code> must be there if we want to modify one of the output strings.</p> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes/#to-get-online-help-about-any-cmdlet","title":"To get online help about any Cmdlet","text":"<p>Opens the webpage for the specified command</p> <p><code>Get-help cmdlet \u2013online</code></p> <p>Example:</p> <p><code>Get-Help ForEach-Object \u2013online</code></p> <p><code>Get-Help dir \u2013online</code></p> <p>Shows the full help on the PowerShell console</p> <p><code>Get-help get-service -full</code></p> <p>Opens a new window showing the full help content and offers other options such as Find</p> <p><code>Get-help get-service -ShowWindow</code></p> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes/#to-query-windows-services","title":"To Query Windows services","text":"<p>This gets any Windows service that has the word \"Xbox\" in it.</p> <p><code>Get-service \"*xbox*\"</code></p> <p>This gets any Windows service that has the word \"x\" in it.</p> <p><code>Get-service \"*x*\"</code></p> <p>Putting <code>*</code> around the word or letter finds anything that contains it.</p> <p><code>Get-service \"*x*\" | sort-object status</code></p> <p>Example syntax:</p> <pre><code>Get-Service [[-Name] &lt;System.String[]&gt;] [-ComputerName &lt;System.String[]&gt;] [-DependentServices] [-Exclude &lt;System.String[]&gt;] [-Include &lt;System.String[]&gt;] [-RequiredServices] [&lt;CommonParameters&gt;] \n</code></pre> <p>In this part</p> <pre><code>Get-Service [[-Name] &lt;System.String[]&gt;] \n</code></pre> <p>The <code>-Name</code> Parameter accepts <code>&lt;System.String[]&gt;</code>, which is a StringList, and when [] is included, that means there can be multiple inputs/strings, separated by comma <code>,</code>.</p> <p>So <code>[[-Name] &lt;System.String[]&gt;]</code> can be used like this:</p> <pre><code>Get-Service -Name WinRM,BITS,*Xbox*\n</code></pre> <p>Also in another similar example syntax:</p> <pre><code>Get-Service [-ComputerName &lt;System.String[]&gt;] [-DependentServices] -DisplayName &lt;System.String[]&gt; [-Exclude &lt;System.String[]&gt;] [-Include &lt;System.String[]&gt;] [-RequiredServices] [&lt;CommonParameters&gt;]\n</code></pre> <p>Everything is inside a bracket except for -DisplayName, that means it is mandatory. If a parameter is inside a bracket, that means it is optional.</p> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes/#how-to-suppress-errors-in-powershell","title":"How to suppress errors in PowerShell","text":"<pre><code>-ErrorAction SilentlyContinue \n</code></pre> <p>Everything you wanted to know about exceptions</p> <p>Try/Catch will only 'trigger' on a terminating exception. Most cmdlets in PowerShell, by default, won't throw terminating exceptions. You can set the error action with the\u202f-ErrorAction\u202for -ea parameters:</p> <pre><code>Do-Thing 'Stuff' -ErrorAction Stop \n</code></pre> <p>Careful when using <code>-ErrorAction Stop</code>, If using it in loops like with <code>ForEach-Object</code>, then it will stop the entire loop after the first encounter of error.</p> <p>Handling Errors the PowerShell Way</p> <p>Tip: If you set</p> <pre><code>$ErrorActionPreference = 'Stop'\n</code></pre> <p>In your PowerShell code, either locally or globally for the entire script, <code>Write-Error</code> will cause the script to stop because it will be like throwing an error.</p> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes/#get-file-signature-of-all-the-files-in-a-folder","title":"Get file signature of all the files in a folder","text":"<p>This will check all of the files in the current directory and show an error for folders, you can add <code>-ErrorAction SilentlyContinue</code> to the <code>Get-AuthenticodeSignature</code> cmdlet to ignore the errors.</p> <pre><code>Get-ChildItem | ForEach-Object -Parallel {Get-AuthenticodeSignature $_.Name}\n</code></pre> <p>This will recursively check only the files in the current directory and sub-directories, no folder is piped.</p> <pre><code>Get-ChildItem -Recurse -File | ForEach-Object -Parallel {Get-AuthenticodeSignature $_.Name}\n</code></pre> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes/#write-output-to-a-file-or-string","title":"Write output to a file or string","text":"<pre><code>&gt; output.txt \n</code></pre> <p>Example:</p> <pre><code>ipconfig /all &gt; mynetworksettings.txt \n</code></pre> <p>about_Redirection</p> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes/#how-to-add-delaypause-to-the-execution-of-powershell-script","title":"How to add delay/pause to the execution of Powershell script","text":"<p>To sleep a PowerShell script for 5 seconds, you can run the following command</p> <pre><code>Start-Sleep -Seconds 5\n</code></pre> <p>You can also use the <code>-milliseconds</code> parameter to specify how long the resource sleeps in milliseconds.</p> <pre><code>Start-Sleep -Milliseconds 25\n</code></pre> <p>Start-Sleep</p> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes/#how-to-stopkill-a-a-process-or-exe-executable-in-powershell","title":"How to stop/kill a a process or (.exe) executable in Powershell","text":"<p>Using native PowerShell cmdlet</p> <pre><code>Stop-Process -Name \"Photoshop\"\n</code></pre> <p>Stop-Process</p> <p>Using <code>taskkill.exe</code></p> <pre><code>taskkill /IM \"photoshop app.exe\" /F \n</code></pre> <p>taskkill</p> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes/#automatically-answer-yes-to-a-prompt-in-powershell","title":"Automatically answer \u201cyes\u201d to a prompt in Powershell","text":"<p>Use <code>\u2013force</code> at the end of the command</p> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes/#displays-all-information-in-the-current-access-token","title":"Displays all information in the current access token","text":"<p>The command below displays all information in the current access token, including the current user name, security identifiers (SID), privileges, and groups that the current user belongs to.</p> <pre><code>whoami /all\n</code></pre> <p>whoami</p> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes/#display-all-the-tcp-and-udp-ports-on-which-the-computer-is-listening","title":"Display all the TCP and UDP ports on which the computer is listening","text":"<pre><code>netstat -a \n</code></pre> <p>netstat</p> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes/#copy-the-result-of-a-command-to-clipboard-automatically","title":"Copy the result of a command to clipboard automatically","text":"<p>Add <code>| clip</code> at the end the command</p> <p>Example:</p> <pre><code>Get-TimeZone | clip\n</code></pre> <p>Example:</p> <pre><code>rg -i -F URL: | clip\n</code></pre> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes/#how-to-scan-2-text-files-for-differences-and-pipe-the-difference-to-a-third-file","title":"How to scan 2 text files for differences and pipe the difference to a third File","text":"<pre><code>$File1 = \"C:\\Scripts\\Txt1.txt\" \n$File2 = \"C:\\Scripts\\Txt2.txt\" \n$Location = \"C:\\Scripts\\Txt3.txt\" \nCompare-Object (get-content $File1) (get-content $File2) | format-list | Out-File $Location \n</code></pre> <p>Compare-Object</p> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes/#difference-between-strings-and-stringlists","title":"Difference between Strings and StringLists","text":"<p>This is Stringlist in PowerShell:</p> <p><code>[String[]]</code></p> <p>And this is a string  </p> <p><code>[String]</code></p> <p>When we define Stringlist in a parameter, then the argument will keep asking for multiple values instead of 1, if we want to stop adding arguments for the parameter, we have to enter twice.</p> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes/#how-to-run-a-powershell-ps1-script","title":"How to run a PowerShell (.ps1) script ?","text":"<ul> <li>Method 1:</li> </ul> <pre><code>&amp;\"Path\\To\\PS\\Script.ps1\"\n</code></pre> <p>Using the <code>&amp;</code> Call operator</p> <ul> <li>Method 2:</li> </ul> <pre><code>Set-Location 'Path\\To\\Folder\\OfThe\\Script'\n.\\Script.ps1\n</code></pre> <ul> <li>Method 3</li> </ul> <pre><code>pwsh.exe -File 'Path\\To\\Folder\\OfThe\\Script.ps1'\n</code></pre> <p>This example uses PowerShell Core</p> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes/#enclosing-strings-that-have-a-lot-of-single-and-double-quotation-marks","title":"Enclosing strings that have a lot of single and double quotation marks","text":"<pre><code>$string =@\" \nSome string text \n\"@\n$string\n</code></pre> <p>the markers <code>@\"</code> and <code>\"@</code> indicating the beginning and end of the string must be on separate lines.</p> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes/#how-to-find-the-type-of-the-output-of-a-command-in-powershell","title":"How to find the type of the output of a command in PowerShell?","text":"<p>Using <code>GetType()</code></p> <p>Examples:</p> <pre><code>(Get-BitlockerVolume -MountPoint \"C:\").KeyProtector.keyprotectortype.GetType() \n</code></pre> <pre><code>(get-nettCPConnection).GetType() \n</code></pre> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes/#make-sure-to-use-pascal-case-for-variable-names","title":"Make sure to use Pascal Case for variable names","text":"<p>Pascal Case requires variables made from compound words and have the first letter of each appended word written with an uppercase letter.</p> <p>Example: <code>$Get-CurrentTime</code></p> <p></p>"},{"location":"PowerShell/Basic%20PowerShell%20tricks%20and%20notes/#some-popular-resources-and-cmdlets","title":"Some popular resources and cmdlets","text":"<ul> <li> <p>Out-Null</p> </li> <li> <p>Test-Path</p> </li> <li> <p>Add-Content</p> </li> <li> <p>New-Item</p> </li> <li> <p>Everything you wanted to know about arrays</p> </li> <li> <p>about_Split</p> </li> <li> <p>Start-Process</p> </li> <li> <p>about_Parsing</p> </li> <li> <p>about_Quoting_Rules</p> </li> <li> <p>about_PowerShell_exe</p> </li> <li> <p>about_Comparison_Operators</p> </li> <li> <p>Everything you wanted to know about hashtables</p> </li> <li> <p>about_Hash_Tables</p> </li> <li> <p>about_Operators</p> </li> <li> <p>ForEach-Object</p> </li> <li> <p>about_Foreach</p> </li> <li> <p>Set-Acl</p> </li> <li> <p>Set-Content</p> </li> <li> <p>icacls</p> </li> <li> <p>Get-Process</p> </li> <li> <p>about_Environment_Variables</p> </li> <li> <p>Everything you wanted to know about the if statement</p> </li> <li> <p>Tee-Object</p> </li> <li> <p>about_Signing</p> </li> <li> <p>CIM Classes (WMI)</p> </li> <li> <p>Get-CimInstance</p> </li> <li> <p>ConvertFrom-Json</p> </li> <li> <p>PowerShell scripting performance considerations</p> </li> <li> <p>Creating Get-WinEvent queries with FilterHashtable</p> </li> <li> <p>Checkpoint-Computer</p> </li> <li> <p>Restore Point Description Text</p> </li> <li> <p>Get-ComputerRestorePoint</p> </li> <li> <p>Pop-Location</p> </li> <li> <p>Invoke-Expression</p> </li> <li> <p>about_Script_Blocks</p> </li> <li> <p>about_Functions_Advanced_Parameters</p> </li> <li> <p>about_Functions_CmdletBindingAttribute</p> </li> <li> <p>Add-Computer</p> </li> <li> <p>Get-Unique</p> </li> <li> <p>Sort-Object</p> </li> <li> <p>about_Comment_Based_Help</p> </li> <li> <p>Get-Date</p> </li> <li> <p>about_Parameters_Default_Values</p> </li> <li> <p>about_Parameter_Sets</p> </li> <li> <p>about_Automatic_Variables</p> </li> <li> <p>about_Functions_Argument_Completion</p> </li> <li> <p>Using tab-completion in the shell</p> </li> <li> <p>about_Continue</p> </li> <li> <p>Trim Your Strings with PowerShell</p> </li> </ul>"},{"location":"WDAC/Fast%20and%20Automatic%20Microsoft%20Recommended%20Driver%20Block%20Rules%20updates/","title":"Fast and Automatic Microsoft Recommended Driver Block Rules updates","text":"<p>The blocklist is updated with each new major release of Windows, typically 1-2 times per year, but you can deploy the recommended driver block rules policy more frequently.</p> <p>This is the GitHub source for the XML content shown on the Microsoft document website. You can see when the last time it was changed was, read the change history and commit messages. The script below automates the required steps explained on the document to download and deploy the recommended driver block rules. Make sure you are using the latest version of Windows.</p>"},{"location":"WDAC/Fast%20and%20Automatic%20Microsoft%20Recommended%20Driver%20Block%20Rules%20updates/#use-the-wdacconfig-module","title":"Use the WDACConfig Module","text":"<p>You can use the WDACConfig Module to create a scheduled task in Windows that will automatically run the script below every 7 days.</p> <pre><code>Install-Module -Name WDACConfig -Force\nNew-WDACConfig -SetAutoUpdateDriverBlockRules\n</code></pre> The script <pre><code>try {\nInvoke-WebRequest -Uri \"https://aka.ms/VulnerableDriverBlockList\" -OutFile VulnerableDriverBlockList.zip -ErrorAction Stop\n}\ncatch\n{ exit }\nExpand-Archive .\\VulnerableDriverBlockList.zip -DestinationPath \"VulnerableDriverBlockList\" -Force\nRename-Item .\\VulnerableDriverBlockList\\SiPolicy_Enforced.p7b -NewName \"SiPolicy.p7b\" -Force\nCopy-Item .\\VulnerableDriverBlockList\\SiPolicy.p7b -Destination \"C:\\Windows\\System32\\CodeIntegrity\"; citool --refresh -json\nRemove-Item .\\VulnerableDriverBlockList -Recurse -Force\nRemove-Item .\\VulnerableDriverBlockList.zip -Force\n</code></pre> <p></p> <p>Microsoft recommended driver block rules that are enforced as a result of using either memory integrity (also known as hypervisor-protected code integrity or HVCI), Smart App Control, or S mode, are saved in a file called <code>driversipolicy.p7b</code> in the <code>%windir%\\system32\\CodeIntegrity</code> directory. The file you will be downloading from Microsoft document is called <code>SiPolicy.p7b</code> and it won't overwrite the <code>driversipolicy.p7b</code> but it will take precedence over the <code>driversipolicy.p7b</code> when deployed, because it has newer version and you can verify it after using refresh tool by observing the Code Integrity event logs as described in the document.</p>"},{"location":"WDAC/How%20to%20Create%20and%20Deploy%20a%20Signed%20WDAC%20Policy%20Windows%20Defender%20Application%20Control/","title":"Create and Deploy Signed WDAC Windows Defender Policy","text":""},{"location":"WDAC/How%20to%20Create%20and%20Deploy%20a%20Signed%20WDAC%20Policy%20Windows%20Defender%20Application%20Control/#introduction","title":"Introduction","text":"<ul> <li> <p>By deploying a Signed Windows Defender Application Control policy, a system will be secure and resistant to any form of tampering (if coupled with Bitlocker and other built-in security features), in a way that even the system administrator can't tamper or disable this security policy.</p> </li> <li> <p>The only way for this security feature to be turned off, modified, updated or disabled will be to have access to the certificate and certificate's private keys used to sign it.</p> </li> <li> <p>Refer to Microsoft's website or my other wiki posts If you want to learn about WDAC itself and how to create a customized WDAC for your own environment.</p> </li> <li> <p>Always test and deploy your WDAC policy in Audit mode first to make sure it works correctly, before deploying the Signed version of it.</p> </li> <li> <p>The WDACConfig module has an optional parameter called <code>-TestMode</code> that will deploy the policies with Boot Audit on Failure and Advanced Boot Options Menu policy rule options.</p> </li> <li> <p>Keep the xml file(s) of the deployed base policy(s) in a safe place, they are needed if you decide to disable the signed deployed WDAC policy later on.</p> </li> </ul> <p></p>"},{"location":"WDAC/How%20to%20Create%20and%20Deploy%20a%20Signed%20WDAC%20Policy%20Windows%20Defender%20Application%20Control/#video-guide","title":"Video Guide","text":""},{"location":"WDAC/How%20to%20Create%20and%20Deploy%20a%20Signed%20WDAC%20Policy%20Windows%20Defender%20Application%20Control/#tldr-short-version","title":"TL;DR (Short version)","text":"<ol> <li>Install the latest Windows Server, Install AD/DS and AD/CS roles on it. (\u224815 mins depending on hardware and if downloaded ISO or VHDX)</li> <li>Use the Enterprise CA's code signing template to create a customized certificate template for WDAC Signing (\u22485 minutes)</li> <li>Generate the certificate and use it to sign the WDAC Policy (\u22483 minutes)</li> </ol> <p>That's essentially everything we have to do. So, if you are already familiar with the concepts, you can go straight to the bottom of this page and use the resources section to refer to Microsoft guides to create and deploy the Signed WDAC policy.</p> <p>But if you aren't familiar, keep reading as I've thoroughly explained every step to set up Windows Server, generate signing certificate and sign the WDAC policy. It takes about 20 minutes for me (as you can see in the video) and depending on the hardware, it can even take less time.</p> <p></p> <p></p>"},{"location":"WDAC/How%20to%20Create%20and%20Deploy%20a%20Signed%20WDAC%20Policy%20Windows%20Defender%20Application%20Control/#prerequisites","title":"Prerequisites","text":"<p>Latest Windows Server, it's free for 180 days for evaluation and comes in ISO and VHDX formats. Preferably use Windows Server insider vNext because it has the newest features and visual upgrades.</p> <ul> <li>Download Windows Server 2022 from Microsoft Evaluation Center</li> <li>Download Windows Server insider vNext</li> <li>Insider activation keys</li> </ul> <p></p> <p>Once we have our Windows installation media (ISO or VHDX), we need to set up a Hyper-V VM on our host. For this guide, our host is a Windows 11 pro for workstations machine.</p> <p>Create a Hyper-V VM with these specifications:</p> <ul> <li>Secure Boot</li> <li>Trusted Platform Module (TPM)</li> <li>At least 4 virtual processors</li> <li>At least 4 GB RAM</li> <li>At least ~20 GB storage</li> <li>Connect the Default Switch to the VM or create a Private Virtual switch in Virtual Switch Manager of Hyper-V manager, then add it as network adapter hardware to the VM.</li> </ul> <p></p>"},{"location":"WDAC/How%20to%20Create%20and%20Deploy%20a%20Signed%20WDAC%20Policy%20Windows%20Defender%20Application%20Control/#windows-server-vm-setup","title":"Windows Server VM setup","text":"<p>After Windows Server installation has finished, you can create a Hyper-V standard checkpoint so you'll be able to restore the VM's state to this point in time if you misconfigure something later on.</p> <p></p>"},{"location":"WDAC/How%20to%20Create%20and%20Deploy%20a%20Signed%20WDAC%20Policy%20Windows%20Defender%20Application%20Control/#rename-the-server","title":"Rename the server","text":"<p>Choose a meaningful name, like <code>CAServer</code>. Use this PowerShell cmdlet to easily do that, it will restart the server to apply the new name.</p> <pre><code>Rename-Computer CAServer -Restart\n</code></pre> <p></p>"},{"location":"WDAC/How%20to%20Create%20and%20Deploy%20a%20Signed%20WDAC%20Policy%20Windows%20Defender%20Application%20Control/#using-gui-install-active-directory-domain-services","title":"Using GUI: Install Active Directory Domain Services","text":"<p>From Server Manager =&gt; Add Roles and Features =&gt; Role-based or feature-based installation =&gt; Select the current server you are on =&gt; Select Active Directory Domain Services from the list =&gt; Select \"Add Features\" =&gt; Continue the rest of the steps by selecting Next.</p> <p>After installation is over, open the notifications in the Server Manager, (there will probably be a yellow icon on it), Select \"Promote this server to a domain controller\".</p> <p>In the Deployment Configuration window that will be opened, select \"Add a new forest\" and in the Root domain name, enter a domain name.</p> <p>It can be anything, even <code>Bing.com</code>, but for our usage let's use <code>CAServer.com</code>. On the next step, set a password for DSRM (Directory Services Restore Mode), It needs to have uppercase, lowercase and numbers (e.g., Bing6969), write this password down somewhere, like in Sticky notes app on your host.</p> <p>Next, choose a NetBIOS domain name, the default one will be OK. Confirm and proceed with the rest of the steps by selecting Next and at the end select Install. Wait for the installation to finish. It will restart the Server once the Installation is finished.</p> <p></p>"},{"location":"WDAC/How%20to%20Create%20and%20Deploy%20a%20Signed%20WDAC%20Policy%20Windows%20Defender%20Application%20Control/#using-powershell-install-active-directory-domain-services","title":"Using PowerShell: Install Active Directory Domain Services","text":"<p>Install (AD DS) role</p> <pre><code>Install-windowsfeature -name AD-Domain-Services -IncludeManagementTools\n</code></pre> <p>Install a forest and set a forest password</p> <pre><code>$password = ConvertTo-SecureString 'Bing6969' -AsPlainText -Force\nInstall-ADDSForest -DomainName CAServer.com -DomainNetbiosName CASERVER0 -SafeModeAdministratorPassword $password -InstallDNS:$false -Force\n</code></pre> <p> </p>"},{"location":"WDAC/How%20to%20Create%20and%20Deploy%20a%20Signed%20WDAC%20Policy%20Windows%20Defender%20Application%20Control/#using-gui-install-active-directory-certification-service-and-set-up-an-enterprise-root-ca-certificate-authority","title":"Using GUI: Install Active Directory Certification Service and set up an Enterprise root CA (Certificate Authority)","text":"<p>From Server Manager =&gt; Add Roles and Features =&gt; Role-based or feature-based installation =&gt; Select the current server we are on =&gt; Select Active Directory Certification Service =&gt; Select Next for the rest of the steps and finally select install.</p> <p>After installation is over, open the notifications in the Server Manager, (there will probably be a yellow icon on it), Select \"Configure Active Directory Certificate Service on the destination server\".</p> <p>On the newly opened configuration window, on credentials section select next, on the Role services section check the box for <code>Certification Authority</code> and select next.</p> <p>Select <code>Enterprise CA</code> (because Standalone CA does not support certificate templates that we are going to use) and select Next. On the CA Type section select <code>Root CA</code>. On the Private Key section select <code>Create a new private key</code>.</p> <p>On the Cryptography section, for Cryptographic Provider choose <code>RSA#Microsoft Software Key Storage Provider</code>, for Key length choose <code>4096</code>, for Hash Algorithm choose <code>SHA512</code> and select Next. On the CA name section select next. On the Validity Period section set validity period to something like 50 Years. Select next for the rest of the sections and finally select Configure.</p> <p></p>"},{"location":"WDAC/How%20to%20Create%20and%20Deploy%20a%20Signed%20WDAC%20Policy%20Windows%20Defender%20Application%20Control/#using-powershell-install-active-directory-certification-services-and-set-up-an-enterprise-root-ca","title":"Using PowerShell: Install Active Directory Certification Services and set up an Enterprise root CA","text":"<p>Install Active Directory Certificate Services</p> <pre><code>Install-WindowsFeature Adcs-Cert-Authority -IncludeAllSubFeature\n</code></pre> <p>Install a new Enterprise CA</p> <pre><code>Install-AdcsCertificationAuthority -CAType EnterpriseRootCa -CryptoProviderName \"RSA#Microsoft Software Key Storage Provider\" -KeyLength 4096 -HashAlgorithmName SHA512 -ValidityPeriod Years -ValidityPeriodUnits 50 -Force\n</code></pre> <p>Restart the server because it is required, and Server Manager says it too</p> <pre><code>Restart-Computer\n</code></pre> <p>Lastly do this so that Certification Authority option will be added to Server Manager =&gt; Tools and its GUI will become accessible and visible</p> <pre><code>Add-WindowsFeature Adcs-Cert-Authority -IncludeManagementTools\n</code></pre> <p></p>"},{"location":"WDAC/How%20to%20Create%20and%20Deploy%20a%20Signed%20WDAC%20Policy%20Windows%20Defender%20Application%20Control/#configure-the-validity-period-of-the-issued-certificates-on-the-server","title":"Configure the Validity period of the issued certificates on the server","text":"<p>Microsoft official guide for this</p> <p>We Increase the validity period of the certificates issued by the CA to 30 years:</p> <pre><code>certutil -setreg ca\\ValidityPeriod \"Years\" \ncertutil -setreg ca\\ValidityPeriodUnits \"30\"\n</code></pre> <p>Restart the Server after this step.</p> <p>You can verify and confirm the results using these commands:</p> <pre><code>certutil -getreg ca\\ValidityPeriod \ncertutil -getreg ca\\ValidityPeriodUnits\n</code></pre> <p></p>"},{"location":"WDAC/How%20to%20Create%20and%20Deploy%20a%20Signed%20WDAC%20Policy%20Windows%20Defender%20Application%20Control/#follow-the-official-guide-to-create-certificate-template-and-generate-the-signing-certificate","title":"Follow the official guide to create certificate template and generate the signing certificate","text":"<p>Now open Certification Authority, you can do so by searching for it in Windows search or from Server Manager =&gt; Tools. Once you open it, you can follow the official guide from Microsoft to create the certificate template for WDAC policy signing and then request and create a certificate.</p> <p></p> <p>Note that If the Server doesn't have at least 1 network adapter connected to it, then Certificate Templates don't load,</p> Screenshot <p></p> <p>That's why our Hyper-V VM Server has at least one Private Virtual Network Adapter.</p> <p></p> <p>The guide suggests using a client computer to request and create the certificate but since we are going to use the certificate for non-domain-joined computers and don't need to use the Active Directory, we can perform all of the steps on the same Windows Server VM.</p> <p>These are some optional deviations from the official guide that result in creating a successful and more secure certificate for our WDAC policy signing:</p> <ul> <li> <p>On the Compatibility tab, you can select Windows Server 2016 from the Certification Authority list and select Windows 10 / Windows Server 2016 from the Certificate recipient list.</p> </li> <li> <p>On the General tab, you can set the Validity period to 30 years and Renewal period to 22 years. (The maximum allowed Renewal period for the validity period we chose.)</p> </li> <li> <p>On the Cryptography tab, you can set the Provider Category to <code>Key Storage Provider</code> (KSP). Set the Algorithm Name to <code>RSA</code>. Set the Minimum key size to <code>4096</code>. Set Request hash to <code>SHA512</code>.</p> </li> </ul> <p>As the Microsoft's guide suggests, you need to go to security tab to verify account access of the user(s) requesting the certificate, but since we are requesting and creating our certificate on the same CA server, we don't need to change anything there.</p> <p></p> If we want to use a 2nd PC to do this, as described in Microsoft document (Totally Unnecessary) <p>Additional steps to perform on Windows Server</p> <p>If you are going to create a new user account in \"Active Directory Users and Computers\" for use on the client VM, in Certification Authority when duplicating the certificate template, go to Security Tab and set the correct permissions for that user account so that it will be able to request and enroll the certificate.</p> <p>For instance, since you are the only person who is going to use the Active Directory, you can even give <code>Full Control</code> permission to <code>Authenticated Users</code> group.</p> <p>Alternatively, you can use the same administrator account that you are currently using on Windows Server, which exists by default in the Active Directory, to log into the other client computer. One can log into multiple computers with the same user account across an Active Directory domain. There is no limit by default to how many concurrent logins an active directory user can have.</p> <p>Make sure the Windows Server and Windows client VMs both use the same Hyper-V Private Virtual switch network adapter. The VMs need to have static IP addresses on the same subnet in order to communicate with each other.</p> <p>Go to Windows Settings =&gt; Network &amp; Internet =&gt; Ethernet =&gt; in \"IP Assignment\" select \"Edit\" =&gt; Set it to \"Manual\" =&gt; Toggle the IPv4 =&gt; in IP Address Enter <code>10.10.10.1</code> and in Subnet Mask enter <code>255.0.0.0</code>. Without configuring anything else, save it.</p> <p>Use the Edit button for DNS server assignment, set it to Manual, toggle the IPv4 button and in the Preferred DNS field enter <code>127.0.0.1</code>. Save everything and exit settings.</p> <p></p> <p>Steps to perform on Client VM</p> <p>Make sure the client VM is running the latest version of Windows, and it follows the same prerequisites explained above.</p> <p>Go to Windows Settings =&gt; Network &amp; Internet =&gt; Ethernet =&gt; in \"IP Assignment\" select \"Edit\" =&gt; Set it to \"Manual\" =&gt; Toggle the IPv4 =&gt; in IP Address Enter <code>10.10.10.2</code> and in Subnet Mask enter <code>255.0.0.0</code>. Without configuring anything else, save it.</p> <p>Now use the Edit button for DNS server assignment, set it to Manual, toggle the IPv4 button and in the Preferred DNS field enter the static IP address of the Windows Server VM, which was <code>10.10.10.1</code>. Save everything and exit settings.</p> <p>Open an elevated PowerShell and enter this to join the Active Directory domain:</p> <pre><code>Add-Computer -DomainName &lt;Domain&gt; -Restart\n</code></pre> <p>You will be asked for credentials. If you are going to use the same Administrator account from Windows Server, use <code>Administrator</code> for username and enter the password of the Windows Server in the password field, otherwise use the password you set when creating the new user account in Active Directory Users and Computers.</p> <p>After the client machine restarted, use <code>Other user</code> option on the lock screen and this time you will be using the Active Directory credentials to log into the machine. If using the built-in Administrator account, the password will be the same as the password on Windows Server account, but the username will be in the Username@Domain format, so in this case, it will be <code>Administrator@CAServer.com</code>.</p> <p>Since you are using Administrator account, you can by default use Enhanced session in Hyper-V too.</p> <p>To request the certificate and enroll it, you can follow the official Microsoft guide.</p> <p></p> <p></p>"},{"location":"WDAC/How%20to%20Create%20and%20Deploy%20a%20Signed%20WDAC%20Policy%20Windows%20Defender%20Application%20Control/#create-a-signed-wdac-policy","title":"Create a Signed WDAC policy","text":"<p>Once we have the certificate in the User Certificates store of either the Windows Server or a client machine, Right-click on it =&gt; All tasks =&gt; Export. Export the Private key and export all the Extended Properties, set a password for the certificate and set Encryption to <code>AES256-SHA256</code>. Select a location to export and it will create a <code>.pfx</code> file.</p> <p>You also need to export the certificate without private key, in <code>DER encoded binary X.509</code> format which will create a <code>.cer</code> certificate file. We need this certificate to sign the WDAC policy.</p> <p>It is important to keep these 2 files, specially <code>.pfx</code> that contains the private key, in a safe place, such as Azure Key Vault Managed HSM or OneDrive Personal Vault, so that if you delete all the VMs you created, you will be able to continue using the same certificate to sign further WDAC policies and supplemental policies, at least for the next 22 years, before it needs a renewal. As you can see, all of that setup must be done just once every few decades.</p> <p>The Personal Information Exchange (.pfx) file has great importance because it contains the Public key and Private key of the certificate so anyone who has access to this file can disable the deployed Signed WDAC policy. It should never be shared with anyone outside your circle of trust. It is a password-protected file by nature.</p> <p></p>"},{"location":"WDAC/How%20to%20Create%20and%20Deploy%20a%20Signed%20WDAC%20Policy%20Windows%20Defender%20Application%20Control/#use-wdacconfig-module-to-sign-and-deploy-wdac-policies","title":"Use WDACConfig module to sign and deploy WDAC policies","text":"<p>WDACConfig module with the <code>Deploy-SignedWDACConfig</code> cmdlet can automate the entire process of signing and deploying a signed WDAC policy.</p> <pre><code>Deploy-SignedWDACConfig -CertPath &lt;String&gt; -PolicyPaths &lt;String[]&gt; -CertCN &lt;String&gt;\n</code></pre> <p>Cmdlet Info</p> <p></p> <p>You need the <code>signtool.exe</code> to sign the <code>.cip</code> policy binary files.</p> <ul> <li>Download the latest Windows stable SDK installer</li> <li>Download the latest Windows Insider SDK ISO</li> </ul> <p>Run it and only select <code>Windows SDK Signing Tools for Desktop Apps</code> to install. After that <code>signtool.exe</code> will be placed at <code>C:\\Program Files (x86)\\Windows Kits\\10\\bin</code> and the WDACConfig module will automatically detect and use it for signing. You can even copy the executable to another location for later usage on another system where SDK is not installed and then use the optional <code>-SignToolPath &lt;String&gt;</code> parameter of WDACConfig module to browse for executable.</p> <ul> <li>SignTool is also included in the Windows ADK but the one in SDK is the newest and recommended place to get it.</li> </ul> <p></p>"},{"location":"WDAC/How%20to%20Create%20and%20Deploy%20a%20Signed%20WDAC%20Policy%20Windows%20Defender%20Application%20Control/#use-wdacconfig-module-to-remove-signed-and-deployed-wdac-policies","title":"Use WDACConfig module to remove signed and deployed WDAC policies","text":"<pre><code>Remove-WDACConfig [-SignedBase] -PolicyPaths &lt;String[]&gt; -CertCN &lt;String&gt;\n</code></pre>"},{"location":"WDAC/How%20to%20Create%20and%20Deploy%20a%20Signed%20WDAC%20Policy%20Windows%20Defender%20Application%20Control/#parameter-info","title":"Parameter Info","text":"<p>After running the command above and restarting the system, you need to run this command and restart for a 2nd time, to finish completely removing the signed base policies from the system.</p> <pre><code>Remove-WDACConfig [-UnsignedOrSupplemental] [-PolicyIDs &lt;String[]&gt;] [-PolicyNames &lt;String[]&gt;]\n</code></pre>"},{"location":"WDAC/How%20to%20Create%20and%20Deploy%20a%20Signed%20WDAC%20Policy%20Windows%20Defender%20Application%20Control/#parameter-info_1","title":"Parameter Info","text":""},{"location":"WDAC/How%20to%20Create%20and%20Deploy%20a%20Signed%20WDAC%20Policy%20Windows%20Defender%20Application%20Control/#system-behavior","title":"System Behavior","text":""},{"location":"WDAC/How%20to%20Create%20and%20Deploy%20a%20Signed%20WDAC%20Policy%20Windows%20Defender%20Application%20Control/#activation-process","title":"Activation Process","text":"<p>After the signed WDAC policy binary <code>.cip</code> is copied to the <code>EFI</code> partition as part of the deployment process, and system is restarted oncee, we can see in System Information that WDAC user-mode is being enforced and when you try to install an application not permitted by the deployed policy, it will be successfully blocked. At this point, since we are using UEFI Secure Boot, the Anti Tampering protection of the Signed WDAC kicks in and starts protecting WDAC policy against any tampering. We need to reboot the system one more time, to verify everything and make sure there is no boot failure.</p> <p>Deploying a Signed WDAC policy without restarting is the same as deploying Unsigned policies, because the Signed policy can be easily removed just like an Unsigned policy. So always make sure you restart at least once after deploying a Signed WDAC policy.</p> <p></p>"},{"location":"WDAC/How%20to%20Create%20and%20Deploy%20a%20Signed%20WDAC%20Policy%20Windows%20Defender%20Application%20Control/#if-someone-forcefully-deletes-the-deployed-wdac-policy-file","title":"If Someone forcefully deletes the deployed WDAC policy file","text":"<ul> <li> <p>Deleting the <code>.cip</code> policy file from <code>C:\\Windows\\System32\\CodeIntegrity\\CiPolicies\\Active</code> and then restarting the system multiple times won't have any effect at all on the status of WDAC. It will continue to work, and enforcement status will be shown in System Information. This is how it protects itself against rogue administrators.</p> </li> <li> <p>Deleting the <code>.cip</code> policy file from the <code>EFI</code> partition located at <code>\\EFI\\Microsoft\\Boot\\CIPolicies\\Active</code> and restarting the device will result in a boot failure. Before system restart, nothing happens and it will remain active. This is another self-protection method of a Signed WDAC policy. To recover from this state, the person will need to disable Secure Boot in the UEFI firmware settings. There are only 3 scenarios at this point:</p> </li> <li> <p>If, as suggested in the Security Recommendations, you set a strong password for the UEFI firmware of your hardware, they can't access the firmware. This security measure alongside the rest of the Windows built-in security features such as Bitlocker device encryption will provide the Ultimate protection for a Windows device against any threats and any person, no matter physical, real-life or Internet threats.</p> </li> <li> <p>If UEFI firmware is not password protected, the person can disable Secure Boot and/or TPM in UEFI firmware settings, they can even flash the entire UEFI firmware memory by physically abusing the device to get past the UEFI password, but since the device is Bitlocker protected, a total Lock Down will be triggered and the person will need to provide the 48-digit recovery key of the OS drive in order to even complete the boot process into Windows lock screen. Assuming the person also has access to the Windows PIN, they will also need to provide 48-digit recovery password of any subsequent Bitlocker protected drive(s) in order to access them (if the drive(s) aren't set to be auto-unlocked with OS drive). This is more than Security-In-Depth. If UEFI firmware has any unpatched vulnerability, Device Guard feautres will take care of it.</p> </li> <li> <p>Since steps 1 and 2 are impossible to bypass for a rouge person, there will be only one option left. To completely recycle the physical device, get rid of the inaccessible hardware such as SSD and then sell the remaining hardware parts. Either way, your data remains secure and inaccessible to any unauthorized person(s) at all times.</p> </li> </ul> Screenshot of a message after forcefully deleting a Signed WDAC policy from the EFI partition <p></p> <p></p>"},{"location":"WDAC/How%20to%20Create%20and%20Deploy%20a%20Signed%20WDAC%20Policy%20Windows%20Defender%20Application%20Control/#when-we-activate-smart-app-control","title":"When we activate Smart App Control","text":"<p>After completely deploying the Signed WDAC policy, if we turn on Smart App Control, which is a variation of WDAC, then it will take control of the Windows Defender Application Control User Mode Policy. After turning off Smart App Control, the signed WDAC policy will automatically take the control. So, after deploying the Signed WDAC policy, Smart App Control can either be turned on or turned off, either way, the signed WDAC policy will not be disabled and will turn on as soon as Smart App Control is turned off.</p> <p></p>"},{"location":"WDAC/How%20to%20Create%20and%20Deploy%20a%20Signed%20WDAC%20Policy%20Windows%20Defender%20Application%20Control/#dual-boot-os-configurations","title":"Dual boot OS configurations","text":"<p>When you deploy a Signed WDAC policy on a system that uses Secure Boot, it will be enforced on all of the OSes that boot on the physical machine, because the policy resides on the EFI partition. This means that if you perform a clean install of a second Windows OS or natively boot a VHDX (Hyper-V VM), the policy will apply to them as well.</p> <p> </p>"},{"location":"WDAC/How%20to%20Create%20and%20Deploy%20a%20Signed%20WDAC%20Policy%20Windows%20Defender%20Application%20Control/#extras","title":"Extras","text":""},{"location":"WDAC/How%20to%20Create%20and%20Deploy%20a%20Signed%20WDAC%20Policy%20Windows%20Defender%20Application%20Control/#how-to-interact-with-the-hidden-efi-partition","title":"How to interact with the hidden EFI partition","text":"<p>Using Diskpart, Open an elevated PowerShell console and run these commands one by one:</p> <pre><code>diskpart\nlist disk\n# double check to make sure it's the correct disk if you have more than 1\nselect disk 0\nlist part\n# The EFI partitions type is System, and its size is approximately 100MB, make sure you choose the correct one\nselect part 1\nassign letter=z\n</code></pre> <p></p> <p>The <code>EFI</code> partition will be available in This PC with letter <code>Z</code>, but you can't access it without modifying permissions. There is however an easier way to access it and manually copy the Signed WDAC policy binary to it. Open Task Manager as admin, select <code>Run New Task</code>, select <code>Browse</code> and now you can access drive <code>Z</code> (<code>EFI</code> partition) and copy the Signed <code>.cip</code> file in <code>Z:\\EFI\\Microsoft\\Boot\\CIPolicies\\Active</code>.</p> <p></p>"},{"location":"WDAC/How%20to%20Create%20and%20Deploy%20a%20Signed%20WDAC%20Policy%20Windows%20Defender%20Application%20Control/#how-to-find-the-fqdn-fully-qualified-domain-name-of-the-windows-server","title":"How to find the FQDN (Fully Qualified Domain Name) of the Windows Server","text":"<p>Using PowerShell</p> <pre><code>(Get-ADComputer $(hostname)).DNSHostName\n</code></pre> <p>or</p> <pre><code>\"$env:computername.$env:userdnsdomain\"\n</code></pre> <p>You can also use GUI of Server Manager =&gt; Local Server</p> <p>The syntax is: <code>Computer_Name.Domain</code></p> <p>So, if:</p> <ul> <li>Computer Name: <code>CAServer</code></li> <li>Domain: <code>CAServer.com</code></li> </ul> <p>then FQDN is: <code>CAServer.CAServer.com</code></p> <p></p>"},{"location":"WDAC/How%20to%20Create%20and%20Deploy%20a%20Signed%20WDAC%20Policy%20Windows%20Defender%20Application%20Control/#resources","title":"Resources","text":"<ul> <li>Use signed policies to protect Windows Defender Application Control against tampering</li> <li>Create a code signing cert for Windows Defender Application Control</li> <li>Deploying signed policies</li> <li>WDAC Policy Wizard</li> <li>Generate Windows Defender Application Control (WDAC) policies Online</li> <li>WDAC policy creation - Australian Government</li> <li>Understand Windows Defender Application Control (WDAC) policy rules and file rules</li> <li>Install Active Directory Domain Services</li> <li>Install-AdcsCertificationAuthority</li> <li>Install the Certification Authority</li> <li>Comparison of Standard, Datacenter, and Datacenter: Azure Edition editions of Windows Server 2022</li> <li>Remove Windows Defender Application Control (WDAC) policies</li> <li>Add-SignerRule</li> </ul>"},{"location":"WDAC/Introduction/","title":"Introduction","text":""},{"location":"WDAC/Introduction/#introduction","title":"Introduction","text":""},{"location":"WDAC/Introduction/#what-is-windows-defender-application-control","title":"What is Windows Defender Application Control?","text":"<p>Application control is a crucial line of defense for protecting enterprises given today's threat landscape, and it has an inherent advantage over traditional antivirus solutions. Specifically, application control moves away from an application trust model where all applications are assumed trustworthy to one where applications must earn trust in order to run.</p> <p>Devices where Windows Defender Application control (WDAC) policies are deployed on can either be centrally managed via MDM, Intune etc. or they can be home devices, devices that are private and don't belong to any organization, the computer of someone that you want to keep 100% safe and secure so that even the device's owner can't willingly or forcefully compromise themselves, the possibilities are endless.</p> <p></p>"},{"location":"WDAC/Introduction/#windows-defender-application-control-wdac-wiki-posts","title":"Windows Defender Application Control (WDAC) wiki posts","text":"<ul> <li>Introduction</li> <li>WDACConfig Module</li> <li>WDAC for Lightly managed device</li> <li>WDAC for Fully managed device - Variant 1</li> <li>WDAC for Fully managed device - Variant 2</li> <li>WDAC for Fully managed device - Variant 3</li> <li>WDAC for Fully managed device - Variant 4</li> <li>WDAC Notes</li> <li>How to Create and Deploy a Signed WDAC Policy</li> <li>Fast and Automatic Microsoft Recommended Driver Block Rules updates</li> <li>WDAC policy for BYOVD Kernel mode only protection</li> </ul>"},{"location":"WDAC/Introduction/#my-wdacconfig-module","title":"My WDACConfig Module","text":"<p>WDACConfig is an advanced PowerShell module designed with the aim of automating Application and File whitelisting in Windows using Windows Defender Application Control. Install it from PowerShell gallery.</p> <p></p>"},{"location":"WDAC/Introduction/#wdac-usage-levels","title":"WDAC usage levels","text":"<p>There are many ways you can utilize WDAC features and here they are sorted by the level of restriction and protection they provide; From top (having the least restriction and protection) to bottom (having the most restriction and protection).</p> <ol> <li> <p>Use Microsoft recommended driver block rules.</p> <ul> <li>No user action required. Starting with Windows 11 2022 update, the vulnerable driver blocklist is enabled by default for all devices, using HVCI or Memory Integrity.</li> <li>The built-in driver blocklist is updated with each new major release of Windows, typically 1-2 times per year.</li> </ul> </li> <li> <p>Update Microsoft recommended driver block rules outside of the twice a year schedule.</p> <ul> <li>The drivers block list itself is updated more frequently than twice a year schedule, use my WDAC Module to download and apply them regularly and automatically.</li> </ul> </li> <li>Use Microsoft recommended block rules PLUS Recommended driver block rules<ul> <li>The WDAC XML policy content is provided here, copy them, create a new XML file and paste the content in it and save it. Reset its policy ID and convert it to multiple policy format. Convert it to <code>.cip</code> policy binary and then deploy it. Keep it up to date by regularly repeating this.</li> </ul> </li> <li>Create WDAC policy for Lightly managed devices<ul> <li>Microsoft's guide: Create a WDAC policy for lightly managed devices</li> <li>My guide: WDAC for Lightly Managed Devices</li> </ul> </li> <li>Use Smart App Control<ul> <li>It's just a toggle in Windows Security under App &amp; Browser control. It uses a special kind of WDAC policy that provides more protection than a lightly managed workstation but less protection than a fully managed workstation.</li> <li>It uses both of Microsoft's recommended block rules.</li> </ul> </li> <li>Create WDAC policy for Fully managed devices<ul> <li>The following scenarios provide the highest protection against any threats from any sources when cryptographically signed and deployed and properly configured.</li> <li>WDAC for Fully managed device - Variant 1</li> <li>WDAC for Fully managed device - Variant 2</li> <li>WDAC for Fully managed device - Variant 3</li> <li>WDAC for Fully managed device - Variant 4</li> <li>Microsoft's guide: Create a WDAC policy for fully managed devices</li> <li>Microsoft's guide: Create a WDAC policy for fixed-workload devices (reference computer)</li> <li>Microsoft's guide: Use audit events to create WDAC policy rules</li> </ul> </li> </ol> <p></p>"},{"location":"WDAC/Introduction/#methods-we-can-use-to-create-a-wdac-policy","title":"Methods we can use to create a WDAC policy","text":"<ul> <li>Using PowerShell cmdlets</li> <li>Using WDACConfig PowerShell module</li> <li>Using WDAC Policy Wizard</li> </ul>"},{"location":"WDAC/Introduction/#plan-for-windows-defender-application-control-lifecycle-policy-management","title":"Plan for Windows Defender Application Control lifecycle policy management","text":"<p>Microsoft provides the following official document to understand the decisions you need to make to establish the processes for managing and maintaining Windows Defender Application Control (WDAC) policies. The rest of them are mentioned below at the Resources section.</p> <p></p>"},{"location":"WDAC/Introduction/#resources","title":"Resources","text":"<p>There are a lot more WDAC resources and cmdlets available on Microsoft's websites.</p>"},{"location":"WDAC/Introduction/#cmdlets","title":"Cmdlets","text":"<ul> <li>New-CIPolicy</li> <li>New-CIPolicyRule</li> <li>Merge-CIPolicy</li> <li>Set-RuleOption</li> <li>Set-CIPolicyIdInfo</li> </ul>"},{"location":"WDAC/Introduction/#documents","title":"Documents","text":"<ul> <li>Application Control for Windows</li> <li>Understand Windows Defender Application Control policy design decisions</li> <li>Deploying Windows Defender Application Control (WDAC) policies</li> <li>Use multiple Windows Defender Application Control Policies</li> <li>Use audit events to create WDAC policy rules</li> <li>Merge Windows Defender Application Control (WDAC) policies</li> <li>Understand Windows Defender Application Control (WDAC) policy rules and file rules</li> <li>Testing and Debugging AppId Tagging Policies</li> <li>Editing existing base and supplemental WDAC policies with the Wizard</li> <li>Creating a new Supplemental Policy with the Wizard</li> <li>Generate Windows Defender Application Control (WDAC) policies Online</li> <li>Windows Defender Application Control (WDAC) example base policies</li> <li>Configure the Application Identity service</li> <li>Microsoft recommended driver block rules</li> <li>Microsoft recommended block rules</li> <li>Create a WDAC policy using a reference computer (for fixed-workload devices)</li> <li>Create a WDAC policy for fully managed devices</li> <li>Create a WDAC policy for lightly managed devices</li> <li>Guidance on Creating WDAC Deny Policies</li> <li>Hypervisor-protected Code Integrity enablement</li> </ul>"},{"location":"WDAC/WDAC%20Notes/","title":"Important Notes and Tips about WDAC policies","text":"<ul> <li>WDAC stands for Windows Defender Application Control</li> <li>It's used for Application and File whitelisting in Windows.</li> </ul>"},{"location":"WDAC/WDAC%20Notes/#supplemental-wdac-policy-considerations","title":"Supplemental WDAC Policy considerations","text":""},{"location":"WDAC/WDAC%20Notes/#verify-policy-type","title":"Verify Policy type","text":"<p>We have to make sure the WDAC policy that we are going to use as a supplemental policy has <code>PolicyType=\"Supplemental Policy\"</code> in the <code>SiPolicy</code> element of the XML file. If it doesn't, then we have to use this command to change it from base policy to supplemental policy of our base policy.</p> <p>That will also change/create the <code>&lt;BasePolicyID&gt;GUID&lt;/BasePolicyID&gt;</code> element in the supplemental policy XML file. The GUID will be the <code>PolicyID</code> of the base policy specified in the command.</p> <p></p>"},{"location":"WDAC/WDAC%20Notes/#verify-policy-rule-options","title":"Verify Policy Rule options","text":"<p>We have to make sure that the supplemental policy does not contain any policy rule options that only work with a base policy. This chart shows which ones can be used in a supplemental policy.</p> <p></p> <p>You can use this PowerShell code to automatically make sure non-supplemental policy rule options don't exist in a supplemental policy XML file:</p> <pre><code>$supplementalPolicyPath = \".\\Supplemental_Policy.xml\"\n@(0, 1, 2, 3, 4, 8, 9, 10, 11, 12, 15, 16, 17, 19, 20) | ForEach-Object {\nSet-RuleOption -FilePath $supplementalPolicyPath -Option $_ -Delete\n}\n</code></pre> <p></p> <p>A supplemental policy can only have these policy rule options:</p> <ul> <li>5 Enabled:Inherit Default Policy</li> <li>6 Enabled:Unsigned System Integrity Policy (Default)</li> <li>7 Allowed:Debug Policy Augmented</li> <li>13 Enabled:Managed Installer</li> <li>14 Enabled:Intelligent Security Graph Authorization</li> <li>18 Disabled:Runtime FilePath Rule Protection</li> </ul> <p></p>"},{"location":"WDAC/WDAC%20Notes/#deny-rules-in-supplemental-policy-are-invalid","title":"Deny rules in supplemental policy are invalid","text":"<p>Deny rules are ignored in supplemental policies by WDAC engine. Supplemental policies are only meant to expand what the base policy trusts, that's why only allow rules are supported in supplemental policies, and that's also the reason why we don't need to merge Microsoft recommended block rules or driver block rules with a supplemental policy.</p> <p>When the base policy has a deny rule for a file and we allow the same file in a supplemental policy, the file will still be blocked, because explicit deny rules have the highest priority.</p> <p>Rule Precedence</p> <p></p>"},{"location":"WDAC/WDAC%20Notes/#signing-a-supplemental-policy","title":"Signing a Supplemental policy","text":"<p>When adding the details of the code signing certificate to a base WDAC Policy, make sure you add the <code>-Supplemental</code> switch parameter to the add-signerrule cmdlet when signing a base WDAC policy that is going to have supplemental policies later on. That parameter can only be used for a base policy.</p> <ul> <li>Using <code>-Supplemental</code> parameter with <code>Add-SignerRule</code> cmdlet on a Supplemental policy will cause boot failure after deploying it, because that parameter should only be used when adding singer rules to a base policy.</li> </ul> <p></p>"},{"location":"WDAC/WDAC%20Notes/#removing-supplemental-policies","title":"Removing Supplemental policies","text":"<p>Whether the deployed supplemental policy is unsigned or signed, you can remove it just like any unsigned policy using CITool.</p> <p></p>"},{"location":"WDAC/WDAC%20Notes/#what-if-you-deploy-unsigned-supplemental-policy-on-signed-system","title":"What if you Deploy Unsigned Supplemental policy on Signed system?","text":"<p>If you deploy an unsigned supplemental policy on a system where all policies including base and supplemental, are signed, the deployed unsigned supplemental policy will be ignored.</p> <p></p> <p></p> <p></p>"},{"location":"WDAC/WDAC%20Notes/#how-deny-rules-for-files-and-certificatessigners-are-specified","title":"How Deny rules for files and certificates/signers are specified","text":""},{"location":"WDAC/WDAC%20Notes/#denied-file-rules","title":"Denied File Rules","text":"<p>First, Block/Deny File rules are specified in <code>&lt;FileRules&gt;</code> element which is directly under <code>&lt;SiPolicy&gt;</code> element in the XML file. Deny rules are created by having <code>&lt;Deny ID=\"ID_DENY_\"</code> at the beginning of their lines, for example:</p> <pre><code>&lt;Deny ID=\"ID_DENY_AGENT64_SHA1\" FriendlyName=&lt;Textual Description/Name&gt; Hash=&lt;Hash Numbers&gt; /&gt;\n</code></pre> <p></p> <p>Second, there are File Reference rules for each Deny rule that only mentions them by ID, and these are exactly the same as Allow rules because only Rule IDs are mentioned and nothing about the nature of the rule itself. These are in:</p> <pre><code>&lt;SiPolicy&gt;\n&lt;SigningScenarios&gt;\n&lt;SigningScenario&gt;\n&lt;ProductSigners&gt;\n&lt;FileRulesRef&gt;\n&lt;FileRuleRef RuleID=\"&lt;The same ID of the Deny File rule mentioned earlier&gt;\" /&gt;\n&lt;/FileRulesRef&gt;\n&lt;/ProductSigners&gt;            &lt;/SigningScenario&gt;\n&lt;/SigningScenarios&gt;\n&lt;/SiPolicy&gt;\n```\n\n&lt;br&gt;\n### Denied Certificates/Singers\n\nDenied certificates/singers are first mentioned in `&lt;SiPolicy` =&gt; `&lt;Signers&gt;` with the following syntax:\n\n```xml\n&lt;Signer ID=\"ID_SIGNER_VERISIGN_2010\" Name=\"VeriSign Class 3 Code Signing 2010 CA\"&gt;\n... Other possible attributes ...\n&lt;/Signer&gt;\n</code></pre> <p>Unlike file rules, this first part doesn't specify whether the certificate/singer must be allowed or blocked by the WDAC policy.</p> <p>In order to specify whether a certificate/singer should be denied/allowed, the ID of each signer must be specified in the second part of the XML policy file in <code>&lt;DeniedSigners&gt;</code> element:</p> <pre><code>&lt;SigningScenarios&gt;\n&lt;SigningScenario Value=\"131\" ID=\"ID_SIGNINGSCENARIO_&lt;Some generic String&gt;\" FriendlyName=\"&lt;Name&gt;\"&gt;\n&lt;ProductSigners&gt;\n&lt;DeniedSigners&gt;\n&lt;DeniedSigner SignerId=\"&lt;ID of the Signer mentioned above in the &lt;Signers&gt; section&gt;\" /&gt;\n&lt;/DeniedSigners&gt;\n&lt;/ProductSigners&gt;\n&lt;/SigningScenario&gt;\n&lt;/SigningScenarios&gt;\n</code></pre>"},{"location":"WDAC/WDAC%20Notes/#guidance-on-creating-wdac-deny-policies","title":"Guidance on Creating WDAC Deny Policies","text":""},{"location":"WDAC/WDAC%20Notes/#how-to-verify-the-status-of-user-mode-and-kernel-mode-wdac-on-a-system","title":"How to verify the status of User-mode and Kernel-mode WDAC on a system","text":""},{"location":"WDAC/WDAC%20Notes/#using-powershell","title":"Using PowerShell","text":"<pre><code>Get-CimInstance -ClassName Win32_DeviceGuard -Namespace root\\Microsoft\\Windows\\DeviceGuard | select -Property *codeintegrity* | fl\n</code></pre> <p><code>2</code> means Enforced, <code>1</code> means Audit mode, <code>0</code> means Disabled/Not running.</p>"},{"location":"WDAC/WDAC%20Notes/#using-system-information","title":"Using System Information","text":"<p> <ul> <li>Windows Defender Application Control Policy (Kernel Mode)</li> <li>Windows Defender Application Control User Mode Policy (User Mode)</li> </ul> <p></p> <p></p> <p></p>"},{"location":"WDAC/WDAC%20Notes/#refreshing-wdac-policies","title":"Refreshing WDAC Policies","text":""},{"location":"WDAC/WDAC%20Notes/#using-the-built-in-citool","title":"Using the built-in CiTool","text":"<pre><code>CITool --refresh\n</code></pre>"},{"location":"WDAC/WDAC%20Notes/#old-method-using-refreshpolicyamd64exe","title":"Old Method: using RefreshPolicy(AMD64).exe","text":"<p>Using RefreshPolicy(AMD64).exe only works when you add a new policy to the Windows folder, but when you delete a policy from that folder, running RefreshPolicy(AMD64).exe won't make the apps that were previously allowed to run by the policy we just deleted, to be blocked from running again. so after we remove a policy from Windows folder, a system restart is required.</p> <p>This makes sense because apps that have been previously allowed to run by a policy that we just deleted might be still running in the background or even foreground, so to properly stop them, just running <code>RefreshPolicy(AMD64).exe</code> isn't enough and data loss could've occurred if that was the case.</p> <p></p> <p></p> <p></p>"},{"location":"WDAC/WDAC%20Notes/#about-signingscenarios-node-in-the-wdac-policy-xml","title":"About <code>&lt;SigningScenarios&gt;</code> node in the WDAC policy XML","text":"<p>It consists of 2 elements:</p> <p>This one contains the Certificates/Singers of the Kernel-mode drivers</p> <pre><code>&lt;SigningScenario Value=\"131\" ID=\"ID_SIGNINGSCENARIO_DRIVERS_1\" FriendlyName=\"Driver Signing Scenarios\"&gt;\n</code></pre> <p>And this one contains the Certificates/Singers of the User-mode binaries</p> <pre><code>&lt;SigningScenario Value=\"12\" ID=\"ID_SIGNINGSCENARIO_WINDOWS\" FriendlyName=\"User Mode Signing Scenarios\"&gt;\n</code></pre> <p>Only the <code>Value</code> needs to stay the same. So, for Kernel-mode drivers it should always be 131 and for User-mode binaries it should always be 12, anything else can be customized.</p> <p></p> <p></p> <p></p>"},{"location":"WDAC/WDAC%20Notes/#merging-policies","title":"Merging policies","text":"<p><code>Merge-cipolicy</code> cmdlet does not include duplicates, neither duplicate rules nor rules with duplicate file hashes.</p> <p></p> <p></p> <p></p>"},{"location":"WDAC/WDAC%20Notes/#wdac-forces-allow-list-architecture-by-nature","title":"WDAC forces Allow-list architecture by nature","text":"<p>WDAC forces Allow-list architecture by nature, not deny-list architecture. An empty deployed policy allows nothing to run and leads to system failure. This is why Microsoft recommended blocklists include 2 Allow All rules with the Deny rules, that changes the WDAC policy's nature from being an Allow-list to being a Deny-list.</p> <p></p> <p></p> <p></p>"},{"location":"WDAC/WDAC%20Notes/#about-microsoft-recommended-block-rules","title":"About Microsoft recommended block rules","text":""},{"location":"WDAC/WDAC%20Notes/#microsoft-recommended-block-rules","title":"Microsoft recommended block rules","text":"<p>From Microsoft recommended block rules document, copy the WDAC policy XML at the end (you might need to expand that section to view it), use a text editor like VS Code to edit it as recommended:</p> <p>The blocklist policy includes \"Allow all\" rules for both kernel and user mode that make it safe to deploy as a standalone WDAC policy. We can even deploy it side-by-side with AllowMicrosoft policy, by keeping its allow rules in place. Refer to this document about how multiple base policies work.</p> <p>\"Only applications allowed by both policies (All Base policies) run without generating block events\", that means even though the Microsoft recommended block rules have 2 allow all rules, they don't actually allow everything to run, because the same allow all rules don't exist in the default AllowMicrosoft policy, it only contains explicit allow rules.</p> <p>On Windows versions 1903 and above, Microsoft recommends converting this policy to multiple policy format using the <code>Set-CiPolicyIdInfo</code> cmdlet with the <code>-ResetPolicyId</code> switch. Then, you can deploy it as a Base policy side-by-side with any other policies in your environment.</p> <p>If merging into an existing policy that includes an explicit allowlist, you should first remove the two \"Allow all\" rules and their corresponding FileRuleRefs:</p> <pre><code>&lt;Allow ID=\"ID_ALLOW_A_1\" FriendlyName=\"Allow Kernel Drivers\" FileName=\"*\" /&gt;\n&lt;Allow ID=\"ID_ALLOW_A_2\" FriendlyName=\"Allow User mode components\" FileName=\"*\" /&gt;\n</code></pre> <pre><code>&lt;FileRuleRef RuleID=\"ID_ALLOW_A_1\" /&gt;\n&lt;FileRuleRef RuleID=\"ID_ALLOW_A_2\" /&gt;\n</code></pre> <p></p>"},{"location":"WDAC/WDAC%20Notes/#microsoft-recommended-driver-block-rules","title":"Microsoft recommended driver block rules","text":"<ul> <li> <p>Deploying Microsoft recommended block rules (Driver or user mode) alone, after removing the allow all rules from them, will cause boot failure, for obvious reasons.</p> </li> <li> <p>How to check the version of Microsoft recommended driver block rules that are being enforced</p> </li> <li> <p>The version is mentioned in Code Integrity operational event logs with an event ID of <code>3099</code> in the General tab.</p> </li> <li> <p>We don't need to use the Recommended Kernel Block Rules in WDAC when creating a policy because it's already being enforced by default and if we want to update it more regularly, we can do so by following this section of the document. Or by Fast and Automatic Microsoft Recommended Driver Block Rules updates.</p> </li> </ul> <p></p> <p>Citation: If you only manage Windows 11 22H2 systems (and above), then you don't need the recommended driver block rules in your WDAC policy. Otherwise, you should have the driver block rules in your policy. In either scenario, you should have the recommended user mode rules.</p> <p></p> <p>Citation: ISG does not include the recommended blocklist(s).</p> <p></p> <p>Citation: About deploying new Signed WDAC policies rebootlessly using CITool.</p> <p></p> <p></p> <p></p>"},{"location":"WDAC/WDAC%20Notes/#miscellaneous","title":"Miscellaneous","text":"<ul> <li> <p>Set the hypervisor Code Integrity option for the WDAC policy XML file to Strict only after using <code>Add-SignerRule</code> cmdlet, because after running <code>Add-SignerRule</code> cmdlet, the <code>&lt;HvciOptions&gt;</code> resets to <code>0</code>.</p> </li> <li> <p>Using Signtool.exe with <code>-fd certHash</code> will default to the algorithm used on the signing certificate. For example, if the certificate has <code>SHA512</code> hashing algorithm, the file that is being signed will use the same algorithm.</p> </li> <li> <p>Sometimes New-CIPolicy Cmdlet creates 2 file rules for each driver file, such as <code>.sys</code> files. One of them is stored in Driver signing scenarios section under <code>&lt;SigningScenario Value=\"131\" ID=\"ID_SIGNINGSCENARIO_DRIVERS_1\" FriendlyName=\"\"&gt;</code> and the other is stored in User mode signing scenarios section under <code>&lt;SigningScenario Value=\"12\" ID=\"ID_SIGNINGSCENARIO_WINDOWS\" FriendlyName=\"\"&gt;</code>. More info here</p> </li> <li> <p>File rule levels and Cmdlets like New-CiPolicy only create rules for binaries such as <code>.dll</code>, <code>.sys</code> and <code>.exe</code> files.</p> </li> </ul> <p></p> <p></p> <p></p>"},{"location":"WDAC/WDAC%20Notes/#blocking-individual-windows-components","title":"Blocking individual Windows components","text":""},{"location":"WDAC/WDAC%20Notes/#blocking-microsoft-store","title":"Blocking Microsoft Store","text":"<pre><code>$Package = Get-AppXPackage -Name \"Microsoft.WindowsStore\"\n$Rules += New-CIPolicyRule -Package $Package -Deny\nNew-CIPolicy -FilePath \".\\store.xml\" -Rules $Rules\n</code></pre>"},{"location":"WDAC/WDAC%20Notes/#file-rule-levels-security","title":"File rule levels security","text":"<p>(For User Mode binaries only)</p> <ul> <li> <p>Hash (Best for any files, specially unsigned files)</p> </li> <li> <p>FilePublisher (Best for Signed files)</p> </li> <li> <p>SignedVersion (More permissive than FilePublisher, usable only for signed files)</p> </li> </ul> <p>The rest are less secure and more permissive than the 3 file rule levels mentioned above.</p> <p>P.S FileName relies on the original filename for each binary, which can be modified.</p> <p>Find more information in Microsoft Learn</p> <p></p> <p></p> <p></p>"},{"location":"WDAC/WDAC%20Notes/#how-to-remove-flight-signing-certificates-from-default-example-policies","title":"How to remove flight signing certificates from default example policies","text":"<p>Removing these shouldn't cause any problem as long as you are using stable OS version</p> <pre><code># Flight root Certs removal \nRemove-CIPolicyRule -FilePath \"DefaultWindows_Enforced.xml\" -Id \"ID_SIGNER_STORE_FLIGHT_ROOT\"            \nRemove-CIPolicyRule -FilePath \"DefaultWindows_Enforced.xml\" -Id \"ID_SIGNER_WINDOWS_FLIGHT_ROOT\"\nRemove-CIPolicyRule -FilePath \"DefaultWindows_Enforced.xml\" -Id \"ID_SIGNER_ELAM_FLIGHT\"\nRemove-CIPolicyRule -FilePath \"DefaultWindows_Enforced.xml\" -Id \"ID_SIGNER_HAL_FLIGHT\"\nRemove-CIPolicyRule -FilePath \"DefaultWindows_Enforced.xml\" -Id \"ID_SIGNER_WHQL_FLIGHT_SHA2\"\nRemove-CIPolicyRule -FilePath \"DefaultWindows_Enforced.xml\" -Id \"ID_SIGNER_WINDOWS_FLIGHT_ROOT_USER\"\nRemove-CIPolicyRule -FilePath \"DefaultWindows_Enforced.xml\" -Id \"ID_SIGNER_ELAM_FLIGHT_USER\"\nRemove-CIPolicyRule -FilePath \"DefaultWindows_Enforced.xml\" -Id \"ID_SIGNER_HAL_FLIGHT_USER\"\nRemove-CIPolicyRule -FilePath \"DefaultWindows_Enforced.xml\" -Id \"ID_SIGNER_WHQL_FLIGHT_SHA2_USER\"\nRemove-CIPolicyRule -FilePath \"DefaultWindows_Enforced.xml\" -Id \"ID_SIGNER_RT_FLIGHT\"\n</code></pre> <p></p> <p></p> <p></p>"},{"location":"WDAC/WDAC%20Notes/#how-to-remove-wdac-policy-refresh-tool-certificates-from-default-example-policies","title":"How to remove WDAC policy Refresh tool certificates from default example policies","text":"<p>Starting with Windows 11 22H2, CITool is available in Windows by default and Refresh tool is no longer needed, so use the commands below to remove the certificates that allow that tool to be executed, their order of execution is important.</p> <ul> <li>Remove-CIPolicyRule</li> <li>Note</li> </ul> <pre><code>Remove-CIPolicyRule -FilePath \"DefaultWindows_Enforced.xml\" -Id \"ID_SIGNER_MICROSOFT_REFRESH_POLICY\"\nRemove-CIPolicyRule -FilePath \"DefaultWindows_Enforced.xml\" -Id \"ID_FILEATTRIB_REFRESH_POLICY\"\n</code></pre> <p></p> <p></p> <p></p>"},{"location":"WDAC/WDAC%20Notes/#allowing-questionable-software-in-a-wdac-policy","title":"Allowing questionable software in a WDAC policy","text":"<p>Questionable software such as pirated software are never recommended to be allowed to the WDAC policy because they are tampered with. Pirated software can have signed files too, but they are modified and as a result there is a mismatch between the file hash and the hash of the file saved in their digital signature. When such a mismatch exists for signed files, Authenticode reports the mismatch, and the file can't be allowed in a WDAC policy.</p> <p>If you want to go through many files and see which ones have a mismatch between their file hash and signature hash, you can use the following PowerShell (core) command, it searches through a folder and all of its sub-folders quickly using parallel operations:</p> <p></p> <pre><code>Get-ChildItem -Recurse -Path \"Path\\To\\a\\Folder\" -File | ForEach-Object -Parallel {Get-AuthenticodeSignature -FilePath $_.FullName} | Where-Object {$_.Status -eq 'HashMismatch'}\n</code></pre> <p></p> <p></p> <p></p>"},{"location":"WDAC/WDAC%20Notes/#about-the-concurrent-deployed-wdac-policies-limit","title":"About the concurrent deployed WDAC policies limit","text":"<p>The limit as stated in the official document is 32 active policies on a device at once. That is the total number of Base policies + Supplemental policies + any active system deployed policies.</p> <p></p> <p></p> <p></p>"},{"location":"WDAC/WDAC%20Notes/#performing-system-reset-while-signed-wdac-policy-is-deployed","title":"Performing system reset while Signed WDAC policy is deployed","text":"<p>If you've deployed a Signed WDAC policy on a system and then decide to reset it, either using local install or cloud download, it will fail during the reset process. You must remove the signed WDAC policy prior to performing the reset.</p> <p>Unsigned WDAC policies don't have this behavior. Since they are neither cryptographically signed nor tamper-proof, they will be removed during the reset process and after reset the system will not have the WDAC policy.</p> <p>This behavior is true for Lightly managed, Allow Microsoft and Default Windows WDAC policy types.</p> <p></p> <p></p> <p></p>"},{"location":"WDAC/WDAC%20Notes/#citool-no-longer-requires-guidcip-naming-convention-for-deployment","title":"CiTool no longer requires GUID.cip naming convention for deployment","text":"<p>Normally, <code>.cip</code> files would have to have the same name as the GUID of the xml file they were converted from, but that's no longer necessary. Using CiTool in Windows 11 build <code>22621</code>, they can be deployed with any name, even without a name, and lead to a successful WDAC policy deployment.</p> <p></p> <p></p> <p></p>"},{"location":"WDAC/WDAC%20Notes/#policies-with-requiredev-signers-rule-option","title":"Policies with Required:EV Signers rule option","text":"<p>If a base policy has rule option number 8, Required:EV Signers, it will require all kernel-mode drivers to have EV signer certificates. You cannot bypass this requirement with a Supplemental policy, you cannot allowlist non-EV signed files in any way. Non-EV signed files will be blocked even if the base policy is in Audit mode. This is true for any type of base policy such as Default Windows, Allow Microsoft, Strict Kernel mode etc.</p> <p></p> <p></p> <p></p>"},{"location":"WDAC/WDAC%20Notes/#the-following-policy-rule-options-only-apply-to-user-mode-binariesdrivers","title":"The following policy rule options only apply to User Mode binaries/drivers","text":"<ul> <li> <p>Enabled:Dynamic Code Security (generation)</p> </li> <li> <p>Required:Enforce Store Applications</p> </li> </ul> <p>When we remove the <code>SigningScenario Value=\"12\"</code> completely which is responsible for User Mode code integrity in the xml policy and also remove any signers that belong to User mode section, such as those that have <code>_user</code> in their ID, the Merge-CIPolicy cmdlet automatically removes EKUs that belong to the policy rule options mentioned above during a merge.</p> <p>Removing the User mode signers, rules and <code>Enabled:UMCI</code> rule option allows us to create a Kernel-only WDAC policy that doesn't touch User mode binaries/drivers.</p> <p>For a Kernel-mode only WDAC policy, only the following EKUs are necessary</p> <pre><code>&lt;EKUs&gt;\n&lt;EKU ID=\"ID_EKU_WINDOWS\" Value=\"010A2B0601040182370A0306\" FriendlyName=\"\" /&gt;\n&lt;EKU ID=\"ID_EKU_ELAM\" Value=\"010A2B0601040182373D0401\" FriendlyName=\"\" /&gt;\n&lt;EKU ID=\"ID_EKU_HAL_EXT\" Value=\"010a2b0601040182373d0501\" FriendlyName=\"\" /&gt;\n&lt;EKU ID=\"ID_EKU_WHQL\" Value=\"010A2B0601040182370A0305\" FriendlyName=\"\" /&gt;\n&lt;/EKUs&gt;\n</code></pre> <p></p> <p></p> <p></p>"},{"location":"WDAC/WDAC%20Notes/#you-can-merge-the-same-policy-xml-file-with-itself","title":"You can merge the same policy xml file with itself","text":"<p>In order to automatically remove unnecessary things from a policy file, such as the EKUs mentioned earlier, you can run a command like this:</p> <pre><code>Merge-CIPolicy .\\Policy.xml -OutputFilePath .\\Policy1.xml\n</code></pre> <p>It essentially merges a policy with itself, adding <code>_0</code> to each ID and SingerID of the xml nodes which is easily removable using WDACConfig module, although it's not necessary to remove them at all, they are perfectly fine.</p> <p></p> <p></p> <p></p>"},{"location":"WDAC/WDAC%20Notes/#-audit-parameter-of-the-configci-cmdlets","title":"-Audit parameter of the ConfigCI cmdlets","text":"<p>When you use <code>-Audit</code> parameter of ConfigCI cmdlets such as Get-SystemDriver and New-CIPolicy, these 2 event logs are scanned</p> <ol> <li>AppLocker \u2013 MSI and Script event log</li> <li>CodeIntegrity - Operational</li> </ol> <p>Explained more in here</p> <p></p> <p></p> <p></p>"},{"location":"WDAC/WDAC%20Notes/#about-double-signed-files-and-filepublisher-level","title":"About double-signed files and FilePublisher level","text":"<p>Sometimes there are files that are signed by 2 certificates, aka double signed files.</p> <p>When FilePublisher level is used, WDAC creates rules for both of the intermediate certificates of those files, and each rule will have a singer assigned to it. If the file is either User mode only or Kernel mode only, then 2 Signers will be created for it, one for each certificate.</p> <p>Depending on Kernel or use mode, 2 Allowed Signers are created for the file in either UMCI or KMCI Signing scenario sections.</p> <p>However, if the file is a kernel mode driver and user mode driver, then 4 signers are created for it, 2 Allowed Signers in the UMCI Signing Scenario and 2 in the KMCI Signing scenario.</p>"},{"location":"WDAC/WDAC%20Notes/#an-example","title":"An example","text":"<p>In the signer below</p> <pre><code>&lt;Signer ID=\"ID_SIGNER_F_2\" Name=\"Microsoft Windows Third Party Component CA 2014\"&gt;\n&lt;CertRoot Type=\"TBS\" Value=\"D8BE9E4D9074088EF818BC6F6FB64955E90378B2754155126FEEBBBD969CF0AE\" /&gt;\n&lt;CertPublisher Value=\"Microsoft Windows Hardware Compatibility Publisher\" /&gt;\n&lt;FileAttribRef RuleID=\"ID_FILEATTRIB_F_46\" /&gt;\n&lt;/Signer&gt;\n</code></pre> <p></p> <ul> <li><code>Name=\"Microsoft Windows Third Party Component CA 2014\"</code> is the Common name of the Intermediate certificate of the file</li> <li><code>Value=\"D8BE9E4D9074088EF818BC6F6FB64955E90378B2754155126FEEBBBD969CF0AE\"</code> is the TBS (To Be Signed) values of the same Intermediate certificate</li> <li><code>Value=\"Microsoft Windows Hardware Compatibility Publisher\"</code> is the Common name of the Leaf certificate of the file</li> </ul> <p></p>"},{"location":"WDAC/WDAC%20Notes/#some-notes","title":"Some Notes","text":"<ol> <li> <p>If 2 files have the same Leaf certificate CN and also have an Intermediate certificate in common (that has the same TBS and CN) then they should be listed under the same Signer.</p> </li> <li> <p>Any Intermediate certificate in the certificate chain/path of a file can be used to allow a file using FilePublisher.</p> </li> </ol> <p></p> <p></p> <p></p>"},{"location":"WDAC/WDAC%20Notes/#what-does-hvci-option-set-to-strict-mean","title":"What does HVCI option set to Strict mean?","text":"<p>HVCI stands for Hypervisor-protected Code Integrity and it is a feature that uses virtualization-based security (VBS) to protect the Windows kernel from memory attacks. HVCI can be set to different options in a WDAC policy, such as Enabled, DebugMode, or Strict. Setting HVCI to Strict in a WDAC policy provides the highest level of protection for kernel mode code integrity, as it enforces these additional restrictions:</p> <ul> <li> <p>It prevents unsigned drivers from loading, even if they are allowed by the WDAC policy. It prevents drivers that are not compatible with HVCI from loading, even if they are signed and allowed by the WDAC policy.</p> </li> <li> <p>It prevents drivers that have been tampered with or modified from loading, even if they are signed and allowed by the WDAC policy.</p> </li> <li> <p>Setting HVCI to Strict in a WDAC policy can help prevent malware or attackers from exploiting vulnerabilities in kernel mode drivers or bypassing the WDAC policy enforcement. </p> </li> </ul> <p></p> <p></p> <p></p>"},{"location":"WDAC/WDAC%20Notes/#continue-reading-about-byovd-protection-with-wdac","title":"Continue reading about BYOVD protection with WDAC","text":""},{"location":"WDAC/WDAC%20Notes/#wdac-policy-for-byovd-kernel-mode-only-protection","title":"WDAC policy for BYOVD Kernel mode only protection","text":""},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20%282nd%20variant%29/","title":"WDAC policy for Fully managed device - Variant 2","text":"Base policy type Method used Signed Protection score 1-5 Default Windows WDACConfig module No 4 <pre><code>flowchart TD\n    A(Deploy Default Windows base policy) --&gt;B(Identify Important apps that need Supplemental policy)\n    B --&gt; C(Create and Deploy Supplemental polcies for them)\n    C --&gt; D[Another App is getting blocked?]\n    D --&gt; E[Is it a normal app?]\n    E --&gt; F[Create Supplemental policy based on App's directory]\n    D --&gt; G[Is it a game Installed using Xbox app?]\n    G --&gt; H[Is it an app that installs drivers outside app's directory?]\n    H --&gt; I[Use Event viewer logs + game/app's directory scan]\n    I --&gt; J[Edit-WDACConfig -AllowNewAppsAuditEvents]\n    I --&gt; K[Edit-SignedWDACConfig -AllowNewAppsAuditEvents]       \n    D --&gt; L[Want to allow an entire folder?]\n    L --&gt; M[Use folder path with one or more Wildcards]\n    M --&gt; N[New-SupplementalWDACConfig -FilePathWildCards]\n    F --&gt; O[Edit-WDACConfig -AllowNewApps]\n    F --&gt; P[Edit-SignedWDACConfig -AllowNewApps]\n    F --&gt; Q[New-SupplementalWDACConfig -Normal]</code></pre> <p>Every time I use the word \"App\", I'm referring to regular Win32 programs as well as Microsoft Store installed apps; Basically any software that you can run.</p> <p>This scenario provides a very high protection level. Using the WDACConfig module, it's very easy to deploy, manage and maintain a system with this configuration.</p>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20%282nd%20variant%29/#deploy-the-default-windows-base-policy-on-the-system","title":"Deploy the Default Windows base policy on the system","text":"<p>Start by deploying the Default Windows base policy on the system, which allows only files and apps that come pre-installed in Windows to run and anything else is blocked.</p> <p>Since this is an unsigned policy, no reboot is required but it's better to perform a reboot if you want the currently running non-Windows apps to stop running.</p> <p></p> <pre><code>New-WDACConfig -MakeDefaultWindowsWithBlockRules -Deployit\n</code></pre> <ul> <li>Cmdlet info</li> </ul> <p>After deploying the base policy, you can create Supplemental policies to allow other apps that don't come by default with Windows to run. To do that, you have multiple options.</p> <p></p>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20%282nd%20variant%29/#creating-supplemental-policy-for-apps-already-installed","title":"Creating Supplemental policy for apps already installed","text":"<p>If you deployed the Default Windows base policy on a system that already had apps installed, you can create Supplemental policy for them using the following syntaxes:</p>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20%282nd%20variant%29/#based-on-signer-rules-hashes-file-names-etc","title":"Based on signer rules, hashes, file names etc","text":"<pre><code>New-SupplementalWDACConfig -Normal -ScanLocation \"C:\\Program Files\\Program\" -SuppPolicyName \"App's Name\" -PolicyPath \"C:\\DefaultWindowsPlusBlockRules.xml\" -Deployit\n</code></pre> <ul> <li>Parameter info</li> </ul>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20%282nd%20variant%29/#based-on-file-path-with-one-or-more-wildcard-characters","title":"Based on File path with one or more wildcard characters","text":"<pre><code>New-SupplementalWDACConfig -FilePathWildCards -WildCardPath \"C:\\Program Files\\Program\\*\" -SuppPolicyName \"App's Name\" -PolicyPath\n\"C:\\DefaultWindowsPlusBlockRules.xml\" -Deployit\n</code></pre> <ul> <li>Parameter info</li> </ul>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20%282nd%20variant%29/#based-on-an-installed-windows-apps-name","title":"Based on an installed Windows app's name","text":"<pre><code>New-SupplementalWDACConfig -InstalledAppXPackages -PackageName \"*App's name*\" -SuppPolicyName \"App's name\" -PolicyPath \"C:\\DefaultWindowsPlusBlockRules.xml\" -Deployit\n</code></pre> <ul> <li>Parameter info</li> </ul>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20%282nd%20variant%29/#creating-supplemental-policy-for-new-app-installations-or-apps-already-installed","title":"Creating Supplemental policy for new app installations or apps already installed","text":"<p>If the app you are trying to allow isn't installed and when you try to install it you see a blocked/error message, you can use the following syntaxes to allow them to run and then automatically create Supplemental policy for them.</p> <p>These methods also work for apps that were installed prior to deploying the Default Windows base policy and now you want to allow them to run by creating Supplemental policy for them.</p> <p>You can create a Supplemental policy for more than 1 app at a time by browsing for multiple apps' install directories using the commands below.</p> <p></p>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20%282nd%20variant%29/#based-on-apps-install-directory-and-event-viewer-logs","title":"Based on App's install directory and Event viewer logs","text":"<pre><code>Edit-WDACConfig -AllowNewAppsAuditEvents -SuppPolicyName \"App's Name\" -PolicyPaths \"C:\\DefaultWindowsPlusBlockRules.xml\" -LogSize 20MB\n</code></pre> <ul> <li>Parameter info</li> </ul>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20%282nd%20variant%29/#based-on-apps-install-directory-only","title":"Based on App's install directory only","text":"<pre><code>Edit-WDACConfig -AllowNewApps -SuppPolicyName \"App's Name\" -PolicyPaths \"C:\\DefaultWindowsPlusBlockRules.xml\"\n</code></pre> <ul> <li>Parameter info</li> </ul>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20%282nd%20variant%29/#what-to-do-if-you-have-a-lot-of-supplemental-policies","title":"What to do if you have a lot of Supplemental policies?","text":"<p>Currently, the limit for the number of policies (Base + Supplemental) that can be deployed on a system at a time is 32. So if you are getting close to that limit, you can merge some or all of your Supplemental policies automatically into 1 using the command below:</p> <pre><code>Edit-WDACConfig -MergeSupplementalPolicies -SuppPolicyName \"Merge of Multiple Supplementals\" -PolicyPaths \"C:\\DefaultWindowsPlusBlockRules.xml\" -SuppPolicyPaths \"C:\\Supplemental policy for App1.xml\",\"C:\\Supplemental policy for App 2.xml\",\"C:\\Supplemental policy for App 3.xml\"\n</code></pre> <ul> <li>Parameter info</li> </ul> <p></p>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20%282nd%20variant%29/#what-to-do-when-there-is-an-update-for-an-allowed-app","title":"What to do when there is an update for an allowed app ?","text":"<p>If you've created a Supplemental policy for an app that is already installed and now there is a newer version of that app available, you have multiple options:</p> <ol> <li> <p>If the Supplemental policy that you created to allow that app is based on FilePath with wildcards, then the app can be updated and no change in policy is required.</p> </li> <li> <p>If the Supplemental policy is based on PFN (Package Family Name) of the app, available only for MSIX apps installed through Microsoft Store, then you don't need to take any action and the app will be updated without any issues.</p> </li> <li> <p>If the Supplemental policy is only based on the app's digital signature, which is common for well-made apps, then you don't need to take any further action. As long as the new version of the app has the same digital signature / developer identity, then it will be allowed to run.</p> </li> <li> <p>If the Supplemental policy is based on individual File Paths (in contrast to wildcard FilePath rules), or based on FileName rules, then most likely there is no need for any further action to be taken as long as the new app's version uses the same file names or the same file paths for its components.</p> </li> <li> <p>If the Supplemental policy is based on Hash of the app's files, either partially (mixed with signer rules) or entirely (for apps without any digital identity/signature) then all you have to do is to remove the deployed Supplemental policy and create a new Supplemental policy for the app using live audit mode in the module as explained above. Don't need to reboot immediately, but to finish the removal process of a Supplemental policy, whether it's signed or unsigned, a reboot will be eventually needed.</p> </li> </ol> <p></p>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20Variant%203/","title":"WDAC policy for Fully managed device - Variant 3","text":"Base policy type Method used Signed Protection score 1-5 Allow Microsoft WDACConfig module Yes 4.5 <pre><code>flowchart TD\n    A(Deploy Allow Microsoft Signed base policy) --&gt;B(Start running your programs)\n    B --&gt; C[An App is getting blocked?]\n    C --&gt; D[Is it a normal app?]\n    D --&gt; E[Create Supplemental policy based on App's directory]\n    E --&gt; F[New-SupplementalWDACConfig -Normal]\n    F --&gt; G[Deploy-SignedWDACConfig]\n    E --&gt; H[Edit-SignedWDACConfig -AllowNewApps]\n    C --&gt; I[Is it a game Installed using Xbox app?]\n    I --&gt; J[Is it an app that installs drivers outside app's directory?]\n    J --&gt; K[Use Event viewer logs + game/app's directory scan]\n    K --&gt; L[Edit-SignedWDACConfig -AllowNewAppsAuditEvents]\n    C --&gt; M[Want to allow an entire folder?]\n    M --&gt; N[Use folder path with one or more Wildcards]\n    N --&gt; O[New-SupplementalWDACConfig -FilePathWildCards]</code></pre> <p>Every time I use the word \"App\", I'm referring to regular Win32 programs as well as Microsoft Store installed apps; Basically any software that you can run.</p> <p>This scenario provides a very high protection level. Using the WDACConfig module, it's very easy to deploy, manage and maintain a system with this configuration.</p>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20Variant%203/#deploy-the-allow-microsoft-base-policy-on-the-system","title":"Deploy the Allow Microsoft base policy on the system","text":"<p>Start by creating the Allow Microsoft base policy xml file, which allows only files and apps that are signed by Microsoft's trusted root certificate.</p> <pre><code>New-WDACConfig -MakeAllowMSFTWithBlockRules\n</code></pre> <ul> <li>Parameter info</li> </ul> <p></p> <p>Now what we have the policy xml file for the Allow Microsoft base policy, we need to sign and deploy it.</p> <pre><code>Deploy-SignedWDACConfig -CertPath \"C:\\Certificate.cer\" -PolicyPaths \"C:\\AllowMicrosoftPlusBlockRules.xml\" -CertCN \"WDAC Certificate\"\n</code></pre> <ul> <li>Cmdlet info</li> </ul> <p></p> <p>Since this is a signed base policy, you need to perform a reboot after deployment so that the anti-tamper protection of a signed base policy will start.</p> <p>After deploying the base policy, you can create Supplemental policies to allow other apps that aren't signed by Microsoft's trusted root certificate to run. To do that, you have multiple options.</p> <p></p>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20Variant%203/#creating-supplemental-policy-for-apps-already-installed","title":"Creating Supplemental policy for apps already installed","text":"<p>If you deployed the Allow Microsoft base policy on a system that already had apps installed, you can create Supplemental policy for them using the following syntaxes. After creating each Supplemental policy, you need to sign and deploy it using the same Cmdlet we used above.</p>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20Variant%203/#based-on-signer-rules-hashes-file-names-etc","title":"Based on signer rules, hashes, file names etc","text":"<pre><code>New-SupplementalWDACConfig -Normal -ScanLocation \"C:\\Program Files\\Program\" -SuppPolicyName \"App's Name\" -PolicyPath \"C:\\AllowMicrosoftPlusBlockRules.xml\"\n</code></pre> <ul> <li>Parameter info</li> </ul>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20Variant%203/#based-on-file-path-with-one-or-more-wildcard-characters","title":"Based on File path with one or more wildcard characters","text":"<pre><code>New-SupplementalWDACConfig -FilePathWildCards -WildCardPath \"C:\\Program Files\\Program\\*\" -SuppPolicyName \"App's Name\" -PolicyPath\n\"C:\\AllowMicrosoftPlusBlockRules.xml\"\n</code></pre> <ul> <li>Parameter info</li> </ul>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20Variant%203/#based-on-an-installed-windows-apps-name","title":"Based on an installed Windows app's name","text":"<pre><code>New-SupplementalWDACConfig -InstalledAppXPackages -PackageName \"*App's name*\" -SuppPolicyName \"App's name\" -PolicyPath \"C:\\AllowMicrosoftPlusBlockRules.xml\"\n</code></pre> <ul> <li>Parameter info</li> </ul>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20Variant%203/#creating-supplemental-policy-for-new-app-installations-or-apps-already-installed","title":"Creating Supplemental policy for new app installations or apps already installed","text":"<p>If the app you are trying to allow isn't installed and when you try to install it you see a blocked/error message, you can use the following syntaxes to allow them to run and then automatically create Supplemental policy for them.</p> <p>These methods also work for apps that were installed prior to deploying the Allow Microsoft base policy and now you want to allow them to run by creating Supplemental policy for them.</p> <p>You can create a Supplemental policy for more than 1 app at a time by browsing for multiple apps' install directories using the commands below.</p> <p></p>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20Variant%203/#based-on-apps-install-directory-and-event-viewer-logs","title":"Based on App's install directory and Event viewer logs","text":"<pre><code>Edit-SignedWDACConfig -AllowNewAppsAuditEvents -CertPath \"C:\\Certificate.cer\" -SuppPolicyName \"App's Name\" -PolicyPaths \"C:\\AllowMicrosoftPlusBlockRules.xml\" -CertCN \"WDAC Certificate\" -LogSize 20MB\n</code></pre> <ul> <li>Parameter info</li> </ul>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20Variant%203/#based-on-apps-install-directory-only","title":"Based on App's install directory only","text":"<pre><code>Edit-SignedWDACConfig -AllowNewApps -CertPath \"C:\\Certificate.cer\" -SuppPolicyName \"App's Name\" -PolicyPaths \"C:\\AllowMicrosoftPlusBlockRules.xml\" -CertCN \"WDAC Certificate\"\n</code></pre> <ul> <li>Parameter info</li> </ul>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20Variant%203/#what-to-do-if-you-have-a-lot-of-supplemental-policies","title":"What to do if you have a lot of Supplemental policies?","text":"<p>Currently, the limit for the number of policies (Base + Supplemental) that can be deployed on a system at a time is 32. So if you are getting close to that limit, you can merge some or all of your Supplemental policies automatically into 1 using the command below:</p> <pre><code>Edit-SignedWDACConfig -MergeSupplementalPolicies -CertPath \"C:\\Certificate.cer\" -SuppPolicyName \"Merge of Multiple Supplementals\" -PolicyPaths \"C:\\AllowMicrosoftPlusBlockRules.xml\" -CertCN \"WDAC Certificate\" -SuppPolicyPaths \"C:\\Supplemental policy for App1.xml\",\"C:\\Supplemental policy for App 2.xml\",\"C:\\Supplemental policy for App 3.xml\"\n</code></pre> <ul> <li>Parameter info</li> </ul> <p></p>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20Variant%203/#what-to-do-when-there-is-an-update-for-an-allowed-app","title":"What to do when there is an update for an allowed app ?","text":"<p>If you've created a Supplemental policy for an app that is already installed and now there is a newer version of that app available, you have multiple options:</p> <ol> <li> <p>If the Supplemental policy that you created to allow that app is based on FilePath with wildcards, then the app can be updated and no change in policy is required.</p> </li> <li> <p>If the Supplemental policy is based on PFN (Package Family Name) of the app, available only for MSIX apps installed through Microsoft Store, then you don't need to take any action and the app will be updated without any issues.</p> </li> <li> <p>If the Supplemental policy is only based on the app's digital signature, which is common for well-made apps, then you don't need to take any further action. As long as the new version of the app has the same digital signature / developer identity, then it will be allowed to run.</p> </li> <li> <p>If the Supplemental policy is based on individual File Paths (in contrast to wildcard FilePath rules), or based on FileName rules, then most likely there is no need for any further action to be taken as long as the new app's version uses the same file names or the same file paths for its components.</p> </li> <li> <p>If the Supplemental policy is based on Hash of the app's files, either partially (mixed with signer rules) or entirely (for apps without any digital identity/signature) then all you have to do is to remove the deployed Supplemental policy and create a new Supplemental policy for the app using live audit mode in the module as explained above. Don't need to reboot immediately, but to finish the removal process of a Supplemental policy, whether it's signed or unsigned, a reboot will be eventually needed.</p> </li> </ol> <p></p>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20Variant%204/","title":"WDAC policy for Fully managed device - Variant 4","text":"Base policy type Method used Signed Protection score 1-5 Default Windows WDACConfig module Yes 5 <pre><code>flowchart TD\n    A(Deploy Default Windows base policy) --&gt;B(Identify Important apps that need Supplemental policy)\n    B --&gt; C(Create and Deploy Supplemental polcies for them)\n    C --&gt; D[Another App is getting blocked?]\n    D --&gt; E[Is it a normal app?]\n    E --&gt; F[Create Supplemental policy based on App's directory]\n    D --&gt; G[Is it a game Installed using Xbox app?]\n    G --&gt; H[Is it an app that installs drivers outside app's directory?]\n    H --&gt; I[Use Event viewer logs + game/app's directory scan]\n    I --&gt; J[Edit-WDACConfig -AllowNewAppsAuditEvents]\n    I --&gt; K[Edit-SignedWDACConfig -AllowNewAppsAuditEvents]       \n    D --&gt; L[Want to allow an entire folder?]\n    L --&gt; M[Use folder path with one or more Wildcards]\n    M --&gt; N[New-SupplementalWDACConfig -FilePathWildCards]\n    F --&gt; O[Edit-WDACConfig -AllowNewApps]\n    F --&gt; P[Edit-SignedWDACConfig -AllowNewApps]\n    F --&gt; Q[New-SupplementalWDACConfig -Normal]</code></pre> <p>Every time I use the word \"App\", I'm referring to regular Win32 programs as well as Microsoft Store installed apps; Basically any software that you can run.</p> <p>This scenario provides the ultimate protection level. Using the WDACConfig module, it's very easy to deploy, manage and maintain a system with this configuration.</p>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20Variant%204/#deploy-the-default-windows-base-policy-on-the-system","title":"Deploy the Default Windows base policy on the system","text":"<p>Start by creating the Default Windows base policy xml file, which allows only files and apps that come pre-installed in Windows to run and anything else is blocked.</p> <pre><code>New-WDACConfig -MakeDefaultWindowsWithBlockRules\n</code></pre> <ul> <li>Parameter info</li> </ul> <p></p> <p>Now what we have the policy xml file for the Default Windows base policy, we need to sign and deploy it.</p> <pre><code>Deploy-SignedWDACConfig -CertPath \"C:\\Certificate.cer\" -PolicyPaths \"C:\\DefaultWindowsPlusBlockRules.xml\" -CertCN \"WDAC Certificate\"\n</code></pre> <ul> <li>Cmdlet info</li> </ul> <p></p> <p>Since this is a signed base policy, you need to perform a reboot after deployment so that the anti-tamper protection of a signed base policy will start.</p> <p>After deploying the base policy, you can create Supplemental policies to allow other apps that don't come by default with Windows to run. To do that, you have multiple options.</p> <p></p>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20Variant%204/#creating-supplemental-policy-for-apps-already-installed","title":"Creating Supplemental policy for apps already installed","text":"<p>If you deployed the Default Windows base policy on a system that already had apps installed, you can create Supplemental policy for them using the following syntaxes. After creating each Supplemental policy, you need to sign and deploy it using the same Cmdlet we used above.</p>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20Variant%204/#based-on-signer-rules-hashes-file-names-etc","title":"Based on signer rules, hashes, file names etc","text":"<pre><code>New-SupplementalWDACConfig -Normal -ScanLocation \"C:\\Program Files\\Program\" -SuppPolicyName \"App's Name\" -PolicyPath \"C:\\DefaultWindowsPlusBlockRules.xml\" \n</code></pre> <ul> <li>Parameter info</li> </ul>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20Variant%204/#based-on-file-path-with-one-or-more-wildcard-characters","title":"Based on File path with one or more wildcard characters","text":"<pre><code>New-SupplementalWDACConfig -FilePathWildCards -WildCardPath \"C:\\Program Files\\Program\\*\" -SuppPolicyName \"App's Name\" -PolicyPath\n\"C:\\DefaultWindowsPlusBlockRules.xml\" \n</code></pre> <ul> <li>Parameter info</li> </ul>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20Variant%204/#based-on-an-installed-windows-apps-name","title":"Based on an installed Windows app's name","text":"<pre><code>New-SupplementalWDACConfig -InstalledAppXPackages -PackageName \"*App's name*\" -SuppPolicyName \"App's name\" -PolicyPath \"C:\\DefaultWindowsPlusBlockRules.xml\" \n</code></pre> <ul> <li>Parameter info</li> </ul>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20Variant%204/#creating-supplemental-policy-for-new-app-installations-or-apps-already-installed","title":"Creating Supplemental policy for new app installations or apps already installed","text":"<p>If the app you are trying to allow isn't installed and when you try to install it you see a blocked/error message, you can use the following syntaxes to allow them to run and then automatically create Supplemental policy for them.</p> <p>These methods also work for apps that were installed prior to deploying the Default Windows base policy and now you want to allow them to run by creating Supplemental policy for them.</p> <p>You can create a Supplemental policy for more than 1 app at a time by browsing for multiple apps' install directories using the commands below.</p> <p></p>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20Variant%204/#based-on-apps-install-directory-and-event-viewer-logs","title":"Based on App's install directory and Event viewer logs","text":"<pre><code>Edit-SignedWDACConfig -AllowNewAppsAuditEvents -CertPath \"C:\\Certificate.cer\" -SuppPolicyName \"App's Name\" -PolicyPaths \"C:\\DefaultWindowsPlusBlockRules.xml\" -CertCN \"WDAC Certificate\" -LogSize 20MB\n</code></pre> <ul> <li>Parameter info</li> </ul>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20Variant%204/#based-on-apps-install-directory-only","title":"Based on App's install directory only","text":"<pre><code>Edit-SignedWDACConfig -AllowNewApps -CertPath \"C:\\Certificate.cer\" -SuppPolicyName \"App's Name\" -PolicyPaths \"C:\\DefaultWindowsPlusBlockRules.xml\" -CertCN \"WDAC Certificate\"\n</code></pre> <ul> <li>Parameter info</li> </ul>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20Variant%204/#what-to-do-if-you-have-a-lot-of-supplemental-policies","title":"What to do if you have a lot of Supplemental policies?","text":"<p>Currently, the limit for the number of policies (Base + Supplemental) that can be deployed on a system at a time is 32. So if you are getting close to that limit, you can merge some or all of your Supplemental policies automatically into 1 using the command below:</p> <pre><code>Edit-SignedWDACConfig -MergeSupplementalPolicies -CertPath \"C:\\Certificate.cer\" -SuppPolicyName \"Merge of Multiple Supplementals\" -PolicyPaths \"C:\\DefaultWindowsPlusBlockRules.xml\" -CertCN \"WDAC Certificate\" -SuppPolicyPaths \"C:\\Supplemental policy for App1.xml\",\"C:\\Supplemental policy for App 2.xml\",\"C:\\Supplemental policy for App 3.xml\"\n</code></pre> <ul> <li>Parameter info</li> </ul> <p></p>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices%20Variant%204/#what-to-do-when-there-is-an-update-for-an-allowed-app","title":"What to do when there is an update for an allowed app ?","text":"<p>If you've created a Supplemental policy for an app that is already installed and now there is a newer version of that app available, you have multiple options:</p> <ol> <li> <p>If the Supplemental policy that you created to allow that app is based on FilePath with wildcards, then the app can be updated and no change in policy is required.</p> </li> <li> <p>If the Supplemental policy is based on PFN (Package Family Name) of the app, available only for MSIX apps installed through Microsoft Store, then you don't need to take any action and the app will be updated without any issues.</p> </li> <li> <p>If the Supplemental policy is only based on the app's digital signature, which is common for well-made apps, then you don't need to take any further action. As long as the new version of the app has the same digital signature / developer identity, then it will be allowed to run.</p> </li> <li> <p>If the Supplemental policy is based on individual File Paths (in contrast to wildcard FilePath rules), or based on FileName rules, then most likely there is no need for any further action to be taken as long as the new app's version uses the same file names or the same file paths for its components.</p> </li> <li> <p>If the Supplemental policy is based on Hash of the app's files, either partially (mixed with signer rules) or entirely (for apps without any digital identity/signature) then all you have to do is to remove the deployed Supplemental policy and create a new Supplemental policy for the app using live audit mode in the module as explained above. Don't need to reboot immediately, but to finish the removal process of a Supplemental policy, whether it's signed or unsigned, a reboot will be eventually needed.</p> </li> </ol> <p></p>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices/","title":"WDAC policy for Fully Managed device - Variant 1","text":"Base policy type Method used Signed Protection score 1-5 Allow Microsoft / Default Windows WDACConfig module No 4 <ul> <li> <p>This variant helps you create and deploy a WDAC policy for fully managed device using only Event Viewer audit logs.</p> </li> <li> <p>This scenario includes using explicit Allow rules for files and certificates/singers, anything not allowed by the policies we are going to make are automatically denied/blocked.</p> </li> </ul> <p></p>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices/#prepare-a-virtual-machine","title":"Prepare a Virtual Machine","text":"<p>Install Hyper-V role from optional Windows features if you haven't already.</p> <pre><code>Enable-WindowsOptionalFeature -Online -FeatureName Containers-DisposableClientVM -All -norestart\n</code></pre> <p></p> <p>Download the latest Windows <code>.ISO</code> file from Microsoft website, create a new VM with it, install Windows and log in. Fully update Windows and then restart to apply the updates. You can create a Hyper-V checkpoint at this point so that you can return back to this clean state later on if you need to.</p> <p></p>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices/#prepare-a-base-policy","title":"Prepare a Base policy","text":"<p>There are 2 types of base policies you can choose from.</p> <ol> <li>Allow Microsoft: Allows only files and apps that are signed by Microsoft's trusted root certificate.</li> <li>Default Windows: Allows only files and apps that come pre-installed by Windows.</li> </ol>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices/#deploy-the-allow-microsoft-prep-mode-base-policy","title":"Deploy the Allow Microsoft Prep mode base policy","text":"<pre><code>New-WDACConfig -PrepMSFTOnlyAudit -LogSize 10MB\n</code></pre>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices/#parameter-info","title":"Parameter Info","text":""},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices/#deploy-the-default-windows-prep-mode-base-policy","title":"Deploy the Default Windows Prep mode base policy","text":"<pre><code>New-WDACConfig -PrepDefaultWindowsAudit -LogSize 10MB\n</code></pre>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices/#parameter-info_1","title":"Parameter Info","text":"<p>Depending on whichever of the option you choose, it deploys the base policy in audit mode. No reboot required.</p> <p></p>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices/#generate-audit-event-logs-on-the-system","title":"Generate Audit event logs on the system","text":"<p>Install all of the programs that you want to allow in the WDAC policy, on the VM. These are the programs that you want to allow to run and be installed on the target system once you've deployed the WDAC policy.</p> <ul> <li> <p>Installing or running 3rd party non-Microsoft programs, while Allow Microsoft policy in Audit mode is deployed on the VM, generates event logs for each of the programs and their files.</p> </li> <li> <p>Installing or running any program that doesn't come pre-installed by default with Windows, while Default Windows policy in Audit mode is deployed on the VM, generates event logs for each of the programs and their files.</p> </li> </ul> <p>These event logs are exactly what we need to identify and create Allow rules for the detected files.</p> <p>Only files that are executed during Prep mode phase generate event logs, so by simply installing a program using its installer, we can't trigger event log generation for each of the components and executables that each program has. So, after installing the programs, run them, use them a bit as you normally would so that all of the programs' components are executed and event logs generated for them.</p> <p></p>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices/#generate-supplemental-policy-from-the-audit-event-logs","title":"Generate Supplemental policy from the Audit event logs","text":""},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices/#if-you-chose-the-allow-microsoft-path","title":"If you chose the Allow Microsoft path","text":"<pre><code>New-WDACConfig -MakePolicyFromAuditLogs -BasePolicyType 'Allow Microsoft Base' -NoDeletedFiles\n</code></pre>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices/#parameter-info_2","title":"Parameter Info","text":""},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices/#if-you-chose-the-default-windows-path","title":"If you chose the Default Windows path","text":"<pre><code>New-WDACConfig -MakePolicyFromAuditLogs -BasePolicyType 'Default Windows Base' -NoDeletedFiles\n</code></pre>"},{"location":"WDAC/WDAC%20for%20Fully%20Managed%20Devices/#parameter-info_3","title":"Parameter Info","text":"<p>All of the outputs are saved in a folder named \"WDAC\" inside the current working directory.</p> <p>If you use the <code>-Deployit</code> optional switch parameter with the commands above, 3 things will automatically happen:</p> <ol> <li>The deployed Prep mode base policy will be removed.</li> <li>The actual base policy will be deployed depending on whichever you choose.</li> <li>The Supplemental policy generated from Audit logs will be deployed.</li> </ol> <p></p> <p>If you don't use the <code>-Deployit</code> switch, you can deploy the <code>.cip</code> binary files manually using CITool.</p> <p>More info on deployment</p> <p>Information about how to Sign and Deploy a Signed WDAC policy.</p> <p></p> <pre><code>flowchart TD\n    A(Deploy Allow Microsoft base policy) --&gt;B(Start running your programs)\n    B --&gt; C[An App is getting blocked?]\n    C --&gt; D[Is it a normal app?]\n    D --&gt; E[Create Supplemental policy based on App's directory]\n    E --&gt; F[New-SupplementalWDACConfig -Normal]\n    E --&gt; G[Edit-WDACConfig -AllowNewApps]\n    C --&gt; H[Is it a game Installed using Xbox app?]\n    H --&gt; I[Is it an app that installs drivers outside app's directory?]\n    I --&gt; J[Use Event viewer logs + game/app's directory scan]\n    J --&gt; K[Edit-WDACConfig -AllowNewAppsAuditEvents]\n    C --&gt; L[Want to allow an entire folder?]\n    L --&gt; M[Use folder path with one or more Wildcards]\n    M --&gt; N[New-SupplementalWDACConfig -FilePathWildCards]</code></pre> <p></p> <p></p> <pre><code>flowchart TD\n    A(Deploy Default Windows base policy) --&gt;B(Identify Important apps that need Supplemental policy)\n    B --&gt; C(Create and Deploy Supplemental polcies for them)\n    C --&gt; D[Another App is getting blocked?]\n    D --&gt; E[Is it a normal app?]\n    E --&gt; F[Create Supplemental policy based on App's directory]\n    D --&gt; G[Is it a game Installed using Xbox app?]\n    G --&gt; H[Is it an app that installs drivers outside app's directory?]\n    H --&gt; I[Use Event viewer logs + game/app's directory scan]\n    I --&gt; J[Edit-WDACConfig -AllowNewAppsAuditEvents]      \n    D --&gt; L[Want to allow an entire folder?]\n    L --&gt; M[Use folder path with one or more Wildcards]\n    M --&gt; N[New-SupplementalWDACConfig -FilePathWildCards]\n    F --&gt; O[Edit-WDACConfig -AllowNewApps]\n    F --&gt; Q[New-SupplementalWDACConfig -Normal]</code></pre>"},{"location":"WDAC/WDAC%20for%20Lightly%20Managed%20Devices/","title":"WDAC policy for Lightly managed device","text":"Base policy type Method used Signed Protection score 1-5 Signed and Reputable (ISG) WDACConfig module No / Yes 3.5 / 4 <p>Every time I use the word \"App\", I'm referring to regular Win32 programs as well as Microsoft Store installed apps; Basically any software that you can run.</p> <p>This scenario provides a high protection level, higher if you cryptographically Sign it. Using the WDACConfig module, it's very easy to deploy, manage and maintain a system with this configuration.</p> <pre><code>flowchart TD\n    A(Deploy WDAC base policy with ISG) --&gt;B(Start using your apps)\n    B --&gt; C(Did your app run without problem?)\n    C --&gt;|Yes| D[Awesome]\n    C --&gt;|No| E[Create a Supplemental policy for it]    </code></pre>"},{"location":"WDAC/WDAC%20for%20Lightly%20Managed%20Devices/#deploy-the-signed-and-reputable-base-policy-on-the-system","title":"Deploy the Signed and Reputable base policy on the system","text":"<p>Start by deploying the Signed and Reputable base policy on the system, which allows only files and apps that are authorized by the Intelligent Security Graph Authorization which have known good state to run and anything else is blocked.</p>"},{"location":"WDAC/WDAC%20for%20Lightly%20Managed%20Devices/#unsigned-version","title":"Unsigned version","text":"<pre><code>New-WDACConfig -MakeLightPolicy -Deployit\n</code></pre> <ul> <li>Parameter info</li> </ul>"},{"location":"WDAC/WDAC%20for%20Lightly%20Managed%20Devices/#signed-version","title":"Signed version","text":"<pre><code>New-WDACConfig -MakeLightPolicy\n</code></pre> <ul> <li>Parameter info</li> </ul> <pre><code>Deploy-SignedWDACConfig -CertPath \"C:\\Certificate.cer\" -PolicyPaths \"C:\\Users\\HotCakeX\\SignedAndReputable.xml\" -CertCN \"WDAC Certificate\"\n</code></pre> <ul> <li>Cmdlet info</li> </ul> <ul> <li> <p>The module creates Signed and Reputable WDAC base Policy based on AllowMicrosoft policy template with ISG related rule options, then merges Microsoft recommended block rules with it. We don't merge Microsoft recommended driver block rules because it is already enabled by default in Windows.</p> </li> <li> <p>The module also automatically stars the Application Identity (<code>AppIDSvc</code>) service required for ISG Authorization and sets its startup to Automatic. It's a protected service so can't be disabled or modified using Services snap-in.</p> </li> <li> <p>ISG Authorization requires active Internet connection for obvious reasons, to communicate with the global ISG network etc.</p> </li> <li> <p>Recommneded to perform a reboot regardless of whether you are deploying signed or unsigned version of the \"Signed and Reputable\" WDAC base policy.</p> </li> </ul> <p></p> <p>After finishing deploying the Signed and Reputable base policy, if there is an app that is getting blocked and you want to allow it, you can create Supplemental policies to expand your base policy. To do that, you have multiple options.</p> <p></p>"},{"location":"WDAC/WDAC%20for%20Lightly%20Managed%20Devices/#creating-supplemental-policy-for-apps-already-installed","title":"Creating Supplemental policy for apps already installed","text":"<p>The following commands use the <code>-Deployit</code> optional switch parameter, meaning after Supplemental policy creation, they are automatically deployed on the system. If you chose the Signed path, omit it from the commands and instead use the <code>Deploy-SignedWDACConfig</code> Cmdlet to Sign and Deploy the Supplemental policy xml files.</p>"},{"location":"WDAC/WDAC%20for%20Lightly%20Managed%20Devices/#based-on-signer-rules-hashes-file-names-etc","title":"Based on signer rules, hashes, file names etc","text":"<pre><code>New-SupplementalWDACConfig -Normal -ScanLocation \"C:\\Program Files\\Program\" -SuppPolicyName \"App's Name\" -PolicyPath \"C:\\SignedAndReputable.xml\" -Deployit\n</code></pre> <ul> <li>Parameter info</li> </ul>"},{"location":"WDAC/WDAC%20for%20Lightly%20Managed%20Devices/#based-on-file-path-with-one-or-more-wildcard-characters","title":"Based on File path with one or more wildcard characters","text":"<pre><code>New-SupplementalWDACConfig -FilePathWildCards -WildCardPath \"C:\\Program Files\\Program\\*\" -SuppPolicyName \"App's Name\" -PolicyPath\n\"C:\\SignedAndReputable.xml\" -Deployit\n</code></pre> <ul> <li>Parameter info</li> </ul>"},{"location":"WDAC/WDAC%20for%20Lightly%20Managed%20Devices/#based-on-an-installed-windows-apps-name","title":"Based on an installed Windows app's name","text":"<pre><code>New-SupplementalWDACConfig -InstalledAppXPackages -PackageName \"*App's name*\" -SuppPolicyName \"App's name\" -PolicyPath \"C:\\SignedAndReputable.xml\" -Deployit\n</code></pre> <ul> <li>Parameter info</li> </ul>"},{"location":"WDAC/WDAC%20for%20Lightly%20Managed%20Devices/#creating-supplemental-policy-for-new-app-installations-or-apps-already-installed","title":"Creating Supplemental policy for new app installations or apps already installed","text":"<p>If the app you are trying to allow isn't installed and when you try to install it you see a blocked/error message, you can use the following syntaxes to allow them to run and then automatically create Supplemental policy for them.</p> <p>These methods also work for apps that were installed prior to deploying the \"Signed and Reputable\" base policy and now you want to allow them to run by creating Supplemental policy for them.</p> <p>You can create a Supplemental policy for more than 1 app at a time by browsing for multiple apps' install directories using the commands below.</p> <p></p>"},{"location":"WDAC/WDAC%20for%20Lightly%20Managed%20Devices/#based-on-apps-install-directory-and-event-viewer-logs-unsigned-version","title":"Based on App's install directory and Event viewer logs - Unsigned version","text":"<pre><code>Edit-WDACConfig -AllowNewAppsAuditEvents -SuppPolicyName \"App's Name\" -PolicyPaths \"C:\\SignedAndReputable.xml\" -LogSize 20MB\n</code></pre> <ul> <li>Parameter info</li> </ul>"},{"location":"WDAC/WDAC%20for%20Lightly%20Managed%20Devices/#based-on-apps-install-directory-only-unsigned-version","title":"Based on App's install directory only - Unsigned version","text":"<pre><code>Edit-WDACConfig -AllowNewApps -SuppPolicyName \"App's Name\" -PolicyPaths \"C:\\SignedAndReputable.xml\"\n</code></pre> <ul> <li>Parameter info</li> </ul>"},{"location":"WDAC/WDAC%20for%20Lightly%20Managed%20Devices/#based-on-apps-install-directory-and-event-viewer-logs-signed-version","title":"Based on App's install directory and Event viewer logs - Signed version","text":"<pre><code>Edit-SignedWDACConfig -AllowNewAppsAuditEvents -CertPath \"C:\\Certificate.cer\" -SuppPolicyName \"App's Name\" -PolicyPaths \"C:\\SignedAndReputable.xml\" -CertCN \"WDAC Certificate\" -LogSize 20MB\n</code></pre> <ul> <li>Parameter info</li> </ul>"},{"location":"WDAC/WDAC%20for%20Lightly%20Managed%20Devices/#based-on-apps-install-directory-only-signed-version","title":"Based on App's install directory only - Signed version","text":"<pre><code>Edit-SignedWDACConfig -AllowNewApps -CertPath \"C:\\Certificate.cer\" -SuppPolicyName \"App's Name\" -PolicyPaths \"C:\\SignedAndReputable.xml\" -CertCN \"WDAC Certificate\"\n</code></pre> <ul> <li>Parameter info</li> </ul>"},{"location":"WDAC/WDAC%20for%20Lightly%20Managed%20Devices/#what-to-do-if-you-have-a-lot-of-supplemental-policies","title":"What to do if you have a lot of Supplemental policies?","text":"<p>Currently, the limit for the number of policies (Base + Supplemental) that can be deployed on a system at a time is 32. So if you are getting close to that limit, you can merge some or all of your Supplemental policies automatically into 1 using the command below:</p>"},{"location":"WDAC/WDAC%20for%20Lightly%20Managed%20Devices/#unsigned-version_1","title":"Unsigned version","text":"<pre><code>Edit-WDACConfig -MergeSupplementalPolicies -SuppPolicyName \"Merge of Multiple Supplementals\" -PolicyPaths \"C:\\SignedAndReputable.xml\" -SuppPolicyPaths \"C:\\Supplemental policy for App1.xml\",\"C:\\Supplemental policy for App 2.xml\",\"C:\\Supplemental policy for App 3.xml\"\n</code></pre> <ul> <li>Parameter info</li> </ul>"},{"location":"WDAC/WDAC%20for%20Lightly%20Managed%20Devices/#ssigned-version","title":"Ssigned version","text":"<pre><code>Edit-SignedWDACConfig -MergeSupplementalPolicies -CertPath \"C:\\Certificate.cer\" -SuppPolicyName \"Merge of Multiple Supplementals\" -PolicyPaths \"C:\\SignedAndReputable.xml\" -CertCN \"WDAC Certificate\" -SuppPolicyPaths \"C:\\Supplemental policy for App1.xml\",\"C:\\Supplemental policy for App 2.xml\",\"C:\\Supplemental policy for App 3.xml\"\n</code></pre> <ul> <li>Parameter info</li> </ul>"},{"location":"WDAC/WDAC%20for%20Lightly%20Managed%20Devices/#security-considerations","title":"Security Considerations","text":"<p>One of the differences between using ISG in a WDAC policy vs using Smart App Control (which also use ISG) is that WDAC policy + ISG rule option passes along reputation from app installers to the binaries they write to disk, it can over-authorize files in some cases. For example, if the installer launches the app upon completion, any files the app writes during that first run will also be allowed.</p> <p>Smart App Control however doesn't do this, it will trust the installer file itself if it's trustworthy and subsequently checks the trustworthiness of any binaries the installer tries to use and write to the disk, if any of those binaries or components can't be verified or are malicious, they get blocked.</p> <p>Explained more in here:</p> <ul> <li> <p>Security considerations with the ISG option</p> </li> <li> <p>Smart app control has blocked part of this app</p> </li> </ul> <p></p>"},{"location":"WDAC/WDAC%20for%20Lightly%20Managed%20Devices/#what-to-do-when-there-is-an-update-for-an-allowed-app","title":"What to do when there is an update for an allowed app ?","text":"<p>If you've created a Supplemental policy for an app that is already installed and now there is a newer version of that app available, you have multiple options:</p> <ol> <li> <p>If the Supplemental policy that you created to allow that app is based on FilePath with wildcards, then the app can be updated and no change in policy is required.</p> </li> <li> <p>If the Supplemental policy is based on PFN (Package Family Name) of the app, available only for MSIX apps installed through Microsoft Store, then you don't need to take any action and the app will be updated without any issues.</p> </li> <li> <p>If the Supplemental policy is only based on the app's digital signature, which is common for well-made apps, then you don't need to take any further action. As long as the new version of the app has the same digital signature / developer identity, then it will be allowed to run.</p> </li> <li> <p>If the Supplemental policy is based on individual File Paths (in contrast to wildcard FilePath rules), or based on FileName rules, then most likely there is no need for any further action to be taken as long as the new app's version uses the same file names or the same file paths for its components.</p> </li> <li> <p>If the Supplemental policy is based on Hash of the app's files, either partially (mixed with signer rules) or entirely (for apps without any digital identity/signature) then all you have to do is to remove the deployed Supplemental policy and create a new Supplemental policy for the app using live audit mode in the module as explained above. Don't need to reboot immediately, but to finish the removal process of a Supplemental policy, whether it's signed or unsigned, a reboot will be eventually needed.</p> </li> </ol> <p></p>"},{"location":"WDAC/WDAC%20policy%20for%20BYOVD%20Kernel%20mode%20only%20protection/","title":"WDAC policy for BYOVD Kernel mode only protection","text":"<p>This scenario involves removing the trust to any Kernel mode driver, whether they are vulnerable or not. It does not affect User-mode binaries or drivers.</p> <p>Any 3rd party software or hardware Kernel mode driver needs to be explicitly allowed. This scenario protects against all BYOVD scenarios and much more.</p> <p>Drivers can access the Kernel which is the core of the operating system. Microsoft requires all drivers to be digitally signed. BYOVD (Bring Your Own Vulnerable Driver) scenario involves using one of the digitally signed drivers that has a security hole to gain direct access to the core of the OS. This attack vector applies to all OSes, not just Windows.</p> <p>As you will see below, people who are requesting and acquiring code signing certificates, even for Extended Validation certificates, aren't being properly verified.</p> <ul> <li> <p>Kernel is the key to your kingdom.</p> </li> <li> <p>Do not waste your time playing cat and mouse with threat actors.</p> </li> <li> <p>Do not use blacklisting for highly secure workstations, sensitive environments and such; it\u2019s ineffective and insecure for a high security level.</p> </li> <li> <p>Whitelisting is the proper answer. This entire document and others in this repository, are exactly for this purpose.</p> </li> </ul> <p> </p> <p> YOUTUBE VIDEO: How to easily protect against BYOVD attack scenarios with WDAC policy in Windows </p> <p></p> <p></p> <p></p> <p></p>"},{"location":"WDAC/WDAC%20policy%20for%20BYOVD%20Kernel%20mode%20only%20protection/#there-are-3-types-of-kernel-mode-drivers-that-can-run-on-windows","title":"There are 3 types of Kernel mode drivers that can run on Windows","text":""},{"location":"WDAC/WDAC%20policy%20for%20BYOVD%20Kernel%20mode%20only%20protection/#regular-drivers","title":"Regular drivers","text":"<p>A regular signed driver is a driver that has been digitally signed by the developer using a software publisher certificate (SPC) issued by a Microsoft approved Certificate Authority (CA).</p> <p>These are regular signed Kernel mode drivers from 3rd parties that shouldn't be trusted by default in a secure and high-risk environment.</p>"},{"location":"WDAC/WDAC%20policy%20for%20BYOVD%20Kernel%20mode%20only%20protection/#whql-drivers","title":"WHQL drivers","text":"<p>A WHQL driver is a driver that has been tested and certified by Microsoft's Windows Hardware Quality Labs (WHQL). A WHQL driver has passed Microsoft's compatibility tests and can be distributed through Windows Update or other Microsoft-supported channels, while a regular signed driver may not have passed those tests and may not be eligible. A WHQL driver is signed by Microsoft.</p> <p>WHQL drivers have a slightly higher security bar than regular Kernel mode drivers. Any driver updates are required to pass the WHQL testing too.</p>"},{"location":"WDAC/WDAC%20policy%20for%20BYOVD%20Kernel%20mode%20only%20protection/#ev-signed-drivers","title":"EV Signed Drivers","text":"<p>EV signed kernel mode drivers are drivers that have been signed with an extended validation (EV) code signing certificate issued by a trusted certificate authority (CA).</p> <p>EV certificates cost more than regular code signing certificates, they require to be on an HSM (to ensure the private key is stored properly) and CAs issuing them only validate that the company of the person requesting them exists. Anyone can get EV certificate as long as they have a HSM and a company, which is not hard to come by, costs about ~100$ to set up in the US as a resident.</p> <p>Sometimes the issuing CA also needs you to send in your driver's license and a picture of you holding it, but things like extended background checks, criminal history check, nationality check, or the proper checks explained in here are not performed.</p> <p></p> <p></p> <p></p>"},{"location":"WDAC/WDAC%20policy%20for%20BYOVD%20Kernel%20mode%20only%20protection/#how-to-make-a-strict-kernel-mode-wdac-policy","title":"How to make a strict Kernel mode WDAC policy","text":"<p>We take the Default Windows example policy from <code>C:\\Windows\\schemas\\CodeIntegrity\\ExamplePolicies</code> and remove the following items from it:</p>"},{"location":"WDAC/WDAC%20policy%20for%20BYOVD%20Kernel%20mode%20only%20protection/#from-the-ekus-section","title":"From the EKUs section","text":"<ul> <li> <p><code>ID_EKU_WHQL</code> which is for WHQL (Windows Hardware Quality Labs), it allows 3rd party drivers that have WHQL certification to run, but since we are making a strict Kernel-mode WDAC policy, we want to handpick which Kernel mode drivers get to run on the system.</p> </li> <li> <p><code>\"ID_EKU_RT_EXT\"</code> belongs to Windows Runtime, Usermode only.</p> </li> <li> <p><code>\"ID_EKU_STORE\"</code> for Microsoft Store apps, Usermode only.</p> </li> <li> <p><code>\"ID_EKU_DCODEGEN\"</code> for .NET hardening Dynamic Code Security, user mode only, the linked document mentions it's Usermode too.</p> </li> <li> <p><code>\"ID_EKU_AM\"</code> Usermode only.</p> </li> <li> <p><code>&lt;EKU ID=\"ID_EKU_AM\" FriendlyName=\"AntiMalware EKU -1.3.6.1.4.1.311.76.11.1 \" Value=\"010a2b0601040182374c0b01\" /&gt;</code></p> </li> <li> <p>EKU (Enhanced Key Usage) is a field in a digital certificate that specifies the purposes for which the certificate can be used.</p> </li> <li> <p>The FriendlyName attribute of the EKU is a human-readable name that describes the purpose of the certificate. The FriendlyName also includes the Object Identifier (OID) of the certificate, which is a numeric code that identifies who issued the certificate and what it is for. The OID follows a hierarchical structure, where each dot-separated number represents a level of authority or category.</p> </li> <li> <p>The Value attribute of the EKU, <code>010a2b0601040182374c0b01</code> is a hexadecimal representation of the OID, which is used by WDAC to validate the certificate. The Value must match the OID exactly, otherwise WDAC will not trust the certificate. It corresponds to the AntiMalware EKU certificate, which has an OID of <code>1.3.6.1.4.1.311.76.11.1</code>.</p> </li> <li> <p>This certificate is used to verify files that are signed by an antimalware vendor whose product is using Protected Process Light (PPL). The AntiMalware EKU does not apply to kernel mode drivers, only to user mode processes that are signed by an antimalware vendor.</p> </li> </ul> <pre><code>&lt;EKU ID=\"ID_EKU_WHQL\" Value=\"010A2B0601040182370A0305\" /&gt;\n&lt;EKU ID=\"ID_EKU_RT_EXT\" Value=\"010a2b0601040182370a0315\" /&gt;\n&lt;EKU ID=\"ID_EKU_STORE\" FriendlyName=\"Windows Store EKU - 1.3.6.1.4.1.311.76.3.1 Windows Store\" Value=\"010a2b0601040182374c0301\" /&gt;\n&lt;EKU ID=\"ID_EKU_DCODEGEN\" FriendlyName=\"Dynamic Code Generation EKU - 1.3.6.1.4.1.311.76.5.1\" Value=\"010A2B0601040182374C0501\" /&gt;\n&lt;EKU ID=\"ID_EKU_AM\" FriendlyName=\"AntiMalware EKU -1.3.6.1.4.1.311.76.11.1 \" Value=\"010a2b0601040182374c0b01\" /&gt;\n</code></pre> <p></p> <p></p> <p>For our strict Kernel-mode-only WDAC policy, only the following EKUs are necessary</p> <pre><code>&lt;EKUs&gt;\n&lt;EKU ID=\"ID_EKU_WINDOWS\" Value=\"010A2B0601040182370A0306\" FriendlyName=\"\" /&gt;\n&lt;EKU ID=\"ID_EKU_ELAM\" Value=\"010A2B0601040182373D0401\" FriendlyName=\"\" /&gt;\n&lt;EKU ID=\"ID_EKU_HAL_EXT\" Value=\"010a2b0601040182373d0501\" FriendlyName=\"\" /&gt;\n&lt;/EKUs&gt;\n</code></pre> <p></p>"},{"location":"WDAC/WDAC%20policy%20for%20BYOVD%20Kernel%20mode%20only%20protection/#from-the-filerules-section","title":"From the FileRules section","text":"<p>User Mode Refresh policy program</p> <pre><code>&lt;FileAttrib ID=\"ID_FILEATTRIB_REFRESH_POLICY\" FriendlyName=\"RefreshPolicy.exe FileAttribute\" FileName=\"RefreshPolicy.exe\" MinimumFileVersion=\"10.0.19042.0\" /&gt;\n</code></pre> <p></p>"},{"location":"WDAC/WDAC%20policy%20for%20BYOVD%20Kernel%20mode%20only%20protection/#from-the-signers-section","title":"From the Signers section","text":"<ul> <li>Any Signer with <code>_USER</code> in its ID indicating that it only applies to User Mode binaries/drivers</li> </ul> <ul> <li>Any Signer with <code>_RT</code> in its ID indicating that it belongs to Windows Runtime, which is User mode only.</li> </ul> <pre><code>&lt;Signer ID=\"ID_SIGNER_RT_PRODUCTION\" Name=\"Microsoft Product Root 2010 RT EKU\"&gt;\n&lt;CertRoot Type=\"Wellknown\" Value=\"06\" /&gt;\n&lt;CertEKU ID=\"ID_EKU_RT_EXT\" /&gt;\n&lt;/Signer&gt;\n&lt;Signer ID=\"ID_SIGNER_RT_FLIGHT\" Name=\"Microsoft Flighting Root 2014 RT EKU\"&gt;\n&lt;CertRoot Type=\"Wellknown\" Value=\"0E\" /&gt;\n&lt;CertEKU ID=\"ID_EKU_RT_EXT\" /&gt;\n&lt;/Signer&gt;\n&lt;Signer ID=\"ID_SIGNER_RT_STANDARD\" Name=\"Microsoft Standard Root 2011 RT EKU\"&gt;\n&lt;CertRoot Type=\"Wellknown\" Value=\"07\" /&gt;\n&lt;CertEKU ID=\"ID_EKU_RT_EXT\" /&gt;\n&lt;/Signer&gt;\n</code></pre> <ul> <li> <p>The following WHQL related Signers</p> </li> <li> <p>These are the certificates that Microsoft uses to sign 3rd party OEM drivers</p> </li> <li> <p>They are actually 1 certificate but in 3 different Hashing algorithms</p> </li> </ul> <pre><code>&lt;Signer ID=\"ID_SIGNER_WHQL_SHA2\" Name=\"Microsoft Product Root 2010 WHQL EKU\"&gt;\n&lt;CertRoot Type=\"Wellknown\" Value=\"06\" /&gt;\n&lt;CertEKU ID=\"ID_EKU_WHQL\" /&gt;\n&lt;/Signer&gt;\n&lt;Signer ID=\"ID_SIGNER_WHQL_SHA1\" Name=\"Microsoft Product Root WHQL EKU SHA1\"&gt;\n&lt;CertRoot Type=\"Wellknown\" Value=\"05\" /&gt;\n&lt;CertEKU ID=\"ID_EKU_WHQL\" /&gt;\n&lt;/Signer&gt;\n&lt;Signer ID=\"ID_SIGNER_WHQL_MD5\" Name=\"Microsoft Product Root WHQL EKU MD5\"&gt;\n&lt;CertRoot Type=\"Wellknown\" Value=\"04\" /&gt;\n&lt;CertEKU ID=\"ID_EKU_WHQL\" /&gt;\n&lt;/Signer&gt;\n</code></pre> <p></p> <ul> <li>And this Signer which allows WHQL for insider builds</li> </ul> <pre><code>&lt;Signer ID=\"ID_SIGNER_WHQL_FLIGHT_SHA2\" Name=\"Microsoft Flighting Root 2014 WHQL EKU\"&gt;\n&lt;CertRoot Type=\"Wellknown\" Value=\"0E\" /&gt;\n&lt;CertEKU ID=\"ID_EKU_WHQL\" /&gt;\n&lt;/Signer&gt;\n</code></pre> <p></p> <ul> <li>Test Signer, for when Driver signing test is used, <code>Bcdedit.exe -set TESTSIGNING ON</code></li> </ul> <pre><code>&lt;Signer ID=\"ID_SIGNER_TEST2010\" Name=\"MincryptKnownRootMicrosoftTestRoot2010\"&gt;\n&lt;CertRoot Type=\"Wellknown\" Value=\"0A\" /&gt;\n&lt;/Signer&gt;\n</code></pre> <p></p>"},{"location":"WDAC/WDAC%20policy%20for%20BYOVD%20Kernel%20mode%20only%20protection/#from-the-signingscenarios-section","title":"From the SigningScenarios section","text":""},{"location":"WDAC/WDAC%20policy%20for%20BYOVD%20Kernel%20mode%20only%20protection/#in-the-kernel-mode-signing-scenario-block","title":"In the Kernel Mode Signing Scenario block","text":"<ul> <li>Responsible for WHQL Signers we removed above</li> </ul> <pre><code>&lt;AllowedSigner SignerId=\"ID_SIGNER_WHQL_SHA2\" /&gt;\n&lt;AllowedSigner SignerId=\"ID_SIGNER_WHQL_SHA1\" /&gt;\n&lt;AllowedSigner SignerId=\"ID_SIGNER_WHQL_MD5\" /&gt;\n</code></pre> <ul> <li>Responsible for insider builds WHQL signers</li> </ul> <pre><code>&lt;AllowedSigner SignerId=\"ID_SIGNER_WHQL_FLIGHT_SHA2\" /&gt;\n</code></pre> <ul> <li>Responsible for Test Signer we removed above</li> </ul> <pre><code>&lt;AllowedSigner SignerId=\"ID_SIGNER_TEST2010\" /&gt;\n</code></pre>"},{"location":"WDAC/WDAC%20policy%20for%20BYOVD%20Kernel%20mode%20only%20protection/#in-the-user-mode-signing-scenario-block","title":"In the User Mode Signing Scenario block","text":"<p>This entire block should either be removed</p> <pre><code>&lt;!--User Mode Signing Scenario--&gt;\n&lt;SigningScenario Value=\"12\" ID=\"ID_SIGNINGSCENARIO_UMCI\" FriendlyName=\"User Mode Signing Scenario\"&gt;\n&lt;ProductSigners&gt;\n&lt;AllowedSigners&gt;\n&lt;AllowedSigner SignerId=\"ID_SIGNER_WINDOWS_PRODUCTION_USER\" /&gt;\n&lt;AllowedSigner SignerId=\"ID_SIGNER_ELAM_PRODUCTION_USER\" /&gt;\n&lt;AllowedSigner SignerId=\"ID_SIGNER_HAL_PRODUCTION_USER\" /&gt;\n&lt;AllowedSigner SignerId=\"ID_SIGNER_WHQL_SHA2_USER\" /&gt;\n&lt;AllowedSigner SignerId=\"ID_SIGNER_WHQL_SHA1_USER\" /&gt;\n&lt;AllowedSigner SignerId=\"ID_SIGNER_WHQL_MD5_USER\" /&gt;\n&lt;AllowedSigner SignerId=\"ID_SIGNER_WINDOWS_FLIGHT_ROOT_USER\" /&gt;\n&lt;AllowedSigner SignerId=\"ID_SIGNER_ELAM_FLIGHT_USER\" /&gt;\n&lt;AllowedSigner SignerId=\"ID_SIGNER_HAL_FLIGHT_USER\" /&gt;\n&lt;AllowedSigner SignerId=\"ID_SIGNER_WHQL_FLIGHT_SHA2_USER\" /&gt;\n&lt;AllowedSigner SignerId=\"ID_SIGNER_STORE\" /&gt;\n&lt;AllowedSigner SignerId=\"ID_SIGNER_STORE_FLIGHT_ROOT\" /&gt;\n&lt;AllowedSigner SignerId=\"ID_SIGNER_RT_PRODUCTION\" /&gt;\n&lt;AllowedSigner SignerId=\"ID_SIGNER_DRM\" /&gt;\n&lt;AllowedSigner SignerId=\"ID_SIGNER_DCODEGEN\" /&gt;\n&lt;AllowedSigner SignerId=\"ID_SIGNER_AM\" /&gt;\n&lt;AllowedSigner SignerId=\"ID_SIGNER_RT_FLIGHT\" /&gt;\n&lt;AllowedSigner SignerId=\"ID_SIGNER_RT_STANDARD\" /&gt;\n&lt;AllowedSigner SignerId=\"ID_SIGNER_MICROSOFT_REFRESH_POLICY\" /&gt;\n&lt;!-- Test signer is trusted by ConfigCI, however, it will not be trusted by CI unless testsigning BCD is set --&gt;\n&lt;AllowedSigner SignerId=\"ID_SIGNER_TEST2010_USER\" /&gt;\n&lt;/AllowedSigners&gt;\n&lt;/ProductSigners&gt;\n&lt;/SigningScenario&gt;\n</code></pre> <p>Or replaced with</p> <pre><code>&lt;SigningScenario Value=\"12\" ID=\"ID_SIGNINGSCENARIO_UMCI\" FriendlyName=\"User Mode Signing Scenario\"&gt;\n&lt;ProductSigners /&gt;\n&lt;/SigningScenario&gt;\n</code></pre> <p></p>"},{"location":"WDAC/WDAC%20policy%20for%20BYOVD%20Kernel%20mode%20only%20protection/#flight-root-signers-optional","title":"Flight root signers - Optional","text":"<p>They can also be removed if you don't intend to use Windows insider builds. They all have <code>flight</code> or <code>_flight</code> in their ID.</p> <p>When removing them, also use the 4 Disabled:Flight Signing policy rule option.</p> <p></p>"},{"location":"WDAC/WDAC%20policy%20for%20BYOVD%20Kernel%20mode%20only%20protection/#from-cisigners","title":"From CiSigners","text":"<p>Remove this item which is for Windows Store EKU</p> <pre><code>&lt;CiSigner SignerId=\"ID_SIGNER_STORE\" /&gt;\n</code></pre> <p></p> <p></p> <p></p>"},{"location":"WDAC/WDAC%20policy%20for%20BYOVD%20Kernel%20mode%20only%20protection/#how-to-use-and-automate-this-entire-process","title":"How to use and automate this entire process","text":"<p>Use the WDACConfig module to automatically Audit and deploy the Strict Kernel-mode WDAC policies.</p> <p>As mentioned earlier, this policy only enforces and applies to Kernel-mode drivers, so your non-Kernel mode files are unaffected. Keep in mind that Kernel-mode does not mean programs that require Administrator privileges, those 2 categories are completely different. Also, not all drivers are Kernel mode, there are user-mode drivers too.</p> <p>This strict Kernel mode policy can be perfectly deployed side by side any other WDAC policy.</p> <p>For instance, since HVCI is turned on by default on my system, the Microsoft Recommended driver block rules is automatically deployed and it's only Kernel mode. It has 2 allow all rules, making it primarily a block-list policy.</p> <p>Then I deploy Strict Kernel-mode WDAC policy, which also only applies to Kernel-mode drivers. It doesn't have allow all rules of course, instead it allows Windows components that are required for Windows to function properly to run and then will let you hand pick any 3rd party Kernel-mode drivers and easily allow them in your policy.</p> <p>Now the Allow all rules that exist in the first policy are neutralized. Only applications allowed by both policies run without generating block events., so since the same allow all rules do not exist in our Strict Kernel-mode base policy, they no longer apply.</p> <p></p>"},{"location":"WDAC/WDAC%20policy%20for%20BYOVD%20Kernel%20mode%20only%20protection/#what-about-user-mode-binaries","title":"What about User-mode binaries?","text":"<p>So far we've only been doing Kernel-mode administration. We can use User-mode WDAC policies as well.</p> <p>After using those 2 Kernel-mode policies, I deploy a 3rd policy which is going to authorize and validate User-mode binaries too. I choose the Lightly managed WDAC policy that utilizes ISG (Intelligent Security Graph). This policy applies to both Kernel and User modes, but since we already know the logic and learned that only applications allowed by all base policies are allowed to run, we're confident that our Strict Kernel-mode base policy is the only one in charge of authorizing and validating Kernel-mode files/drivers. Our User-mode WDAC policy that utilizes ISG validates User-mode binaries only.</p> <p></p>"},{"location":"WDAC/WDAC%20policy%20for%20BYOVD%20Kernel%20mode%20only%20protection/#a-rule-of-thumb","title":"A rule of thumb","text":"<p>The strictest policy wins the race in multiple base policy deployments, which in this case is the Strict Kernel-Mode policy. Even though ISG policy which uses Allow Microsoft rules and allows all the WHQL signed drivers, they still won't be able to run unless the Kernel-Mode policy authorizes them, because for a Kernel driver to be allowed to run in this scenario, all base policies must allow it.</p> <p>So only the policy that has the least allow listings in common with all other policies takes priority.</p> <p></p>"},{"location":"WDAC/WDAC%20policy%20for%20BYOVD%20Kernel%20mode%20only%20protection/#supplemental-policy","title":"Supplemental policy","text":"<p>Each of the deployed policies (except for the automatically deployed block rules by HVCI) support having supplemental policies. So, whenever you feel the need to allow additional files that are Kernel-mode drivers or User-mode binaries blocked by ISG, you can add a Supplemental policy for them.</p> <p></p> <p></p> <p></p>"},{"location":"WDAC/WDAC%20policy%20for%20BYOVD%20Kernel%20mode%20only%20protection/#continue-reading-about-important-wdac-notes","title":"Continue reading about important WDAC notes","text":""},{"location":"WDAC/WDAC%20policy%20for%20BYOVD%20Kernel%20mode%20only%20protection/#important-notes-and-tips-about-wdac-policies","title":"Important Notes and Tips  about WDAC policies","text":""},{"location":"WDACConfig%20Module/Confirm-WDACConfig/","title":"Confirm-WDACConfig available parameters","text":""},{"location":"WDACConfig%20Module/Confirm-WDACConfig/#notes","title":"Notes","text":"<ul> <li> <p>Mandatory parameters indicate you always need to provide values for them.</p> </li> <li> <p>Automatic parameters indicate that if you used Set-CommonWDACConfig cmdlet to set default values for them, the module will automatically use them. This saves time and prevents repetitive tasks. However, if no value exists in User Configurations for an Automatic parameter and you didn't explicitly provide a value for that parameter either, then you will see an error asking you to provide value for it. Explicitly providing a value for an Automatic parameter in the command line overrides its default value in User Configurations, meaning the module will ignore the value of the same parameter in the User Configurations file.</p> </li> <li> <p>Optional parameters indicate that they are not required and without using them the module will automatically run with the optimal settings.</p> </li> <li> <p>Many cmdlets and parameters of the module support the PowerShell's built-in <code>-Debug</code> switch and when that switch is used, they display extra details and debugging messages on the console, showing you what's happening under the hood.</p> </li> </ul> <p></p>"},{"location":"WDACConfig%20Module/Confirm-WDACConfig/#confirm-wdacconfig-listactivepolicies","title":"Confirm-WDACConfig -ListActivePolicies","text":"<pre><code>Confirm-WDACConfig [-ListActivePolicies] [-OnlyBasePolicies] [-OnlySupplementalPolicies]\n</code></pre> <p>Lists the non-System Base and Supplemental WDAC Policies using CITool and displays their counts.</p>"},{"location":"WDACConfig%20Module/Confirm-WDACConfig/#has-2-optional-parameter","title":"Has 2 optional parameter","text":"<ul> <li><code>-OnlyBasePolicies</code>: Using this will only display Base policies.</li> <li><code>-OnlySupplementalPolicies</code>: Using this will only display Supplemental policies.</li> </ul>"},{"location":"WDACConfig%20Module/Confirm-WDACConfig/#confirm-wdacconfig-verifywdacstatus","title":"Confirm-WDACConfig -VerifyWDACStatus","text":"<pre><code>Confirm-WDACConfig [-VerifyWDACStatus]\n</code></pre> <p>Shows the status of User-mode and Kernel-mode application control.</p> <p></p> <p></p> <p></p>"},{"location":"WDACConfig%20Module/Confirm-WDACConfig/#confirm-wdacconfig-checksmartappcontrolstatus","title":"Confirm-WDACConfig -CheckSmartAppControlStatus","text":"<pre><code>Confirm-WDACConfig [-CheckSmartAppControlStatus]\n</code></pre> <p>Checks the status of Smart App Control and reports the results on the console, including the evaluation mode expiration date.</p> <p></p>"},{"location":"WDACConfig%20Module/Deploy-SignedWDACConfig/","title":"Deploy-SignedWDACConfig available parameters","text":""},{"location":"WDACConfig%20Module/Deploy-SignedWDACConfig/#notes","title":"Notes","text":"<ul> <li> <p>Mandatory parameters indicate you always need to provide values for them.</p> </li> <li> <p>Automatic parameters indicate that if you used Set-CommonWDACConfig cmdlet to set default values for them, the module will automatically use them. This saves time and prevents repetitive tasks. However, if no value exists in User Configurations for an Automatic parameter and you didn't explicitly provide a value for that parameter either, then you will see an error asking you to provide value for it. Explicitly providing a value for an Automatic parameter in the command line overrides its default value in User Configurations, meaning the module will ignore the value of the same parameter in the User Configurations file.</p> </li> <li> <p>Optional parameters indicate that they are not required and without using them the module will automatically run with the optimal settings.</p> </li> <li> <p>Many cmdlets and parameters of the module support the PowerShell's built-in <code>-Debug</code> switch and when that switch is used, they display extra details and debugging messages on the console, showing you what's happening under the hood.</p> </li> </ul> <p></p>"},{"location":"WDACConfig%20Module/Deploy-SignedWDACConfig/#signs-and-deploys-a-wdac-policy","title":"Signs and Deploys a WDAC policy","text":"<pre><code>Deploy-SignedWDACConfig -CertPath &lt;String&gt; -PolicyPaths &lt;String[]&gt; -CertCN &lt;String&gt; [-SignToolPath &lt;String&gt;]\n</code></pre>"},{"location":"WDACConfig%20Module/Deploy-SignedWDACConfig/#1-mandatory-parameter","title":"1 mandatory parameter","text":"<ul> <li><code>-PolicyPaths &lt;String[]&gt;</code>: Accepts multiple policies; it can Sign and Deploy multiple policies at the same time. Supports tab completion by showing only <code>.xml</code> files with Base Policy Type.</li> </ul>"},{"location":"WDACConfig%20Module/Deploy-SignedWDACConfig/#2-automatic-parameters","title":"2 Automatic parameters","text":"<ul> <li> <p><code>-CertPath &lt;String&gt;</code>: Path to the certificate <code>.cer</code> file. Supports tab completion by showing only <code>.cer</code> files.</p> </li> <li> <p><code>CertCN &lt;String&gt;</code>: Common name of the certificate - Supports argument completion so you don't have to manually enter the Certificate's CN, just make sure the <code>-CertPath</code> is specified and the certificate is installed in the personal store of the user certificates, then press TAB to auto complete the name. You can however enter it manually if you want to.</p> </li> </ul>"},{"location":"WDACConfig%20Module/Deploy-SignedWDACConfig/#1-optional-parameter","title":"1 optional parameter","text":"<ul> <li><code>-SignToolPath &lt;String&gt;</code>: Supports tab completion by showing only <code>.exe</code> files.</li> </ul>"},{"location":"WDACConfig%20Module/Deploy-SignedWDACConfig/#you-can-use-it-in-2-different-ways","title":"You can use it in 2 different ways","text":"<ol> <li> <p>If Windows SDK Signing Tools for Desktop Apps components is installed in the default location <code>C:\\Program Files (x86)\\Windows Kits</code>, then <code>-SignToolPath &lt;String&gt;</code> parameter isn't necessary.</p> </li> <li> <p>If Windows SDK Signing Tools for Desktop Apps components is not installed in the default location or you want to manually browse for the <code>signtool.exe</code>, then make sure you use the <code>-SignToolPath &lt;String&gt;</code> parameter.</p> </li> </ol> <p></p>"},{"location":"WDACConfig%20Module/Edit-SignedWDACConfig/","title":"Edit-SignedWDACConfig available parameters","text":""},{"location":"WDACConfig%20Module/Edit-SignedWDACConfig/#notes","title":"Notes","text":"<ul> <li> <p>Mandatory parameters indicate you always need to provide values for them.</p> </li> <li> <p>Automatic parameters indicate that if you used Set-CommonWDACConfig cmdlet to set default values for them, the module will automatically use them. This saves time and prevents repetitive tasks. However, if no value exists in User Configurations for an Automatic parameter and you didn't explicitly provide a value for that parameter either, then you will see an error asking you to provide value for it. Explicitly providing a value for an Automatic parameter in the command line overrides its default value in User Configurations, meaning the module will ignore the value of the same parameter in the User Configurations file.</p> </li> <li> <p>Optional parameters indicate that they are not required and without using them the module will automatically run with the optimal settings.</p> </li> <li> <p>Many cmdlets and parameters of the module support the PowerShell's built-in <code>-Debug</code> switch and when that switch is used, they display extra details and debugging messages on the console, showing you what's happening under the hood.</p> </li> </ul> <p></p>"},{"location":"WDACConfig%20Module/Edit-SignedWDACConfig/#edit-signedwdacconfig-allownewappsauditevents","title":"Edit-SignedWDACConfig -AllowNewAppsAuditEvents","text":"<pre><code>Edit-SignedWDACConfig [-AllowNewAppsAuditEvents] -CertPath &lt;String&gt; -SuppPolicyName &lt;String&gt; -PolicyPaths\n&lt;String[]&gt; -CertCN &lt;String&gt; [-LogSize &lt;Int64&gt;] [-NoScript] [-NoUserPEs] [-AllowFileNameFallbacks]\n[-SpecificFileNameLevel &lt;String&gt;] [-IncludeDeletedFiles] [-Level &lt;String&gt;] [-Fallbacks &lt;String[]&gt;] [-SignToolPath\n&lt;String&gt;]\n</code></pre>"},{"location":"WDACConfig%20Module/Edit-SignedWDACConfig/#how-to-use","title":"How to use","text":"<ol> <li> <p>Using the provided syntax, run the command and supply values for the parameters.</p> </li> <li> <p>When prompted to start installing your apps, do so and once you're done, press Enter to continue. The rest is automated.</p> </li> </ol>"},{"location":"WDACConfig%20Module/Edit-SignedWDACConfig/#description","title":"Description","text":"<p>While a Signed Windows Defender Application Control (WDAC) policy is already deployed on the system, rebootlessly turns on Audit mode in it, which will allow you to install a new app that was otherwise getting blocked. After installation, you will need to browse for the path(s) of the installed app(s) for scanning. The Audit logs that will be included in the scan are only the ones created from the time you ran the module with -AllowNewAppsAuditEvents parameter till the time you finished app installations and browsed for folders to scan. This parameter can also be used for apps that are already installed on the system.</p> <p>A new supplemental policy will be created, it will be signed and deployed on the system. The base policy that was initially set to Audit mode will also revert back to enforced mode. The entire process happens without the need for reboot. If something like a power outage occurs during the time Audit mode is deployed, on the next reboot, the enforced mode base policy will be automatically deployed.</p> <p>This parameter is specially useful for applications that install files outside of their main install directory, such as system drivers. Make sure you run those applications after installation (and before starting to browse for their install directories) so that Audit logs will capture and create allow rules for them.</p> <p>This parameter can also detect and create allow rules for Kernel protected files, such as the executables of games installed using Xbox app. Make sure you run the game while the base policy is deployed in Audit mode, using this parameter, so that it can capture those executables.</p>"},{"location":"WDACConfig%20Module/Edit-SignedWDACConfig/#1-mandatory-parameter","title":"1 mandatory parameter","text":"<ul> <li><code>-SuppPolicyName &lt;String&gt;</code>: Add a descriptive name for the Supplemental policy.</li> </ul>"},{"location":"WDACConfig%20Module/Edit-SignedWDACConfig/#3-automatic-parameters","title":"3 Automatic parameters","text":"<ul> <li> <p><code>-CertPath &lt;String&gt;</code>: Path to the certificate <code>.cer</code> file. Supports tab completion by showing only <code>.cer</code> files.</p> </li> <li> <p><code>-PolicyPaths &lt;String[]&gt;</code>: Browse for the xml file of the Base policy this Supplemental policy is going to expand. Supports tab completion by showing only <code>.xml</code> files with Base Policy Type.</p> </li> <li> <p><code>-CertCN &lt;String&gt;</code>: Common name of the certificate used to sign the deployed WDAC policies - Supports argument completion so you don't have to manually enter the Certificate's CN, just make sure the certificate is installed in the personal store of the user certificates, then press TAB to auto complete the name. You can however enter it manually if you want to.</p> </li> </ul>"},{"location":"WDACConfig%20Module/Edit-SignedWDACConfig/#10-optional-parameters","title":"10 optional parameters","text":"<ul> <li> <p><code>-SignToolPath &lt;String&gt;</code>: You can use it in 2 different ways</p> </li> <li> <p><code>-Debug</code>: Indicates that the module will output these additional files for debugging purposes and also show debug messages on the console:</p> </li> <li>FileRulesAndFileRefs.txt - Contains the File Rules and Rule refs for the Hash of the files that no longer exist on the disk.</li> <li>DeletedFileHashesEventsPolicy.xml - If <code>-IncludeDeletedFiles</code> was used and if there were any files detected that were in audit event logs that are no longer on the disk, this file will include allow rules for them based on their hashes.</li> <li>ProgramDir_ScanResults.xml* - xml policy files for each program path that is selected by user, contains allow rules.</li> <li> <p>RulesForFilesNotInUserSelectedPaths.xml - xml policy file that has allow rules for files that do not reside in any of the user-selected program paths, but have been detected in audit event logs.</p> </li> <li> <p><code>-Levels &lt;String&gt;</code>: Offers the same official Levels for scanning of the specified directory paths and Event viewer audit logs. The Default value is FilePublisher.</p> </li> <li> <p><code>-Fallbacks &lt;String[]&gt;</code>: Offers the same official Fallbacks for scanning of the specified directory paths and Event viewer audit logs. The Default value is Hash.</p> </li> <li> <p><code>-LogSize &lt;Int64&gt;</code> - Specifies the log size for Microsoft-Windows-CodeIntegrity/Operational events. The values must be in the form of <code>&lt;Digit + Data measurement unit&gt;</code>. e.g., 2MB, 10MB, 1GB, 1TB. The minimum accepted value is 1MB which is the default.</p> </li> <li> <p><code>-AllowFileNameFallbacks</code>: More info available on Microsoft Learn</p> </li> <li> <p><code>-SpecificFileNameLevel</code>: You can choose one of the following options: \"OriginalFileName\", \"InternalName\", \"FileDescription\", \"ProductName\", \"PackageFamilyName\", \"FilePath\". More info available on Microsoft Learn</p> </li> <li> <p><code>-IncludeDeletedFiles</code>: Indicates that hashes of the files that were run during Audit phase but then were deleted and are no longer on the disk, will be added to the Supplemental policy. If you created a Supplemental policy for your program and it's still getting blocked, try using this parameter. Chances are your program writes and then deletes some files during runtime that are necessary to be included in the Supplemental policy.</p> </li> <li> <p><code>-NoUserPEs</code>: By default the module includes user PEs in the scans. When you use this switch parameter, they won't be included. More info available on Microsoft Learn</p> </li> <li> <p><code>-NoScript</code>: More info available on Microsoft Learn</p> </li> </ul> <p></p> <p></p> <p></p>"},{"location":"WDACConfig%20Module/Edit-SignedWDACConfig/#edit-signedwdacconfig-allownewapps","title":"Edit-SignedWDACConfig -AllowNewApps","text":"<pre><code>Edit-SignedWDACConfig [-AllowNewApps] -CertPath &lt;String&gt; -SuppPolicyName &lt;String&gt; -PolicyPaths &lt;String[]&gt; -CertCN\n&lt;String&gt; [-NoScript] [-NoUserPEs] [-AllowFileNameFallbacks] [-SpecificFileNameLevel &lt;String&gt;] [-Level &lt;String&gt;]\n[-Fallbacks &lt;String[]&gt;] [-SignToolPath &lt;String&gt;]\n</code></pre>"},{"location":"WDACConfig%20Module/Edit-SignedWDACConfig/#how-to-use_1","title":"How to use","text":"<ol> <li> <p>Using the provided syntax, run the command and supply values for the parameters.</p> </li> <li> <p>When prompted to start installing your apps, do so and once you're done, press Enter to continue. The rest is automated.</p> </li> </ol>"},{"location":"WDACConfig%20Module/Edit-SignedWDACConfig/#description_1","title":"Description","text":"<p>While a Signed Windows Defender Application Control (WDAC) policy is already deployed on the system, rebootlessly turns on Audit mode in it, which will allow you to install a new app that was otherwise getting blocked. After installation, you will need to browse for the path(s) of the installed app(s) for scanning. This parameter can also be used for apps that are already installed on the system.</p> <p>A new supplemental policy will be created, it will be signed and deployed on the system. The base policy that was initially set to Audit mode will also revert back to enforced mode. The entire process happens without the need for reboot. If something like a power outage occurs during the time Audit mode is deployed, on the next reboot, the enforced mode base policy will be automatically deployed.</p>"},{"location":"WDACConfig%20Module/Edit-SignedWDACConfig/#1-mandatory-parameter_1","title":"1 mandatory parameter","text":"<ul> <li><code>-SuppPolicyName &lt;String&gt;</code>: Add a descriptive name for the Supplemental policy.</li> </ul>"},{"location":"WDACConfig%20Module/Edit-SignedWDACConfig/#3-automatic-parameters_1","title":"3 Automatic parameters","text":"<ul> <li> <p><code>-CertPath &lt;String&gt;</code>: Path to the certificate <code>.cer</code> file. Supports tab completion by showing only <code>.cer</code> files.</p> </li> <li> <p><code>-PolicyPaths &lt;String[]&gt;</code>: Browse for the xml file of the Base policy this Supplemental policy is going to expand. Supports tab completion by showing only <code>.xml</code> files with Base Policy Type.</p> </li> <li> <p><code>-CertCN &lt;String&gt;</code>: Common name of the certificate used to sign the deployed WDAC policies - Supports argument completion so you don't have to manually enter the Certificate's CN, just make sure the certificate is installed in the personal store of the user certificates, then press TAB to auto complete the name. You can however enter it manually if you want to.</p> </li> </ul>"},{"location":"WDACConfig%20Module/Edit-SignedWDACConfig/#3-optional-parameters","title":"3 optional parameters","text":"<ul> <li> <p><code>-SignToolPath &lt;String&gt;</code>: You can use it in 2 different ways</p> </li> <li> <p><code>-Levels &lt;String&gt;</code>: Offers the same official Levels for scanning of the specified directory paths. If no level is specified the default, which is set to FilePublisher in this module, will be used.</p> </li> <li> <p><code>-Fallbacks &lt;String[]&gt;</code>: Offers the same official Fallbacks for scanning of the specified directory paths. If no fallbacks is specified the default, which is set to Hash in this module, will be used.</p> </li> </ul> <p></p> <p></p> <p></p>"},{"location":"WDACConfig%20Module/Edit-SignedWDACConfig/#edit-signedwdacconfig-mergesupplementalpolicies","title":"Edit-SignedWDACConfig -MergeSupplementalPolicies","text":"<pre><code>Edit-SignedWDACConfig [-MergeSupplementalPolicies] -CertPath &lt;String&gt; -SuppPolicyName &lt;String&gt; -PolicyPaths\n&lt;String[]&gt; -CertCN &lt;String&gt; -SuppPolicyPaths &lt;String[]&gt; [-KeepOldSupplementalPolicies] [-SignToolPath &lt;String&gt;]\n</code></pre> <p>Merge multiple deployed Signed Supplemental policies into 1 and deploy it, remove the individual ones, all happening automatically. Very useful to keep Supplemental policies below 32 since that's the limit.</p>"},{"location":"WDACConfig%20Module/Edit-SignedWDACConfig/#2-mandatory-parameters","title":"2 Mandatory Parameters","text":"<ul> <li> <p><code>-SuppPolicyName &lt;String&gt;</code>: Choose a descriptive name for the Supplemental policy that is going to be the merge of multiple policies.</p> </li> <li> <p><code>-SuppPolicyPaths &lt;String[]&gt;</code>: Path to the Supplemental policies xml files. Supports argument tab completion by showing only Supplemental policy types.</p> </li> </ul>"},{"location":"WDACConfig%20Module/Edit-SignedWDACConfig/#3-automatic-parameters_2","title":"3 Automatic parameters","text":"<ul> <li> <p><code>-PolicyPaths &lt;String[]&gt;</code>: Path to the Base policy xml file the Supplemental policies belong to. Supports argument tab completion by showing only Base policy types.</p> </li> <li> <p><code>-CertCN &lt;String&gt;</code>: Common name of the certificate used to sign the deployed WDAC policies - Supports argument completion so you don't have to manually enter the Certificate's CN, just make sure the certificate is installed in the personal store of the user certificates, then press TAB to auto complete the name. You can however enter it manually if you want to.</p> </li> <li> <p><code>-CertPath &lt;String&gt;</code>: Path to the certificate <code>.cer</code> file. Supports tab completion by showing only <code>.cer</code> files.</p> </li> </ul>"},{"location":"WDACConfig%20Module/Edit-SignedWDACConfig/#2-optional-parameters","title":"2 optional parameters","text":"<ul> <li> <p><code>-SignToolPath &lt;String&gt;</code>: You can use it in 2 different ways</p> </li> <li> <p><code>-KeepOldSupplementalPolicies</code>: Indicates that the module will not remove the old Supplemental policy xml files after creating and deploying the new merged one.</p> </li> <li> <p><code>-CertPath &lt;String&gt;</code>: Path to the certificate <code>.cer</code> file. Supports tab completion by showing only <code>.cer</code> files.</p> </li> </ul> <p></p> <p></p> <p></p>"},{"location":"WDACConfig%20Module/Edit-SignedWDACConfig/#edit-signedwdacconfig-updatebasepolicy","title":"Edit-SignedWDACConfig -UpdateBasePolicy","text":"<pre><code>Edit-SignedWDACConfig [-UpdateBasePolicy] -CertPath &lt;String&gt; -CertCN &lt;String&gt; -CurrentBasePolicyName &lt;String[]&gt;\n-NewBasePolicyType &lt;String&gt; [-SignToolPath &lt;String&gt;] [-RequireEVSigners]\n</code></pre> <p>It can rebootlessly change the type of the deployed signed base policy. It can update the recommended block rules and/or change policy rule options in the deployed base policy. The deployed Supplemental policies will stay intact and continue to work with the new Base policy.</p> <p>Hint: When switching from a more permissive base policy type to a more restrictive one, make sure your Supplemental policies will continue to work. E.g., if your current base policy type is Allow Microsoft and the one you are switching to is Default Windows, there might be files that will get blocked as a result of this switch if you created a Supplemental policy using Event viewer capturing. That's simply because they were allowed by the more permissive Allow Microsoft policy type so they didn't trigger audit logs thus weren't needed to be included in the Supplemental policy. You will need to update those Supplemental policies if that happens by deleting and recreating them, no immediate reboot required.</p>"},{"location":"WDACConfig%20Module/Edit-SignedWDACConfig/#2-mandatory-parameters_1","title":"2 mandatory parameters","text":"<ul> <li> <p><code>-CurrentBasePolicyName &lt;String[]&gt;</code>: The name of the currently deployed base policy. It supports tab completion so just press tab to autofill it.</p> </li> <li> <p><code>-NewBasePolicyType &lt;String&gt;</code>: The type of the base policy to deploy. It supports tab completion so just press tab to autofill it. Supports all 3 Base policy types:</p> </li> <li> <p>AllowMicrosoft_Plus_Block_Rules</p> </li> <li> <p>Lightly_Managed_system_Policy</p> </li> <li> <p>DefaultWindows_WithBlockRules</p> <ul> <li> <p>Since the module uses PowerShell and not Windows PowerShell that is pre-installed in Windows, selecting this argument will automatically scan <code>C:\\Program Files\\PowerShell</code> directory and add PowerShell files to the base policy so that you will be able to continue using the module after redeploying the base policy. The scan uses FilePublisher level and Hash fallback.</p> </li> </ul> </li> </ul>"},{"location":"WDACConfig%20Module/Edit-SignedWDACConfig/#2-automatic-parameters","title":"2 Automatic parameters","text":"<ul> <li> <p><code>-CertPath &lt;String&gt;</code>: Path to the certificate <code>.cer</code> file used to sign the deployed base policy. Supports tab completion by showing only <code>.cer</code> files.</p> </li> <li> <p><code>-CertCN &lt;String&gt;</code>: Common name of the certificate used to sign the deployed base WDAC policy - Supports argument completion so you don't have to manually enter the Certificate's CN, just make sure the certificate is installed in the personal store of the user certificates, then press TAB to auto complete the name. You can however enter it manually if you want to.</p> </li> </ul>"},{"location":"WDACConfig%20Module/Edit-SignedWDACConfig/#2-optional-parameters_1","title":"2 optional parameters","text":"<ul> <li> <p><code>-SignToolPath &lt;String&gt;</code>: You can use it in 2 different ways</p> </li> <li> <p><code>-RequireEVSigners</code>: Indicates that the base policy will have Require EV Signers policy rule option.</p> </li> </ul> <p></p> <p></p> <p></p>"},{"location":"WDACConfig%20Module/Edit-SignedWDACConfig/#the-logic-behind-signtoolpath-string-optional-parameter","title":"The logic behind <code>-SignToolPath &lt;String&gt;</code> optional parameter","text":"<ol> <li> <p>If Windows SDK Signing Tools for Desktop Apps components is installed in the default location <code>C:\\Program Files (x86)\\Windows Kits</code>, then <code>-SignToolPath &lt;String&gt;</code> parameter isn't necessary.</p> </li> <li> <p>If Windows SDK Signing Tools for Desktop Apps components is not installed in the default location or you want to manually browse for the <code>signtool.exe</code>, then make sure you use the <code>-SignToolPath &lt;String&gt;</code> parameter.</p> </li> </ol> <p></p>"},{"location":"WDACConfig%20Module/Edit-WDACConfig/","title":"Edit-WDACConfig available parameters","text":""},{"location":"WDACConfig%20Module/Edit-WDACConfig/#notes","title":"Notes","text":"<ul> <li> <p>Mandatory parameters indicate you always need to provide values for them.</p> </li> <li> <p>Automatic parameters indicate that if you used Set-CommonWDACConfig cmdlet to set default values for them, the module will automatically use them. This saves time and prevents repetitive tasks. However, if no value exists in User Configurations for an Automatic parameter and you didn't explicitly provide a value for that parameter either, then you will see an error asking you to provide value for it. Explicitly providing a value for an Automatic parameter in the command line overrides its default value in User Configurations, meaning the module will ignore the value of the same parameter in the User Configurations file.</p> </li> <li> <p>Optional parameters indicate that they are not required and without using them the module will automatically run with the optimal settings.</p> </li> <li> <p>Many cmdlets and parameters of the module support the PowerShell's built-in <code>-Debug</code> switch and when that switch is used, they display extra details and debugging messages on the console, showing you what's happening under the hood.</p> </li> </ul> <p></p>"},{"location":"WDACConfig%20Module/Edit-WDACConfig/#edit-wdacconfig-allownewappsauditevents","title":"Edit-WDACConfig -AllowNewAppsAuditEvents","text":"<pre><code>Edit-WDACConfig [-AllowNewAppsAuditEvents] -SuppPolicyName &lt;String&gt; -PolicyPaths &lt;String[]&gt; [-Level &lt;String&gt;]\n[-Fallbacks &lt;String[]&gt;] [-NoScript] [-NoUserPEs] [-AllowFileNameFallbacks] [-SpecificFileNameLevel &lt;String&gt;]\n[-LogSize &lt;Int64&gt;] [-IncludeDeletedFiles]\n</code></pre>"},{"location":"WDACConfig%20Module/Edit-WDACConfig/#how-to-use","title":"How to use","text":"<ol> <li> <p>Using the provided syntax, run the command and supply values for the parameters.</p> </li> <li> <p>When prompted to start installing your apps, do so and once you're done, press Enter to continue. The rest is automated.</p> </li> </ol>"},{"location":"WDACConfig%20Module/Edit-WDACConfig/#description","title":"Description","text":"<p>While an unsigned Windows Defender Application Control (WDAC) policy is already deployed on the system, rebootlessly turns on Audit mode in it, which will allow you to install a new app that was otherwise getting blocked.</p> <p>After running this command, you will be prompted to start installing your apps/programs. Once you're finished, you will need to browse for the path(s) of the installed app(s) for scanning. This parameter can also be used for apps that are already installed on the system.</p> <p>The Audit logs that will be included in the scan are only the ones created from the time you ran the module with -AllowNewAppsAuditEvents parameter till the time you finished app installations and browsed for folders to scan.</p> <p>A new supplemental policy will be created, it will be deployed on the system. The base policy that was initially set to Audit mode will also revert back to enforced mode. The entire process happens without the need for reboot. If something like a power outage occurs during the time Audit mode is deployed, on the next reboot, the enforced mode base policy will be automatically deployed.</p> <p>This parameter is specially useful for applications that install files outside of their main install directory, such as system drivers. Make sure you run those applications after installation (and before starting to browse for their install directories) so that Audit logs will capture and create allow rules for them.</p> <p>This parameter can also detect and create allow rules for Kernel protected files, such as the executables of games installed using Xbox app. Make sure you run the game while the base policy is deployed in Audit mode, using this parameter, so that it can capture those executables.</p>"},{"location":"WDACConfig%20Module/Edit-WDACConfig/#1-mandatory-parameter","title":"1 mandatory parameter","text":"<ul> <li><code>-SuppPolicyName &lt;String&gt;</code>: Add a descriptive name for the Supplemental policy.</li> </ul>"},{"location":"WDACConfig%20Module/Edit-WDACConfig/#1-automatic-parameter","title":"1 Automatic parameter","text":"<ul> <li><code>-PolicyPaths &lt;String[]&gt;</code>: Browse for the xml file of the Base policy this Supplemental policy is going to expand. Supports tab completion by showing only <code>.xml</code> files with Base Policy Type.</li> </ul>"},{"location":"WDACConfig%20Module/Edit-WDACConfig/#9-optional-parameters","title":"9 optional parameters","text":"<ul> <li><code>-Debug</code>: Indicates that the module will output these additional files for debugging purposes and also show debug messages on the console:</li> <li>FileRulesAndFileRefs.txt - Contains the File Rules and Rule refs for the Hash of the files that no longer exist on the disk.</li> <li>DeletedFileHashesEventsPolicy.xml - If <code>-IncludeDeletedFiles</code> was used and if there were any files detected that were in audit event logs that are no longer on the disk, this file will include allow rules for them based on their hashes.</li> <li>ProgramDir_ScanResults.xml* - xml policy files for each program path that is selected by user, contains allow rules.</li> <li> <p>RulesForFilesNotInUserSelectedPaths.xml - xml policy file that has allow rules for files that do not reside in any of the user-selected program paths, but have been detected in audit event logs.</p> </li> <li> <p><code>-LogSize &lt;Int64&gt;</code> - Specifies the log size for Microsoft-Windows-CodeIntegrity/Operational events. The values must be in the form of <code>&lt;Digit + Data measurement unit&gt;</code>. e.g., 2MB, 10MB, 1GB, 1TB. The minimum accepted value is 1MB which is the default.</p> </li> <li> <p><code>-Levels &lt;String&gt;</code>: Offers the same official Levels for scanning of the specified directory paths and Event viewer audit logs. The Default value is FilePublisher.</p> </li> <li> <p><code>-Fallbacks &lt;String[]&gt;</code>: Offers the same official Fallbacks for scanning of the specified directory paths and Event viewer audit logs. The Default value is Hash.</p> </li> <li> <p><code>-AllowFileNameFallbacks</code>: More info available on Microsoft Learn</p> </li> <li> <p><code>-SpecificFileNameLevel</code>: You can choose one of the following options: \"OriginalFileName\", \"InternalName\", \"FileDescription\", \"ProductName\", \"PackageFamilyName\", \"FilePath\". More info available on Microsoft Learn</p> </li> <li> <p><code>-IncludeDeletedFiles</code>: Indicates that hashes of the files that were run during Audit phase but then were deleted and are no longer on the disk, will be added to the Supplemental policy. If you created a Supplemental policy for your program and it's still getting blocked, try using this parameter. Chances are your program writes and then deletes some files during runtime that are necessary to be included in the Supplemental policy.</p> </li> <li> <p><code>-NoUserPEs</code>: By default the module includes user PEs in the scans. When you use this switch parameter, they won't be included. More info available on Microsoft Learn</p> </li> <li> <p><code>-NoScript</code>: More info available on Microsoft Learn</p> </li> </ul> <p></p> <p></p> <p></p>"},{"location":"WDACConfig%20Module/Edit-WDACConfig/#edit-wdacconfig-allownewapps","title":"Edit-WDACConfig -AllowNewApps","text":"<pre><code>Edit-WDACConfig [-AllowNewApps] -SuppPolicyName &lt;String&gt; -PolicyPaths &lt;String[]&gt; [-Level &lt;String&gt;] [-Fallbacks\n&lt;String[]&gt;] [-NoScript] [-NoUserPEs] [-AllowFileNameFallbacks] [-SpecificFileNameLevel &lt;String&gt;]\n</code></pre>"},{"location":"WDACConfig%20Module/Edit-WDACConfig/#how-to-use_1","title":"How to use","text":"<ol> <li> <p>Using the provided syntax, run the command and supply values for the parameters.</p> </li> <li> <p>When prompted to start installing your apps, do so and once you're done, press Enter to continue. The rest is automated.</p> </li> </ol>"},{"location":"WDACConfig%20Module/Edit-WDACConfig/#description_1","title":"Description","text":"<p>While an unsigned WDAC policy is already deployed on the system, rebootlessly turn on Audit mode in it, which will allow you to install a new app that was otherwise getting blocked. After installation, you will need to browse for the path(s) of the installed app(s) for scanning. This parameter can also be used for apps that are already installed on the system.</p> <p>A new supplemental policy will be created, it will be deployed on the system. The base policy that was initially set to Audit mode will also revert back to enforced mode. The entire process happens without the need for reboot. If something like a power outage occurs during the time Audit mode is deployed, on the next reboot, the enforced mode base policy will be automatically deployed.</p>"},{"location":"WDACConfig%20Module/Edit-WDACConfig/#1-mandatory-parameter_1","title":"1 mandatory parameter","text":"<ul> <li><code>-SuppPolicyName &lt;String&gt;</code>: Add a descriptive name for the Supplemental policy.</li> </ul>"},{"location":"WDACConfig%20Module/Edit-WDACConfig/#1-automatic-parameter_1","title":"1 Automatic parameter","text":"<ul> <li><code>-PolicyPaths &lt;String[]&gt;</code>: Browse for the xml file of the Base policy this Supplemental policy is going to expand. Supports tab completion by showing only <code>.xml</code> files.</li> </ul>"},{"location":"WDACConfig%20Module/Edit-WDACConfig/#6-optional-parameters","title":"6 optional parameters","text":"<ul> <li> <p><code>-Levels &lt;String&gt;</code>: Offers the same official Levels for scanning of the specified directory paths. If no level is specified the default, which is set to FilePublisher in this module, will be used.</p> </li> <li> <p><code>-Fallbacks &lt;String[]&gt;</code>: Offers the same official Fallbacks for scanning of the specified directory paths. If no fallbacks is specified the default, which is set to Hash in this module, will be used.</p> </li> <li> <p><code>-AllowFileNameFallbacks</code>: More info available on Microsoft Learn</p> </li> <li> <p><code>-SpecificFileNameLevel</code>: You can choose one of the following options: \"OriginalFileName\", \"InternalName\", \"FileDescription\", \"ProductName\", \"PackageFamilyName\", \"FilePath\". More info available on Microsoft Learn</p> </li> <li> <p><code>-NoUserPEs</code>: By default the module includes user PEs in the scans. When you use this switch parameter, they won't be included. More info available on Microsoft Learn</p> </li> <li> <p><code>-NoScript</code>: More info available on Microsoft Learn</p> </li> </ul> <p></p> <p></p> <p></p>"},{"location":"WDACConfig%20Module/Edit-WDACConfig/#edit-wdacconfig-mergesupplementalpolicies","title":"Edit-WDACConfig -MergeSupplementalPolicies","text":"<pre><code>Edit-WDACConfig [-MergeSupplementalPolicies] -SuppPolicyName &lt;String&gt; -PolicyPaths &lt;String[]&gt; -SuppPolicyPaths\n&lt;String[]&gt; [-KeepOldSupplementalPolicies]\n</code></pre> <p>Merge multiple deployed Supplemental policies into 1 and deploy it, remove the individual ones, all happening automatically. Very useful to keep Supplemental policies below 32 since that's the limit.</p>"},{"location":"WDACConfig%20Module/Edit-WDACConfig/#2-mandatory-parameters","title":"2 mandatory parameters","text":"<ul> <li> <p><code>-SuppPolicyName &lt;String&gt;</code>: Choose a descriptive name for the Supplemental policy that is going to be the merge of multiple policies.</p> </li> <li> <p><code>-SuppPolicyPaths &lt;String[]&gt;</code>: Path to the Supplemental policies xml files. Supports argument tab completion by showing only Supplemental policy types.</p> </li> </ul>"},{"location":"WDACConfig%20Module/Edit-WDACConfig/#1-automatic-parameter_2","title":"1 Automatic parameter","text":"<ul> <li><code>-PolicyPaths &lt;String[]&gt;</code>: Path to the Base policy xml file the Supplemental policies belong to. Supports argument tab completion by showing only Base policy types.</li> </ul>"},{"location":"WDACConfig%20Module/Edit-WDACConfig/#1-optional-parameter","title":"1 optional parameter","text":"<ul> <li><code>-KeepOldSupplementalPolicies</code>: Indicates that the module will not remove the old Supplemental policy xml files after creating and deploying the new merged one.</li> </ul>"},{"location":"WDACConfig%20Module/Edit-WDACConfig/#edit-wdacconfig-updatebasepolicy","title":"Edit-WDACConfig -UpdateBasePolicy","text":"<pre><code>Edit-WDACConfig [-UpdateBasePolicy] -CurrentBasePolicyName &lt;String[]&gt; -NewBasePolicyType &lt;String&gt;\n[-RequireEVSigners]\n</code></pre> <p>It can rebootlessly change the type of the deployed base policy. It can update the recommended block rules and/or change policy rule options in the deployed base policy. The deployed Supplemental policies will stay intact and continue to work with the new Base policy.</p> <p>Hint: When switching from a more permissive base policy type to a more restrictive one, make sure your Supplemental policies will continue to work. E.g., if your current base policy type is Allow Microsoft and the one you are switching to is Default Windows, there might be files that will get blocked as a result of this switch if you created a Supplemental policy using Event viewer capturing. That's simply because they were allowed by the more permissive Allow Microsoft policy type so they didn't trigger audit logs thus weren't needed to be included in the Supplemental policy. You will need to update those Supplemental policies if that happens by deleting and recreating them, no immediate reboot required.</p>"},{"location":"WDACConfig%20Module/Edit-WDACConfig/#2-mandatory-parameters_1","title":"2 mandatory parameters","text":"<ul> <li> <p><code>-CurrentBasePolicyName &lt;String[]&gt;</code>: The name of the currently deployed base policy. It supports tab completion so just press tab to autofill it.</p> </li> <li> <p><code>-NewBasePolicyType &lt;String&gt;</code>: The type of the base policy to deploy. It supports tab completion so just press tab to autofill it. Supports all 3 Base policy types:</p> </li> <li> <p>AllowMicrosoft_Plus_Block_Rules</p> </li> <li> <p>Lightly_Managed_system_Policy</p> </li> <li> <p>DefaultWindows_WithBlockRules</p> <ul> <li> <p>Since the module uses PowerShell and not Windows PowerShell that is pre-installed in Windows, selecting this argument will automatically scan <code>C:\\Program Files\\PowerShell</code> directory and add PowerShell files to the base policy so that you will be able to continue using the module after redeploying the base policy. The scan uses FilePublisher level and Hash fallback.</p> </li> </ul> </li> </ul>"},{"location":"WDACConfig%20Module/Edit-WDACConfig/#1-optional-parameter_1","title":"1 optional parameter","text":"<ul> <li><code>-RequireEVSigners</code>: Indicates that the base policy will have Require EV Signers policy rule option.</li> </ul>"},{"location":"WDACConfig%20Module/Get-CommonWDACConfig/","title":"Get-CommonWDACConfig available parameters","text":""},{"location":"WDACConfig%20Module/Get-CommonWDACConfig/#notes","title":"Notes","text":"<ul> <li> <p>Mandatory parameters indicate you always need to provide values for them.</p> </li> <li> <p>Automatic parameters indicate that if you used Set-CommonWDACConfig cmdlet to set default values for them, the module will automatically use them. This saves time and prevents repetitive tasks. However, if no value exists in User Configurations for an Automatic parameter and you didn't explicitly provide a value for that parameter either, then you will see an error asking you to provide value for it. Explicitly providing a value for an Automatic parameter in the command line overrides its default value in User Configurations, meaning the module will ignore the value of the same parameter in the User Configurations file.</p> </li> <li> <p>Optional parameters indicate that they are not required and without using them the module will automatically run with the optimal settings.</p> </li> <li> <p>Many cmdlets and parameters of the module support the PowerShell's built-in <code>-Debug</code> switch and when that switch is used, they display extra details and debugging messages on the console, showing you what's happening under the hood.</p> </li> </ul> <p></p> <p></p> <pre><code>Get-CommonWDACConfig [-SignedPolicyPath] [-UnsignedPolicyPath] [-SignToolPath] [-CertCN] [-StrictKernelPolicyGUID]\n[-StrictKernelNoFlightRootsPolicyGUID] [-CertPath] [-Open]\n</code></pre> <p></p> <p>Use this cmdlet to query and display the values for common and frequently used parameters in the User Configurations Json file</p> <p>All of the applicable cmdlets of the module automatically check the User Configuration file for any available input, if you don't specify values for their parameters.</p> <p></p>"},{"location":"WDACConfig%20Module/Get-CommonWDACConfig/#8-optional-parameters","title":"8 optional parameters","text":"<ul> <li> <p><code>-SignedPolicyPath &lt;String&gt;</code>: Displays the path to the xml file of a Signed policy.</p> </li> <li> <p><code>-UnSignedPolicyPath &lt;String&gt;</code>: Displays the path to the xml file of an Unsigned policy.</p> </li> <li> <p><code>-SignToolPath</code>: Displays the path to the SignTool executable.</p> </li> <li> <p><code>-CertCN</code>: Displays the Common Name of an installed certificate.</p> </li> <li> <p><code>-CertPath</code>: Displays the path to a certificate <code>.cer</code> file.</p> </li> <li> <p><code>-Open</code>: Opens the User Config Json file in the default editor.</p> </li> <li> <p><code>-StrictKernelPolicyGUID</code>: Displays the GUID of the Strict Kernel mode policy (Mainly used Internally by the module)</p> </li> <li> <p><code>-StrictKernelNoFlightRootsPolicyGUID</code>: Displays the GUID of the Strict Kernel no Flights root mode policy (Mainly used Internally by the module)</p> </li> </ul> <p></p>"},{"location":"WDACConfig%20Module/Invoke-WDACSimulation/","title":"Invoke-WDACSimulation available parameters","text":""},{"location":"WDACConfig%20Module/Invoke-WDACSimulation/#notes","title":"Notes","text":"<ul> <li> <p>Mandatory parameters indicate you always need to provide values for them.</p> </li> <li> <p>Automatic parameters indicate that if you used Set-CommonWDACConfig cmdlet to set default values for them, the module will automatically use them. This saves time and prevents repetitive tasks. However, if no value exists in User Configurations for an Automatic parameter and you didn't explicitly provide a value for that parameter either, then you will see an error asking you to provide value for it. Explicitly providing a value for an Automatic parameter in the command line overrides its default value in User Configurations, meaning the module will ignore the value of the same parameter in the User Configurations file.</p> </li> <li> <p>Optional parameters indicate that they are not required and without using them the module will automatically run with the optimal settings.</p> </li> <li> <p>Many cmdlets and parameters of the module support the PowerShell's built-in <code>-Debug</code> switch and when that switch is used, they display extra details and debugging messages on the console, showing you what's happening under the hood.</p> </li> </ul> <p></p> <p></p> <pre><code>Invoke-WDACSimulation -FolderPath &lt;string&gt; -XmlFilePath &lt;string&gt;\n</code></pre> <p></p> <p>This cmdlet allows you to simulate a WDAC deployment. Select a folder and a policy xml file, it will show you whether the files in the folder would be allowed or blocked by your WDAC policy if it was actually deployed on a system and those files were run.</p> <p></p> <p>Current limitations of this cmdlet that will be fixed in future module version</p> <ol> <li> <p>Currently, this cmdlet is only suitable for xml policy files generated by Level: FilePublisher and Fallback: Hash, which are actually the safest and best options. If the policy was generated by other levels and fallbacks such as filepaths, the output of this cmdlet will not be accurate.</p> </li> <li> <p>In some edge cases, WDAC cmdlets such as <code>New-CiPolicy</code> create hash rules for a digitally valid signed file instead of creating Signer rules which are based on file's digital signature. In such cases, if there is a Signer in the Signers section of the xml policy that matches the details of this specific signed file (Intermediate certificate + TBS + Leaf cert's CN), <code>Invoke-WDACSimulation</code> cmdlet shows that the file is allowed by Signer instead of hash, which is not true.</p> </li> </ol> <p>This is the newest addition to the WDACConfig module.</p> <p></p>"},{"location":"WDACConfig%20Module/Invoke-WDACSimulation/#2-mandatory-parameters","title":"2 mandatory parameters","text":"<ul> <li> <p><code>-FolderPath &lt;string&gt;</code>: Path to a folder. Supports argument tab completion, select the parameter then press TAB to open the Folder picker GUI.</p> </li> <li> <p><code>-XmlFilePath &lt;string&gt;</code>: Path to a xml file. Supports argument tab completion, select the parameter then press TAB to open the file picker that shows only xml files.</p> </li> </ul> <p></p> <p></p> <p></p>"},{"location":"WDACConfig%20Module/Invoke-WDACSimulation/#external-licenses","title":"External Licenses","text":"<p>A small part of this cmdlet's code includes Vadims Pod\u0101ns's code for nested certificate calculation of double signed files. 1. https://www.sysadmins.lv/disclaimer.aspx 2. https://www.sysadmins.lv/blog-en/reading-multiple-signatures-from-signed-file-with-powershell.aspx</p> <p></p>"},{"location":"WDACConfig%20Module/New-DenyWDACConfig/","title":"New-DenyWDACConfig available parameters","text":""},{"location":"WDACConfig%20Module/New-DenyWDACConfig/#notes","title":"Notes","text":"<ul> <li> <p>Mandatory parameters indicate you always need to provide values for them.</p> </li> <li> <p>Automatic parameters indicate that if you used Set-CommonWDACConfig cmdlet to set default values for them, the module will automatically use them. This saves time and prevents repetitive tasks. However, if no value exists in User Configurations for an Automatic parameter and you didn't explicitly provide a value for that parameter either, then you will see an error asking you to provide value for it. Explicitly providing a value for an Automatic parameter in the command line overrides its default value in User Configurations, meaning the module will ignore the value of the same parameter in the User Configurations file.</p> </li> <li> <p>Optional parameters indicate that they are not required and without using them the module will automatically run with the optimal settings.</p> </li> <li> <p>Many cmdlets and parameters of the module support the PowerShell's built-in <code>-Debug</code> switch and when that switch is used, they display extra details and debugging messages on the console, showing you what's happening under the hood.</p> </li> </ul> <p></p>"},{"location":"WDACConfig%20Module/New-DenyWDACConfig/#new-denywdacconfig-normal","title":"New-DenyWDACConfig -Normal","text":"<pre><code>New-DenyWDACConfig [-Normal] -PolicyName &lt;String&gt; -ScanLocations &lt;String[]&gt; [-Level &lt;String&gt;]\n[-Fallbacks &lt;String[]&gt;] [-AllowFileNameFallbacks] [-SpecificFileNameLevel &lt;String&gt;] [-NoUserPEs]\n[-NoScript] [-Deployit]\n</code></pre> <p>Creates a Deny base policy by scanning a directory. The base policy will have 2 allow all rules, meaning it can be deployed as a standalone base policy, side-by-side any other Base/Supplemental policies.</p>"},{"location":"WDACConfig%20Module/New-DenyWDACConfig/#2-mandatory-parameters","title":"2 mandatory parameters","text":"<ul> <li> <p><code>-PolicyName &lt;String&gt;</code>: Add a descriptive name for the Deny base policy. Accepts only alphanumeric and space characters.</p> </li> <li> <p><code>ScanLocations &lt;String[]&gt;</code>: Accepts one or more comma separated folder paths. Supports argument completion, when you press tab, folder picker GUI will open allowing you to easily select a folder, you can then add a comma <code>,</code> and press tab again to select another folder path or paste a folder path manually, works both ways.</p> </li> </ul>"},{"location":"WDACConfig%20Module/New-DenyWDACConfig/#7-optional-parameters","title":"7 optional parameters","text":"<ul> <li> <p><code>-Deployit</code>: Indicates that the module will automatically deploy the Deny base policy after creation.</p> </li> <li> <p><code>-Levels &lt;String&gt;</code>: Offers the same official Levels for scanning of the specified directory path. If no level is specified the default, which is set to FilePublisher in this module, will be used.</p> </li> <li> <p><code>-Fallbacks &lt;String[]&gt;</code>: Offers the same official Fallbacks for scanning of the specified directory path. If no fallbacks is specified the default, which is set to Hash in this module, will be used.</p> </li> <li> <p><code>-AllowFileNameFallbacks</code>: More info available on Microsoft Learn</p> </li> <li> <p><code>-SpecificFileNameLevel</code>: You can choose one of the following options: \"OriginalFileName\", \"InternalName\", \"FileDescription\", \"ProductName\", \"PackageFamilyName\", \"FilePath\". More info available on Microsoft Learn</p> </li> <li> <p><code>-NoUserPEs</code>: By default the module includes user PEs in the scan, but when you use this switch parameter, they won't be included. More info available on Microsoft Learn</p> </li> <li> <p><code>-NoScript</code>: More info available on Microsoft Learn</p> </li> </ul> <p></p> <p></p> <p></p>"},{"location":"WDACConfig%20Module/New-DenyWDACConfig/#new-denywdacconfig-drivers","title":"New-DenyWDACConfig -Drivers","text":"<pre><code>New-DenyWDACConfig [-Drivers] -PolicyName &lt;String&gt; -ScanLocations &lt;String[]&gt; [-Level &lt;String&gt;]\n[-Fallbacks &lt;String[]&gt;] [-Deployit]\n</code></pre> <p>Creates a Deny base policy by scanning a directory, this parameter uses DriverFile objects so it's best suitable for driver files. The base policy will have 2 allow all rules, meaning it can be deployed as a standalone base policy, side-by-side any other Base/Supplemental policies.</p>"},{"location":"WDACConfig%20Module/New-DenyWDACConfig/#2-mandatory-parameters_1","title":"2 mandatory parameters","text":"<ul> <li> <p><code>-PolicyName &lt;String&gt;</code>: Add a descriptive name for the Deny base policy. Accepts only alphanumeric and space characters.</p> </li> <li> <p><code>ScanLocations &lt;String[]&gt;</code>: Accepts one or more comma separated folder paths. Supports argument completion, when you press tab, folder picker GUI will open allowing you to easily select a folder, you can then add a comma <code>,</code> and press tab again to select another folder path or paste a folder path manually, works both ways.</p> </li> </ul>"},{"location":"WDACConfig%20Module/New-DenyWDACConfig/#3-optional-parameters","title":"3 optional parameters","text":"<ul> <li> <p><code>-Deployit</code>: Indicates that the module will automatically deploy the Deny base policy after creation.</p> </li> <li> <p><code>-Levels &lt;String&gt;</code>: Offers the same official Levels for scanning of the specified directory path. If no level is specified the default, which is set to FilePublisher in this module, will be used.</p> </li> <li> <p><code>-Fallbacks &lt;String[]&gt;</code>: Offers the same official Fallbacks for scanning of the specified directory path. If no fallbacks is specified the default, which is set to Hash in this module, will be used.</p> </li> </ul> <p></p> <p></p> <p></p>"},{"location":"WDACConfig%20Module/New-DenyWDACConfig/#new-denywdacconfig-installedappxpackages","title":"New-DenyWDACConfig -InstalledAppXPackages","text":"<pre><code>New-DenyWDACConfig [-InstalledAppXPackages] -PackageName &lt;String&gt; -PolicyName &lt;String&gt; [-Deployit]\n</code></pre> <p>Creates a Deny base policy for one or more installed Windows Apps (Appx) based on their PFN (Package Family Name). The base policy will have 2 allow all rules, meaning it can be deployed as a standalone base policy, side-by-side any other Base/Supplemental policies.</p>"},{"location":"WDACConfig%20Module/New-DenyWDACConfig/#2-mandatory-parameters_2","title":"2 mandatory parameters","text":"<ul> <li> <p><code>-PackageName &lt;String&gt;</code>: Enter the package name of an installed app. Supports wildcard <code>*</code> character. e.g, <code>*Edge*</code> or <code>\"*Microsoft*\"</code>.</p> </li> <li> <p><code>-PolicyName &lt;String&gt;</code>: Add a descriptive name for the Deny base policy. Accepts only alphanumeric and space characters.</p> </li> </ul>"},{"location":"WDACConfig%20Module/New-DenyWDACConfig/#1-optional-parameters","title":"1 optional parameters","text":"<ul> <li><code>-Deployit</code>: Indicates that the module will automatically deploy the Deny base policy after creation.</li> </ul>"},{"location":"WDACConfig%20Module/New-KernelModeWDACConfig/","title":"New-KernelModeWDACConfig available parameters","text":""},{"location":"WDACConfig%20Module/New-KernelModeWDACConfig/#notes","title":"Notes","text":"<ul> <li> <p>Mandatory parameters indicate you always need to provide values for them.</p> </li> <li> <p>Automatic parameters indicate that if you used Set-CommonWDACConfig cmdlet to set default values for them, the module will automatically use them. This saves time and prevents repetitive tasks. However, if no value exists in User Configurations for an Automatic parameter and you didn't explicitly provide a value for that parameter either, then you will see an error asking you to provide value for it. Explicitly providing a value for an Automatic parameter in the command line overrides its default value in User Configurations, meaning the module will ignore the value of the same parameter in the User Configurations file.</p> </li> <li> <p>Optional parameters indicate that they are not required and without using them the module will automatically run with the optimal settings.</p> </li> <li> <p>Many cmdlets and parameters of the module support the PowerShell's built-in <code>-Debug</code> switch and when that switch is used, they display extra details and debugging messages on the console, showing you what's happening under the hood.</p> </li> </ul> <p></p>"},{"location":"WDACConfig%20Module/New-KernelModeWDACConfig/#during-the-prepmodes-the-following-event-log-categories-are-cleared","title":"During the PrepModes, the following event log categories are cleared","text":"<ul> <li> <p>Applications and Services logs \u2013 Microsoft \u2013 Windows \u2013 CodeIntegrity \u2013 Operational includes events about Application Control policy activation and the control of executables, dlls, and drivers.</p> </li> <li> <p>Applications and Services logs \u2013 Microsoft \u2013 Windows \u2013 AppLocker \u2013 MSI and Script includes events about the control of MSI installers, scripts, and COM objects.</p> </li> </ul> <p>This behavior is required so that the audit phase will have the correct logs to scan and add to the base policy for allow listing. This behavior can be changed/improved in a future module update.</p> <p>Before the audit mode phase, make sure you trust all the files and programs installed on your system, otherwise you risk allow listing vulnerable or malicious drivers in your policy.</p> <p></p>"},{"location":"WDACConfig%20Module/New-KernelModeWDACConfig/#new-kernelmodewdacconfig-default","title":"New-KernelModeWDACConfig -Default","text":"<pre><code>New-KernelModeWDACConfig [-Default] [-PrepMode] [-AuditAndEnforce] [-EVSigners] [-Deployit]\n</code></pre>"},{"location":"WDACConfig%20Module/New-KernelModeWDACConfig/#how-to-use","title":"How to use","text":"<p>This cmdlet creates a Kernel-mode WDAC policy based on the Default Windows example policy. You can read more about that process in here.</p> <p>The default parameter indicates that the Strict Kernel-mode WDAC policy will be deployed with flight root certificates, allowing you to use insider builds of the OS.</p> <p>First you need to use the PrepMode parameter to deploy the base policy in Audit mode, then reboot your system, after reboot event logs are generated for Kernel-mode drivers that are running but would otherwise get blocked if the policy was not deployed in Audit mode.</p> <p></p> <p>Now you need to use the AuditAndEnforce parameter to create the final base policy. This parameter will scan the event logs, create a supplemental policy for the drivers detected in event logs, merge the supplemental policy with the Strict Kernel-mode base policy and deploy it as a single base policy. No reboot required after deploying the final enforced mode policy, reboot is only required 1 time, after deploying the Audit mode policy.</p> <p>Hardware drivers are scanned based on their certificates so they won't require a policy update when they are updated as long as they are still signed with the same certificate.</p> <p>The deployed base policy can have supplemental policies too so if in the future you need to allow more Kernel-mode drivers to run on your system, you can use the following command to automatically create and deploy a Supplemental policy.</p> <pre><code>Edit-WDACConfig -AllowNewAppsAuditEvents -SuppPolicyName \"Kernel mode drivers for software X\" -PolicyPaths &lt;Path to Strict Kernel-mode policy xml file&gt; -Fallbacks None -NoUserPEs -NoScript\n</code></pre> <p>More info about the command above</p> <p></p>"},{"location":"WDACConfig%20Module/New-KernelModeWDACConfig/#4-optional-parameter","title":"4 optional parameter","text":"<ul> <li> <p><code>-PrepMode</code>: Deploys the Strict Kernel-mode WDAC policy in Audit mode, preparing the system for an Audit.</p> </li> <li> <p><code>-AuditAndEnforce</code>: Audits the system using event logs for any blocked drivers, generates and deploys the final Strict Kernel-mode WDAC policy on the system.</p> </li> <li> <p><code>-EVSigners</code>: Uses EVSigners policy rule option. If you want to use this parameter, make sure you use it for both PrepMode and AuditAndEnforce parameters. Read more about EV Signers</p> </li> <li> <p><code>-Deployit</code>: Indicates that the policy will be deployed. If you want to deploy the final strict kernel-mode base policy Signed, do not use this parameter with <code>-AuditAndEnforce</code>. Instead just create the policy and then use Deploy-SignedWDACConfig cmdlet to deploy it.</p> </li> </ul> <p></p> <p></p> <p></p>"},{"location":"WDACConfig%20Module/New-KernelModeWDACConfig/#new-kernelmodewdacconfig-noflightroots","title":"New-KernelModeWDACConfig -NoFlightRoots","text":"<pre><code>New-KernelModeWDACConfig [-NoFlightRoots] [-PrepMode] [-AuditAndEnforce] [-EVSigners] [-Deployit]\n</code></pre>"},{"location":"WDACConfig%20Module/New-KernelModeWDACConfig/#how-to-use_1","title":"How to use","text":"<p>This cmdlet creates a Kernel-mode WDAC policy based on the Default Windows example policy. You can read more about that process in here.</p> <p>The NoFlightRoots parameter indicates that the Strict Kernel-mode WDAC policy will not be deployed with flight root certificates, disallowing you to use insider builds of the OS.</p> <p>First you need to use the PrepMode parameter to deploy the base policy in Audit mode, then reboot your system, after reboot event logs are generated for Kernel-mode drivers that are running but would otherwise get blocked if the policy was not deployed in Audit mode.</p> <p>Now you need to use the AuditAndEnforce parameter to create the final base policy. This parameter will scan the event logs, create a supplemental policy for the drivers detected in event logs, merge the supplemental policy with the Strict Kernel-mode base policy and deploy it as a single base policy. No reboot required after deploying the final enforced mode policy, reboot is only required 1 time, after deploying the Audit mode policy.</p> <p>Hardware drivers are scanned based on their certificates so they won't require a policy update when they are updated as long as they are still signed with the same certificate.</p> <p>The deployed base policy can have supplemental policies too so if in the future you need to allow more Kernel-mode drivers to run on your system, you can use the following command to automatically create and deploy a Supplemental policy.</p> <pre><code>Edit-WDACConfig -AllowNewAppsAuditEvents -SuppPolicyName \"Kernel mode drivers for software X\" -PolicyPaths &lt;Path to Strict Kernel-mode policy xml file&gt; -Fallbacks None -NoUserPEs -NoScript\n</code></pre> <p>More info about the command above</p> <p></p>"},{"location":"WDACConfig%20Module/New-KernelModeWDACConfig/#4-optional-parameter_1","title":"4 optional parameter","text":"<ul> <li> <p><code>-PrepMode</code>: Deploys the Strict Kernel-mode WDAC policy in Audit mode, preparing the system for an Audit.</p> </li> <li> <p><code>-AuditAndEnforce</code>: Audits the system using event logs for any blocked drivers, generates and deploys the final Strict Kernel-mode WDAC policy on the system.</p> </li> <li> <p><code>-EVSigners</code>: Uses EVSigners policy rule option. If you want to use this parameter, make sure you use it for both PrepMode and AuditAndEnforce parameters. Read more about EV Signers</p> </li> <li> <p><code>-Deployit</code>: Indicates that the policy will be deployed. If you want to deploy the final strict kernel-mode no flight roots base policy Signed, do not use this parameter with <code>-AuditAndEnforce</code>. Instead just create the policy and then use Deploy-SignedWDACConfig cmdlet to deploy it.</p> </li> </ul>"},{"location":"WDACConfig%20Module/New-SupplementalWDACConfig/","title":"New-SupplementalWDACConfig available parameters","text":""},{"location":"WDACConfig%20Module/New-SupplementalWDACConfig/#notes","title":"Notes","text":"<ul> <li> <p>Mandatory parameters indicate you always need to provide values for them.</p> </li> <li> <p>Automatic parameters indicate that if you used Set-CommonWDACConfig cmdlet to set default values for them, the module will automatically use them. This saves time and prevents repetitive tasks. However, if no value exists in User Configurations for an Automatic parameter and you didn't explicitly provide a value for that parameter either, then you will see an error asking you to provide value for it. Explicitly providing a value for an Automatic parameter in the command line overrides its default value in User Configurations, meaning the module will ignore the value of the same parameter in the User Configurations file.</p> </li> <li> <p>Optional parameters indicate that they are not required and without using them the module will automatically run with the optimal settings.</p> </li> <li> <p>Many cmdlets and parameters of the module support the PowerShell's built-in <code>-Debug</code> switch and when that switch is used, they display extra details and debugging messages on the console, showing you what's happening under the hood.</p> </li> </ul> <p></p>"},{"location":"WDACConfig%20Module/New-SupplementalWDACConfig/#new-supplementalwdacconfig-normal","title":"New-SupplementalWDACConfig -Normal","text":"<pre><code>New-SupplementalWDACConfig [-Normal] -ScanLocation &lt;String&gt; -SuppPolicyName &lt;String&gt; -PolicyPath &lt;String&gt;\n[-Deployit] [-AllowFileNameFallbacks] [-SpecificFileNameLevel &lt;String&gt;] [-NoUserPEs] [-NoScript] [-Level &lt;String&gt;]\n[-Fallbacks &lt;String[]&gt;]\n</code></pre> <p>Creates a normal Supplemental policy for a base policy.</p>"},{"location":"WDACConfig%20Module/New-SupplementalWDACConfig/#2-mandatory-parameters","title":"2 mandatory parameters","text":"<ul> <li> <p><code>-ScanLocation &lt;String&gt;</code>: The directory or drive that you want to scan for files that will be allowed to run by the Supplemental policy.</p> </li> <li> <p><code>-SuppPolicyName &lt;String&gt;</code>: Add a descriptive name for the Supplemental policy. Accepts only alphanumeric and space characters.</p> </li> </ul>"},{"location":"WDACConfig%20Module/New-SupplementalWDACConfig/#1-automatic-parameter","title":"1 Automatic Parameter","text":"<ul> <li><code>-PolicyPath &lt;String&gt;</code>: Browse for the xml file of the Base policy this Supplemental policy is going to expand. Supports tab completion by showing only <code>.xml</code> files with Base Policy Type.</li> </ul>"},{"location":"WDACConfig%20Module/New-SupplementalWDACConfig/#7-optional-parameters","title":"7 optional parameters","text":"<ul> <li> <p><code>-Deployit</code>: Indicates that the module will automatically deploy the Supplemental policy after creation.</p> </li> <li> <p><code>-Levels &lt;String&gt;</code>: Offers the same official Levels for scanning of the specified directory path. If no level is specified the default, which is set to FilePublisher in this module, will be used.</p> </li> <li> <p><code>-Fallbacks &lt;String[]&gt;</code>: Offers the same official Fallbacks for scanning of the specified directory path. If no fallbacks is specified the default, which is set to Hash in this module, will be used.</p> </li> <li> <p><code>-AllowFileNameFallbacks</code>: More info available on Microsoft Learn</p> </li> <li> <p><code>-SpecificFileNameLevel</code>: You can choose one of the following options: \"OriginalFileName\", \"InternalName\", \"FileDescription\", \"ProductName\", \"PackageFamilyName\", \"FilePath\". More info available on Microsoft Learn</p> </li> <li> <p><code>-NoUserPEs</code>: By default the module includes user PEs in the scan, but when you use this switch parameter, they won't be included. More info available on Microsoft Learn</p> </li> <li> <p><code>-NoScript</code>: More info available on Microsoft Learn</p> </li> </ul>"},{"location":"WDACConfig%20Module/New-SupplementalWDACConfig/#the-outputs-of-the-parameter-are","title":"The outputs of the parameter are","text":"<ul> <li>SupplementalPolicy<code>&lt;Custom Name&gt;</code>.xml</li> <li>{GUID}.cip</li> </ul>"},{"location":"WDACConfig%20Module/New-SupplementalWDACConfig/#new-supplementalwdacconfig-filepathwildcards","title":"New-SupplementalWDACConfig -FilePathWildCards","text":"<pre><code>New-SupplementalWDACConfig [-FilePathWildCards] -WildCardPath &lt;String&gt; -SuppPolicyName &lt;String&gt; -PolicyPath\n&lt;String&gt; [-Deployit]\n</code></pre> <p>Creates a Supplemental policy that allows a file path that includes one or more wildcard <code>*</code> character in it.</p>"},{"location":"WDACConfig%20Module/New-SupplementalWDACConfig/#2-mandatory-parameters_1","title":"2 mandatory parameters","text":"<ul> <li> <p><code>-WildCardPath</code>: A file path that includes at least one wildcard <code>*</code> character and ends with a <code>\\</code>.</p> </li> <li> <p><code>-SuppPolicyName &lt;String&gt;</code>: Add a descriptive name for the Supplemental policy. Accepts only alphanumeric and space characters.</p> </li> </ul>"},{"location":"WDACConfig%20Module/New-SupplementalWDACConfig/#1-automatic-parameter_1","title":"1 Automatic parameter","text":"<ul> <li><code>-PolicyPath</code>: Browse for the xml file of the Base policy this Supplemental policy is going to expand. Supports tab completion by showing only <code>.xml</code> files with Base Policy Type.</li> </ul>"},{"location":"WDACConfig%20Module/New-SupplementalWDACConfig/#1-optional-parameter","title":"1 optional parameter","text":"<ul> <li><code>-Deployit</code>: Indicates that the module will automatically deploy the Supplemental policy after creation.</li> </ul>"},{"location":"WDACConfig%20Module/New-SupplementalWDACConfig/#the-outputs-of-the-parameter-are_1","title":"The outputs of the parameter are","text":"<ul> <li>SupplementalPolicy<code>&lt;Custom Name&gt;</code>.xml</li> <li>{GUID}.cip</li> </ul>"},{"location":"WDACConfig%20Module/New-SupplementalWDACConfig/#new-supplementalwdacconfig-installedappxpackages","title":"New-SupplementalWDACConfig -InstalledAppXPackages","text":"<pre><code>New-SupplementalWDACConfig [-InstalledAppXPackages] -PackageName &lt;String&gt; -SuppPolicyName &lt;String&gt; -PolicyPath\n&lt;String&gt; [-Deployit]\n</code></pre> <p>Creates a Supplemental policy based on the package name of an installed app.</p> <p>More information at Microsoft Learn</p>"},{"location":"WDACConfig%20Module/New-SupplementalWDACConfig/#2-mandatory-parameters_2","title":"2 mandatory parameters","text":"<ul> <li> <p><code>-PackageName</code>: Enter the package name of an installed app. Supports wildcard <code>*</code> character. e.g, <code>*Edge*</code> or <code>\"*Microsoft*\"</code>.</p> </li> <li> <p><code>-SuppPolicyName &lt;String&gt;</code>: Add a descriptive name for the Supplemental policy. Accepts only alphanumeric and space characters.</p> </li> </ul>"},{"location":"WDACConfig%20Module/New-SupplementalWDACConfig/#1-automatic-paremeter","title":"1 Automatic paremeter","text":"<ul> <li><code>-PolicyPath</code>: Browse for the xml file of the Base policy this Supplemental policy is going to expand. Supports tab completion by showing only <code>.xml</code> files with Base Policy Type.</li> </ul>"},{"location":"WDACConfig%20Module/New-SupplementalWDACConfig/#1-optional-parameter_1","title":"1 optional parameter","text":"<ul> <li><code>-Deployit</code>: Indicates that the module will automatically deploy the Supplemental policy after creation.</li> </ul>"},{"location":"WDACConfig%20Module/New-SupplementalWDACConfig/#the-outputs-of-the-parameter-are_2","title":"The outputs of the parameter are","text":"<ul> <li>SupplementalPolicy<code>&lt;Custom Name&gt;</code>.xml</li> <li>{GUID}.cip</li> </ul>"},{"location":"WDACConfig%20Module/New-WDACConfig/","title":"New-WDACConfig available parameters","text":""},{"location":"WDACConfig%20Module/New-WDACConfig/#notes","title":"Notes","text":"<ul> <li> <p>Mandatory parameters indicate you always need to provide values for them.</p> </li> <li> <p>Automatic parameters indicate that if you used Set-CommonWDACConfig cmdlet to set default values for them, the module will automatically use them. This saves time and prevents repetitive tasks. However, if no value exists in User Configurations for an Automatic parameter and you didn't explicitly provide a value for that parameter either, then you will see an error asking you to provide value for it. Explicitly providing a value for an Automatic parameter in the command line overrides its default value in User Configurations, meaning the module will ignore the value of the same parameter in the User Configurations file.</p> </li> <li> <p>Optional parameters indicate that they are not required and without using them the module will automatically run with the optimal settings.</p> </li> <li> <p>Many cmdlets and parameters of the module support the PowerShell's built-in <code>-Debug</code> switch and when that switch is used, they display extra details and debugging messages on the console, showing you what's happening under the hood.</p> </li> </ul> <p></p>"},{"location":"WDACConfig%20Module/New-WDACConfig/#new-wdacconfig-getblockrules","title":"New-WDACConfig -GetBlockRules","text":"<pre><code>New-WDACConfig [-GetBlockRules]\n</code></pre> <p>Creates a WDAC policy file called Microsoft recommended block rules.xml from the official source for Microsoft recommended block rules, with AllowAll rules and audit mode rule option removed. The policy sets HVCI to strict.</p> <p></p> <p></p> <p></p>"},{"location":"WDACConfig%20Module/New-WDACConfig/#new-wdacconfig-getdriverblockrules","title":"New-WDACConfig -GetDriverBlockRules","text":"<pre><code>New-WDACConfig [-GetDriverBlockRules]\n</code></pre> <p>Creates a WDAC policy file called Microsoft recommended driver block rules.xml from the official source for Microsoft recommended driver block rules, with AllowAll rules and audit mode rule option removed. The policy sets HVCI to strict. Extra information regarding the version and last updated date of the GitHub document containing block rules will also be displayed.</p> <p></p> <p></p> <p></p>"},{"location":"WDACConfig%20Module/New-WDACConfig/#new-wdacconfig-makeallowmsftwithblockrules","title":"New-WDACConfig -MakeAllowMSFTWithBlockRules","text":"<pre><code>New-WDACConfig [-MakeAllowMSFTWithBlockRules] [-Deployit] [-TestMode] [-RequireEVSigners]\n</code></pre> <p>Calls the -GetBlockRules parameter to get the Microsoft recommended block rules, and merges them with AllowMicrosoft default policy. The Policy uses strict HVCI and has the following rule options:</p> <p></p> Rule number Rule option 0 Enabled:UMCI 2 Required:WHQL 5 Enabled:Inherit Default Policy 6 Enabled:Unsigned System Integrity Policy 11 Disabled:Script Enforcement 12 Required:Enforce Store Applications 16 Enabled:Update Policy No Reboot 17 Enabled:Allow Supplemental Policies 19 Enabled:Dynamic Code Security 20 Enabled:Revoked Expired As Unsigned <p></p>"},{"location":"WDACConfig%20Module/New-WDACConfig/#the-outputs-of-the-parameter-are","title":"The outputs of the parameter are","text":"<ul> <li>AllowMicrosoftPlusBlockRules.xml policy file</li> <li>{GUID}.cip for the policy above</li> </ul>"},{"location":"WDACConfig%20Module/New-WDACConfig/#3-optional-parameters","title":"3 optional parameters","text":"<ul> <li> <p><code>-Deployit</code>: Indicates that the module will automatically deploy the AllowMicrosoftPlusBlockRules policy after creation.</p> </li> <li> <p><code>-TestMode</code>: Indicates that the created/deployed policy will have Enabled:Boot Audit on Failure and Enabled:Advanced Boot Options Menu policy rule options.</p> </li> <li> <p><code>-RequireEVSigners</code>: Indicates that the created/deployed policy will have Require EV Signers policy rule option.</p> </li> <li> <p>In addition to being WHQL signed, this rule requires that drivers must have been submitted by a partner that has an Extended Verification (EV) certificate. All Windows 10 and later, or Windows 11 drivers will meet this requirement.</p> </li> </ul> <p></p> <p></p> <p></p>"},{"location":"WDACConfig%20Module/New-WDACConfig/#new-wdacconfig-deploylatestdriverblockrules","title":"New-WDACConfig -DeployLatestDriverBlockRules","text":"<pre><code>New-WDACConfig [-DeployLatestDriverBlockRules]\n</code></pre> <p>With the help of PowerShell, uses the official method to deploy the latest version of Microsoft recommended driver block rules.</p> <p></p> <p></p> <p></p>"},{"location":"WDACConfig%20Module/New-WDACConfig/#new-wdacconfig-deploylatestblockrules","title":"New-WDACConfig -DeployLatestBlockRules","text":"<pre><code>New-WDACConfig [-DeployLatestBlockRules]\n</code></pre> <p>Deploys the latest Microsoft recommended block rules (For User Mode binaries). It has the 2 default AllowAll rules so it can be deployed as a standalone base policy. Uses Strict HVCI.</p> <p></p> <p></p> <p></p>"},{"location":"WDACConfig%20Module/New-WDACConfig/#new-wdacconfig-setautoupdatedriverblockrules","title":"New-WDACConfig -SetAutoUpdateDriverBlockRules","text":"<pre><code>New-WDACConfig [-SetAutoUpdateDriverBlockRules]\n</code></pre> <p>Creates a scheduled task that runs every 7 days to automatically perform the official method for updating Microsoft recommended driver block rules.</p> <p></p> <p></p> <p></p>"},{"location":"WDACConfig%20Module/New-WDACConfig/#new-wdacconfig-prepmsftonlyaudit","title":"New-WDACConfig -PrepMSFTOnlyAudit","text":"<pre><code>New-WDACConfig [-PrepMSFTOnlyAudit] [-LogSize &lt;Int64&gt;]\n</code></pre> <p>Prepares the system for generating Audit event logs for a fully managed device, by deploying the default AllowMicrosoft policy in Audit mode. No reboot required.</p> <p>After deployment, audit event logs will start to be created for any file that is run but wouldn't be allowed to if the AllowMicrosoft policy was deployed in enforced mode.</p> <p>It's recommended to use the optional parameter below to increase the log size of Code Integrity events category so that new events won't overwrite the older ones and everything will be captured.</p>"},{"location":"WDACConfig%20Module/New-WDACConfig/#1-optional-parameter","title":"1 optional parameter","text":"<ul> <li><code>-LogSize &lt;Int64&gt;</code> - Specifies the log size for Microsoft-Windows-CodeIntegrity/Operational events. The values must be in the form of <code>&lt;Digit + Data measurement unit&gt;</code>. e.g., 2MB, 10MB, 1GB, 1TB. The minimum accepted value is 1MB which is the default.</li> </ul>"},{"location":"WDACConfig%20Module/New-WDACConfig/#new-wdacconfig-prepdefaultwindowsaudit","title":"New-WDACConfig -PrepDefaultWindowsAudit","text":"<pre><code>New-WDACConfig [-PrepDefaultWindowsAudit] [-LogSize &lt;Int64&gt;]\n</code></pre> <p>Prepares the system for Default Windows auditing. It will trigger audit logs to be created for any file that is run but is not part of the Windows; Unlike -PrepMSFTOnlyAudit parameter that triggers audit logs for any file that is not signed by Microsoft's trusted root certificate.</p> <p>This parameter also scans the WDACConfig module files and PowerShell core files, adds them to the Prep audit mode base policy that it deploys, so that the final Supplemental policy generated from Event viewer audit logs won't include those files.</p> <p>It's recommended to use the optional parameter below to increase the log size of Code Integrity events category so that new events won't overwrite the older ones and everything will be captured.</p>"},{"location":"WDACConfig%20Module/New-WDACConfig/#1-optional-parameter_1","title":"1 optional parameter","text":"<ul> <li><code>-LogSize &lt;Int64&gt;</code> - Specifies the log size for Microsoft-Windows-CodeIntegrity/Operational events. The values must be in the form of <code>&lt;Digit + Data measurement unit&gt;</code>. e.g., 2MB, 10MB, 1GB, 1TB. The minimum accepted value is 1MB which is the default.</li> </ul>"},{"location":"WDACConfig%20Module/New-WDACConfig/#new-wdacconfig-makepolicyfromauditlogs","title":"New-WDACConfig -MakePolicyFromAuditLogs","text":"<pre><code>New-WDACConfig [-MakePolicyFromAuditLogs] -BasePolicyType &lt;String&gt; [-Deployit] [-TestMode] [-RequireEVSigners]\n[-AllowFileNameFallbacks] [-SpecificFileNameLevel &lt;String&gt;] [-NoDeletedFiles] [-NoUserPEs] [-NoScript] [-Level\n&lt;String&gt;] [-Fallbacks &lt;String[]&gt;] [-LogSize &lt;Int64&gt;]\n</code></pre> <p>Creates a WDAC policy using the Audit event logs generated for a fully managed device.</p>"},{"location":"WDACConfig%20Module/New-WDACConfig/#1-mandatory-parameter","title":"1 mandatory parameter","text":"<ul> <li><code>-BasePolicyType &lt;String&gt;</code>: You need to select between Allow Microsoft Base and Default Windows Base, based on which prep audit mode base policy deployed on the system.</li> </ul>"},{"location":"WDACConfig%20Module/New-WDACConfig/#12-optional-parameters","title":"12 optional parameters","text":"<ul> <li> <p><code>-Deployit</code>: Indicates that the module will automatically remove the WDAC policy deployed using either -PrepMSFTOnlyAudit or -PrepDefaultWindowsAudit parameters, then deploys the supplemental policy created from Audit event logs along with the selected base policy type, both in enforced mode.</p> </li> <li> <p><code>-TestMode</code>: Indicates that the created/deployed policy will have Enabled:Boot Audit on Failure and Enabled:Advanced Boot Options Menu policy rule options.</p> </li> <li> <p><code>-RequireEVSigners</code>: Indicates that the created/deployed policy will have Require EV Signers policy rule option.</p> </li> <li> <p>In addition to being WHQL signed, this rule requires that drivers must have been submitted by a partner that has an Extended Verification (EV) certificate. All Windows 10 and later, or Windows 11 drivers will meet this requirement.</p> </li> <li> <p><code>-Debug</code>: Indicates that the module will output 3 additional files for debugging purposes and also write debug messages on the console:</p> </li> <li>FileRulesAndFileRefs.txt - Contains the File Rules and Rule refs for the Hash of the files that no longer exist on the disk.</li> <li>DeletedFilesHashes.xml - Policy file that contains File Rules and Rule refs for the files that no longer exist on the disk.</li> <li> <p>AuditLogsPolicy_NoDeletedFiles.xml - The policy file generated from Audit Event logs based on the specified Level and Fallback parameters.</p> </li> <li> <p><code>-LogSize &lt;Int64&gt;</code> - Specifies the log size for Microsoft-Windows-CodeIntegrity/Operational events. The values must be in the form of <code>&lt;Digit + Data measurement unit&gt;</code>. e.g., 2MB, 10MB, 1GB, 1TB. The minimum accepted value is 1MB which is the default.</p> </li> <li> <p><code>-Levels &lt;String&gt;</code>: Offers the same official Levels for scanning of event logs. If no level is specified the default, which is set to FilePublisher in this module, will be used.</p> </li> <li> <p><code>-Fallbacks &lt;String[]&gt;</code>: Offers the same official Fallbacks for scanning of event logs. If no fallbacks is specified the default, which is set to Hash in this module, will be used.</p> </li> <li> <p><code>-AllowFileNameFallbacks</code>: More info available on Microsoft Learn</p> </li> <li> <p><code>-SpecificFileNameLevel</code>: You can choose one of the following options: \"OriginalFileName\", \"InternalName\", \"FileDescription\", \"ProductName\", \"PackageFamilyName\", \"FilePath\". More info available on Microsoft Learn</p> </li> <li> <p><code>-NoDeletedFiles</code>: Indicates that files that were run during program installations but then were deleted and are no longer on the disk, won't be added to the supplemental policy. This can mean the programs you installed will be allowed to run but installation/reinstallation might not be allowed once the policies are deployed.</p> </li> <li> <p><code>-NoUserPEs</code>: By default the module includes user PEs in the scan. When you use this switch parameter, they won't be included. More info available on Microsoft Learn</p> </li> <li> <p><code>-NoScript</code>: More info available on Microsoft Learn</p> </li> </ul> <p></p>"},{"location":"WDACConfig%20Module/New-WDACConfig/#the-outputs-of-the-parameter-are_1","title":"The outputs of the parameter are","text":"<p>All of the outputs are saved in a folder named \"WDAC\" inside the current working directory.</p> <ul> <li> <p>AllowMicrosoftPlusBlockRules.xml: base policy created using -MakeAllowMSFTWithBlockRules parameter</p> </li> <li> <p>SupplementalPolicy.xml: The supplemental policy created using the script.</p> </li> <li> <p>{GUID}.cip: Binary file for AllowMicrosoft Policy, ready for deployment.</p> </li> <li> <p>{GUID}.cip: Binary file for SupplementalPolicy policy, ready for deployment.</p> </li> </ul> <p></p> <p></p> <p></p>"},{"location":"WDACConfig%20Module/New-WDACConfig/#new-wdacconfig-makelightpolicy","title":"New-WDACConfig -MakeLightPolicy","text":"<pre><code>New-WDACConfig [-MakeLightPolicy] [-Deployit] [-TestMode] [-RequireEVSigners]\n</code></pre> <p>Creates a WDAC policy for a Lightly managed system. The Policy uses has the same specifications as -MakeAllowMSFTWithBlockRules, with the following additional rule options:</p> <p></p> Rule number Rule option 14 Enabled:Intelligent Security Graph Authorization 15 Enabled:Invalidate EAs on Reboot <p></p>"},{"location":"WDACConfig%20Module/New-WDACConfig/#3-optional-parameters_1","title":"3 optional parameters","text":"<ul> <li> <p><code>-Deployit</code>: Indicates that the module will automatically deploy the SignedAndReputable.xml policy file after creation.</p> </li> <li> <p><code>-TestMode</code>: Indicates that the created/deployed policy will have Enabled:Boot Audit on Failure and Enabled:Advanced Boot Options Menu policy rule options.</p> </li> <li> <p><code>-RequireEVSigners</code>: Indicates that the created/deployed policy will have Require EV Signers policy rule option.</p> </li> <li> <p>In addition to being WHQL signed, this rule requires that drivers must have been submitted by a partner that has an Extended Verification (EV) certificate. All Windows 10 and later, or Windows 11 drivers will meet this requirement.</p> </li> </ul>"},{"location":"WDACConfig%20Module/New-WDACConfig/#the-outputs-of-the-parameter-are_2","title":"The outputs of the parameter are","text":"<ul> <li>SignedAndReputable.xml</li> <li>{GUID}.cip</li> </ul>"},{"location":"WDACConfig%20Module/New-WDACConfig/#new-wdacconfig-makedefaultwindowswithblockrules","title":"New-WDACConfig -MakeDefaultWindowsWithBlockRules","text":"<pre><code>New-WDACConfig [-MakeDefaultWindowsWithBlockRules] [-Deployit] [-TestMode] [-RequireEVSigners]\n</code></pre> <p>Calls the -GetBlockRules parameter to get the Microsoft recommended block rules, and merges them with DefaultWindows_Enforced policy. The Policy uses strict HVCI and uses the same policy rule options as -MakeAllowMSFTWithBlockRules parameter.</p> <p></p> <p>Since the module uses PowerShell and not Windows PowerShell that is pre-installed in Windows, this parameter will automatically scan <code>C:\\Program Files\\PowerShell</code> directory and add PowerShell files to the DefaultWindowsPlusBlockRules.xml policy file so that you will be able to continue using the module after deploying the policy. The scan uses FilePublisher level and Hash fallback.</p>"},{"location":"WDACConfig%20Module/New-WDACConfig/#the-outputs-of-the-parameter-are_3","title":"The outputs of the parameter are","text":"<ul> <li>DefaultWindowsPlusBlockRules.xml policy file</li> <li>{GUID}.cip for the policy above</li> </ul>"},{"location":"WDACConfig%20Module/New-WDACConfig/#3-optional-parameters_2","title":"3 optional parameters","text":"<ul> <li> <p><code>-Deployit</code>: Indicates that the module will automatically deploy the DefaultWindowsPlusBlockRules policy after creation.</p> </li> <li> <p><code>-TestMode</code>: Indicates that the created/deployed policy will have Enabled:Boot Audit on Failure and Enabled:Advanced Boot Options Menu policy rule options.</p> </li> <li> <p><code>-RequireEVSigners</code>: Indicates that the created/deployed policy will have Require EV Signers policy rule option.</p> </li> <li> <p>In addition to being WHQL signed, this rule requires that drivers must have been submitted by a partner that has an Extended Verification (EV) certificate. All Windows 10 and later, or Windows 11 drivers will meet this requirement.</p> </li> </ul> <p></p>"},{"location":"WDACConfig%20Module/Remove-WDACConfig/","title":"Remove-WDACConfig available parameters","text":""},{"location":"WDACConfig%20Module/Remove-WDACConfig/#notes","title":"Notes","text":"<ul> <li> <p>Mandatory parameters indicate you always need to provide values for them.</p> </li> <li> <p>Automatic parameters indicate that if you used Set-CommonWDACConfig cmdlet to set default values for them, the module will automatically use them. This saves time and prevents repetitive tasks. However, if no value exists in User Configurations for an Automatic parameter and you didn't explicitly provide a value for that parameter either, then you will see an error asking you to provide value for it. Explicitly providing a value for an Automatic parameter in the command line overrides its default value in User Configurations, meaning the module will ignore the value of the same parameter in the User Configurations file.</p> </li> <li> <p>Optional parameters indicate that they are not required and without using them the module will automatically run with the optimal settings.</p> </li> <li> <p>Many cmdlets and parameters of the module support the PowerShell's built-in <code>-Debug</code> switch and when that switch is used, they display extra details and debugging messages on the console, showing you what's happening under the hood.</p> </li> </ul> <p></p>"},{"location":"WDACConfig%20Module/Remove-WDACConfig/#remove-wdacconfig-signedbase","title":"Remove-WDACConfig -SignedBase","text":"<pre><code>Remove-WDACConfig [-SignedBase] -PolicyPaths &lt;String[]&gt; -CertCN &lt;String&gt; [-SignToolPath &lt;String&gt;]\n</code></pre> <p>Uses the official procedure to Re-Deploy the Signed base WDAC policies with Enabled:Unsigned System Integrity Policy rule option.</p>"},{"location":"WDACConfig%20Module/Remove-WDACConfig/#1-mandatory-parameter","title":"1 mandatory parameter","text":"<ul> <li><code>-PolicyPaths &lt;String[]</code>: Path to xml file(s) of the currently deployed policy that you want to remove, can be multiple. Supports tab completion by showing only <code>.xml</code> files.</li> </ul>"},{"location":"WDACConfig%20Module/Remove-WDACConfig/#2-automatic-parameters","title":"2 Automatic parameters","text":"<ul> <li> <p><code>-SignToolPath &lt;String&gt;</code>: You can use it in 2 different ways</p> </li> <li> <p><code>-CertCN &lt;String&gt;</code>: Common name of the certificate used to sign the deployed WDAC policies - Supports argument completion so you don't have to manually enter the Certificate's CN, just make sure the certificate is installed in the personal store of the user certificates, then press TAB to auto complete the name. You can however enter it manually if you want to.</p> </li> </ul> <p></p> <p></p> <p></p>"},{"location":"WDACConfig%20Module/Remove-WDACConfig/#remove-wdacconfig-unsignedorsupplemental","title":"Remove-WDACConfig -UnsignedOrSupplemental","text":"<pre><code>Remove-WDACConfig [-UnsignedOrSupplemental] [-PolicyIDs &lt;String[]&gt;] [-PolicyNames &lt;String[]&gt;]\n</code></pre> <p>Removes Unsigned deployed WDAC policies as well as Signed deployed Supplemental WDAC policies</p>"},{"location":"WDACConfig%20Module/Remove-WDACConfig/#2-parameters","title":"2 parameters","text":"<ul> <li><code>-PolicyIDs &lt;String[]&gt;</code></li> <li><code>-PolicyNames &lt;String[]&gt;</code></li> </ul> <p>You can choose either of them or both of them, at the same time, but you do need to use one of them at least.</p> <p>They use argument completion with ValidateSet, meaning you can't specify wrong PolicyIDs or PolicyNames, just press TAB key and it will autofill the arguments for you based on the deployed policies. If you want to select multiple items, after each one, enter a comma <code>,</code> and then press TAB again to choose another Name/ID.</p> <p>For example, you can specify 2 policies by IDs and 3 policies by names, and it will automatically remove all of them.</p> <p>Hint: First use -ListActivePolicies parameter to list the deployed policies on the screen.</p> <p>Hint 2: When using <code>-PolicyNames &lt;String[]&gt;</code> parameter, if multiple policies with the exact same name are deployed, when you press TAB, you will only see 1 of them, if you select it, all of the policies with that name will be removed. If that's not desired, consider using <code>-PolicyIDs &lt;String[]&gt;</code> parameter instead.</p> <p>Hint 3: The argument completers on this parameter are very smart. E.g., if there are 10 policies deployed on the system and you use argument Tab completion to select 5 of them by IDs, when you try to select the other 5 by their names, the name of the policies that you already selected by IDs don't show up anymore. This greatly reduces user error and simplifies the workflow for end user.</p> <p></p>"},{"location":"WDACConfig%20Module/Remove-WDACConfig/#the-logic-behind-signtoolpath-string-optional-parameter","title":"The logic behind <code>-SignToolPath &lt;String&gt;</code> optional parameter","text":"<ol> <li> <p>If Windows SDK Signing Tools for Desktop Apps components is installed in the default location <code>C:\\Program Files (x86)\\Windows Kits</code>, then <code>-SignToolPath &lt;String&gt;</code> parameter isn't necessary.</p> </li> <li> <p>If Windows SDK Signing Tools for Desktop Apps components is not installed in the default location or you want to manually browse for the <code>signtool.exe</code>, then make sure you use the <code>-SignToolPath &lt;String&gt;</code> parameter.</p> </li> </ol>"},{"location":"WDACConfig%20Module/Set-CommonWDACConfig/","title":"Set-CommonWDACConfig available parameters","text":""},{"location":"WDACConfig%20Module/Set-CommonWDACConfig/#notes","title":"Notes","text":"<ul> <li> <p>Mandatory parameters indicate you always need to provide values for them.</p> </li> <li> <p>Automatic parameters indicate that if you used Set-CommonWDACConfig cmdlet to set default values for them, the module will automatically use them. This saves time and prevents repetitive tasks. However, if no value exists in User Configurations for an Automatic parameter and you didn't explicitly provide a value for that parameter either, then you will see an error asking you to provide value for it. Explicitly providing a value for an Automatic parameter in the command line overrides its default value in User Configurations, meaning the module will ignore the value of the same parameter in the User Configurations file.</p> </li> <li> <p>Optional parameters indicate that they are not required and without using them the module will automatically run with the optimal settings.</p> </li> <li> <p>Many cmdlets and parameters of the module support the PowerShell's built-in <code>-Debug</code> switch and when that switch is used, they display extra details and debugging messages on the console, showing you what's happening under the hood.</p> </li> </ul> <p></p> <p></p> <pre><code>Set-CommonWDACConfig [[-SignedPolicyPath] &lt;string&gt;] [[-UnsignedPolicyPath] &lt;string&gt;] [[-SignToolPath] &lt;string&gt;]\n[[-CertCN] &lt;string&gt;] [[-StrictKernelPolicyGUID] &lt;guid&gt;] [[-StrictKernelNoFlightRootsPolicyGUID] &lt;guid&gt;]\n[[-CertPath] &lt;string&gt;] [-DeleteUserConfig] \n</code></pre> <p></p> <p>Use this cmdlet to store the values for common and frequently used parameters so that you won't have to specify them again every time.</p> <p>All of the applicable cmdlets of the module automatically check the User Configuration file for any available input, if you don't specify values for their parameters.</p> <p></p>"},{"location":"WDACConfig%20Module/Set-CommonWDACConfig/#an-example","title":"An example","text":"<p>Instead of specifying all of the parameters for <code>Edit-SignedWDACConfig</code> cmdlet like this:</p> <pre><code>Edit-SignedWDACConfig -AllowNewApps -SuppPolicyName \"App 1\" -CertPath \"Path To Certificate.cer\" -PolicyPaths \"Path To Policy.xml\" -CertCN \"Certificate Common Name\"\n</code></pre> <p>You can just run this</p> <pre><code>Edit-SignedWDACConfig -AllowNewApps -SuppPolicyName \"App 1\"\n</code></pre> <p>If correct and valid values for the missing parameters exist in User Configuration file, the cmdlet will automatically detect and use them seamlessly.</p> <p></p>"},{"location":"WDACConfig%20Module/Set-CommonWDACConfig/#8-optional-parameters","title":"8 optional parameters","text":"<ul> <li> <p><code>-SignedPolicyPath &lt;String&gt;</code>: Path to the xml file of a Signed policy. Supports tab completion by showing only the base policies in the current working directory.</p> </li> <li> <p><code>-UnSignedPolicyPath &lt;String&gt;</code>: Path to the xml file of an Unsigned policy. Supports tab completion by showing only the base policies in the current working directory.</p> </li> <li> <p><code>-SignToolPath</code>: Path to the SignTool executable. Supports tab completion by opening a file picker dialog GUI to help you select your <code>.exe</code> SignTool executable easily.</p> </li> <li> <p><code>-CertCN</code>: Common Name of an installed certificate. Supports argument completion so you don't have to manually enter the Certificate's CN, just make sure the certificate is installed in the personal store of the user certificates, then press TAB to auto complete the name. You can however enter it manually if you want to.</p> </li> <li> <p><code>-CertPath</code>: Path to a certificate <code>.cer</code> file. Support tab completion by opening a file picker dialog GUI to help you select your <code>.cer</code> certificate file easily.</p> </li> <li> <p><code>-DeleteUserConfig</code>: Deletes the <code>.WDACConfig</code> folder in User directory and everything in it.</p> </li> <li> <p><code>-StrictKernelPolicyGUID</code>: GUID of the Strict Kernel mode policy (Mainly used Internally by the module)</p> </li> <li> <p><code>-StrictKernelNoFlightRootsPolicyGUID</code>:  GUID of the Strict Kernel no Flights root mode policy (Mainly used Internally by the module)</p> </li> </ul> <p></p>"},{"location":"WDACConfig%20Module/WDACConfig/","title":"WDACConfig (Windows Defender Application Control) Module","text":"<p>WDACConfig is an advanced PowerShell module designed with the aim of automating Application and File whitelisting in Windows using Windows Defender Application Control. You can always find its source code on GitHub and Install it from PowerShell Gallery.</p> <p>This page is also available on my website.</p>"},{"location":"WDACConfig%20Module/WDACConfig/#requirements","title":"Requirements","text":"<ul> <li>PowerShell 7.3.4 and above</li> <li>Windows 11 version 22H2 and above</li> <li>Administrator Privileges</li> <li>Internet Connection</li> </ul>"},{"location":"WDACConfig%20Module/WDACConfig/#features","title":"Features","text":"<ul> <li> <p>Uses the official documented methods on Microsoft websites only.</p> </li> <li> <p>Checks for new version when you run it and will update itself automatically if necessary.</p> </li> <li> <p>(This can be bypassed if <code>-SkipVersionCheck</code> is used, but not recommended).</p> </li> <li> <p>Detailed change logs available in Excel online.</p> </li> <li> <p>Actively trying to design it with Microsoft Security Development Lifesycle (SDL) guidelines in mind.</p> </li> <li> <p>The module goes through Extended Validation before each update is released to make sure everything works perfectly.</p> </li> </ul> <p></p>"},{"location":"WDACConfig%20Module/WDACConfig/#video-how-to-configure-use-and-setup-unsigned-wdac-windows-defender-application-control-automatically-using-wdacconfig-powershell-module","title":"VIDEO: How to Configure, Use and Setup Unsigned WDAC (Windows Defender Application Control) Automatically using WDACConfig PowerShell module","text":""},{"location":"WDACConfig%20Module/WDACConfig/#video-how-to-configure-use-and-setup-signed-wdac-windows-defender-application-control-automatically-using-wdacconfig-powershell-module","title":"VIDEO: How to Configure, Use and Setup Signed WDAC (Windows Defender Application Control) Automatically using WDACConfig PowerShell module","text":""},{"location":"WDACConfig%20Module/WDACConfig/#how-to-use-it","title":"How to use it","text":""},{"location":"WDACConfig%20Module/WDACConfig/#install-the-module","title":"Install the module","text":"<pre><code>Install-Module -Name WDACConfig -Force\n</code></pre>"},{"location":"WDACConfig%20Module/WDACConfig/#start-using-it","title":"Start using it","text":"<pre><code>WDACConfig -&lt;Press Tab for auto parameter completion&gt;\n</code></pre> <p>To get help and syntax on PowerShell console, type:</p> <pre><code>\"Get-Command -Module WDACConfig\"\n\"Get-Help New-WDACConfig\"\n\"Get-Help New-SupplementalWDACConfig\"\n\"Get-Help Remove-WDACConfig\"\n\"Get-Help Edit-WDACConfig\"\n\"Get-Help Edit-SignedWDACConfig\"\n\"Get-Help Deploy-SignedWDACConfig\"\n\"Get-Help Confirm-WDACConfig\"\n\"Get-Help New-DenyWDACConfig\"\n\"Get-Help Set-CommonWDACConfig\"\n\"Get-help New-KernelModeWDACConfig\"\n\"Get-help Get-CommonWDACConfig\"\n\"Get-help Invoke-WDACSimulation\"\n</code></pre> <p></p>"},{"location":"WDACConfig%20Module/WDACConfig/#cmdlets-and-guides","title":"Cmdlets and Guides","text":""},{"location":"WDACConfig%20Module/WDACConfig/#new-wdacconfig","title":"New-WDACConfig","text":""},{"location":"WDACConfig%20Module/WDACConfig/#new-supplementalwdacconfig","title":"New-SupplementalWDACConfig","text":""},{"location":"WDACConfig%20Module/WDACConfig/#remove-wdacconfig","title":"Remove-WDACConfig","text":""},{"location":"WDACConfig%20Module/WDACConfig/#edit-wdacconfig","title":"Edit-WDACConfig","text":""},{"location":"WDACConfig%20Module/WDACConfig/#edit-signedwdacconfig","title":"Edit-SignedWDACConfig","text":""},{"location":"WDACConfig%20Module/WDACConfig/#deploy-signedwdacconfig","title":"Deploy-SignedWDACConfig","text":""},{"location":"WDACConfig%20Module/WDACConfig/#confirm-wdacconfig","title":"Confirm-WDACConfig","text":""},{"location":"WDACConfig%20Module/WDACConfig/#new-denywdacconfig","title":"New-DenyWDACConfig","text":""},{"location":"WDACConfig%20Module/WDACConfig/#set-commonwdacconfig","title":"Set-CommonWDACConfig","text":""},{"location":"WDACConfig%20Module/WDACConfig/#new-kernelmodewdacconfig","title":"New-KernelModeWDACConfig","text":""},{"location":"WDACConfig%20Module/WDACConfig/#get-commonwdacconfig","title":"Get-CommonWDACConfig","text":""},{"location":"WDACConfig%20Module/WDACConfig/#invoke-wdacsimulation","title":"Invoke-WDACSimulation","text":""},{"location":"WDACConfig%20Module/WDACConfig/#feedback-and-feature-request","title":"Feedback and Feature request","text":"<p>If there are any feedbacks or feature requests regarding this module, please open a new discussion/issue on GitHub.</p>"}]}